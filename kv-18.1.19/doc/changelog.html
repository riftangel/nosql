<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Note: RELEASE_VERSION_FULL and DATE are set by ant -->

<head>
  <title>The Oracle NoSQL Database (Release 18.1.19 Community Edition) Change Log</title>
  <meta name="description"
        content="Oracle NoSQL Database: A Distributed Key-Value Store.">
  <meta name="keywords"
        content="distributed,database,key,value,nosql,bigdata,transaction,transactions,java">
  <style type="text/css">
    li {margin-top:1em;} <!-- Blank line before each list item -->
 </style>
</head>
<body bgcolor="white">

<h2 align="center">Oracle NoSQL Database Change Log
</h2>
<p align="center">Release 18.1.19 Community Edition</p>

<h3><a name="Upgrade">Upgrade Requirements</a></h3>
Upgrading an existing store to release 4.0 or later requires that the
store be running with a 3.0 release or later.  If you want to use this
release with a store created prior to the 3.0 release, be sure to
upgrade the store to a 3.x release before upgrading it to this release.
Once a store has been upgraded to this release, it cannot be downgraded
to an earlier major or minor release.
<p>
See the section
on <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSADM-GUID-A768BFD0-E205-48E3-855D-9616526DE014">
Upgrading an Existing Oracle NoSQL Database Deployment</a> in the Admin
Guide.
<p>
This release of the server is compatible with Java SE 8 (64-bit), and
the client is compatible with Java SE 8. Both the client and server have
been tested and certified against Oracle Java SE 8 Update 161.  We
encourage you to upgrade to the latest Java 8 release to take advantage
of the latest bug fixes and performance improvements.  We expect to
certify Oracle NoSQL Database with more recent Java major versions in a
future release.
</p>
<p>
Attempting to use this release with a version of Java earlier than the
required version will produce an error message similar to:
</p>
<blockquote>
<pre>
Exception in thread "main" java.lang.UnsupportedClassVersionError:
  oracle/kv/impl/util/KVStoreMain : Unsupported major.minor version 52.0
</pre>
</blockquote>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 18.1.19 Community Edition</u></h3>
<h3><a name="BugFixes">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed compatibility bugs which would not allow any queries to be
run with a 18.1 server and an older client.
[#26986]
</li>
<li>
Fixed a bug that could cause an exception such as the following, making
the RN unavailable. The bug was introduced in an earlier version of 18.1. It
can occur under certain conditions when 336 or more tables have been created
over the lifetime of the store.
<pre>
2018-08-29 14:16:12.965 UTC SEVERE [rg1-rn1] Process exiting
oracle.kv.impl.rep.EnvironmentFailureRetryException: com.sleepycat.je.EnvironmentFailureException: (JE +18.1.xx)
Environment must be closed, caused by: com.sleepycat.je.EnvironmentFailureException:
Environment invalid because of previous exception: (JE 18.1.xx)
rg1-rn1(1):/DATA00/rg1-rn1/env fetchLN of 0x6030/0x95727f6 parent IN=130 IN class=com.sleepycat.je.tree.BIN
lastFullLsn=0x6039/0x1e1138 lastLoggedLsn=0x603a/0x60ac3e parent.getDirty()=false state=0
expires=2018-09-02.00 LOG_FILE_NOT_FOUND: Log file missing, log is likely invalid.
Environment is invalid and must be closed.
        at oracle.kv.impl.api.RequestHandlerImpl.executeInternal(RequestHandlerImpl.java:934)
        at oracle.kv.impl.api.RequestHandlerImpl.executeRequest(RequestHandlerImpl.java:682)
        at oracle.kv.impl.api.RequestHandlerImpl.trackExecuteRequest(RequestHandlerImpl.java:649)
        at oracle.kv.impl.api.RequestHandlerImpl.access$100(RequestHandlerImpl.java:153)
        at oracle.kv.impl.api.RequestHandlerImpl$2$1.run(RequestHandlerImpl.java:523)
        at oracle.kv.impl.api.RequestHandlerImpl$2$1.run(RequestHandlerImpl.java:520)
        at oracle.kv.impl.security.ExecutionContext.runWithContext(ExecutionContext.java:192)
...
<pre>
[#27199]
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 18.1.13</u></h3>
<h3><a name="NewFeatures">New Features</a></h3>
<ol>
<li>
<p>
Changed the behavior of CLI command <code>plan stop-service</code> to ensure
store health. After this change, if stopping services using the plan will cause
the store to fall into an unhealthy state, the plan will fail with detailed
health check information as the output, such as,
<blockquote>
<code>One of the groups is not healthy enough for the operation:</code><br>
<code>[rg1] Only 1 primary nodes are running such that a simple majority cannot
    be formed which requires 2 primary nodes. The shard is vulnerable and will
    not be able to elect a new master. Nodes not running: [rg1-rn1]. Nodes to
    stop: {rg1=[rg1-rn2]} ... ...</code>
</blockquote>
The service can be forcefully stopped by adding the <code>-force</code> flag.
<p>
Note that there is one exception. Since <code>plan stop-service -all-rn</code>
will always result in an unhealthy store, the health check is skipped for such
plans and the <code>-force</code> flag is not required.
<p>
[#22425]
</li>
<li>
Implemented group by clause and seq_transform expression in SQL for Oracle
NoSQL.
<p>
Group-by is similar to the one in the standard SQL. However, in Oracle NoSQL
grouping is possible only if there is an index that sorts the rows by the
group-by expressions.
<p>
Together with group-by the following aggregate functions were implemented:
count(*), count(expr), sum(expr), avg(expr), min(expr), and max(expr).
<p>
The seq_transform expression takes as input a "source" expression and a
"mapper" expression. It evaluates the source expr, producing a sequence
of zero or more items, and "transforms" this source sequence by evaluating
the mapper expr on each item of the source sequence and concatenating the
results of these evaluations. The current source item can be accessed by
the mapper expr via the $ variable.
<p>
Here is an example that demonstrates both group-by and seq_transform:
<p>
Assume a "sales" table, whose rows look like this:
<pre>
{
  "id":1,
  "sale":
  {
    "acctno" : 349,
    "year" : 2000, "month" : 10, "day" : 23,
    "state" : "CA", "city" : "San Jose", "storeid" : 76,
    "prodcat" : "vegies",

    "items" : [ { "prod" : "tomatoes", "qty" : 3, "price" : 10.0 },
                { "prod" : "carrots",  "qty" : 1, "price" :  5.0 },
                { "prod" : "pepers",   "qty" : 1, "price" : 15.0 }
              ]
  }
}
</pre>
Assume there is the following index on sales:
<pre>
create index on sales (sale.acctno as integer,
                       sale.year as integer,
                       sale.prodcat as string)
</pre>

Then one can write the following query, which returns the total sales
per acctno and year:

<pre>
select t.sale.acctno,
       t.sale.year,
       sum(seq_transform(t.sale.items[], $.price * $.qty)) as sales
from sales t
group by t.sale.acctno, t.sale.year
</pre>
[#26427]
</li>
<li>
Implemented parent-child joins in SQL.
<p>
More generally, this feature allows for joins among tables in the same table
hierarchy. Syntactically, this is done by a new NESTED TABLES clause that may
appear in the FROM clause of an SQL query. The NESTED TABLES clause specifies
a target table and a number of ancestors and/or descendant tables of the target
table. This is similar to using a MultiRowOptions object as a parameter to the
tableIterator and tableKeysIterator methods of TableAPI. However, NESTED
TABLES greatly extends the capabilities of these programatic APIs and
provides more standard semantics and better performance as well. Specifically,
NESTED TABLES:
<ul>
<li>
Is equivalent to a number of LEFT OUTER JOINS and UNION operations, as they
are defined by standard SQL.
</li>
<li>
Allows projection: the rest of the query can select any subset of the columns
of the participating tables.
</li>
<li>
Allows predicates to be specified on the ancesteros and descendant tables,
using the ON clause from standard SQL.
</li>
<li>
Allows the target table to be accessed via a secondary index even when
descendant tables are specified.
</li>
</ul>
<p>
As an example, consider an application that tracks a population of users and
the emails sent or received by these users. Given that SQL for Oracle NoSQL
does not currently support general purpose joins, the emails are stored in a
table that is created as a child of users, so that queries can be written
that combine information from both tables using the NESTED TABLES clause. The
create table statements for the two tables are shown below.
<pre>
create table users(
    uid integer,
    name string,
    email_address string,
    salary integer,
    address json,
    primary key(id))

create table users.emails(
    eid integer,
    sender_address string,   // sender email address
    receiver_address string, // receiver email address
    time timastamp(3),
    size integer,
    content string,
    primary key(eid))
</pre>

Here are two queries that can be written over the users and emails tables.
Given that users.emails is a child table of users, it has an additional
column, not included in its create table definition. This implicit column
is named uid and has type integer. Normally, its value will be a user id
that appears in the users table, but this is not necessary.
<pre>
#
# Count the number of emails sent in 2017 by all users whose salary is greater
# than 200K
#
select count(eid)
from NESTED TABLES(
       users
       descendants(users.emails ON email_address = sender_address and
                                   year(time) = 2017)
     )
where salary > 200
</pre>
The above NESTED TABLES clause is equivalent to the following left outer join:
<pre>
users u left outer join users.emails e on u.uid = e.uid and
                                          email_address = sender_address and
                                          year(time) = 2017
</pre>
<pre>
#
# For each email whose size is greater than 100KB and was sent by a user in the
# the users table, return the name and address of that user.
#
select name, address
from NESTED TABLES(users.emails ancestors(users))
where size > 100 and sender_address == email_address
</pre>
The above NESTED TABLES clause is equivalent to the following left outer join:
<pre>
users.emails e left outer join users u on u.uid = e.uid
</pre>
[#26670]
</li>
<li>
Introduce new JSON output format for admin CLI commands, run admin CLI command
with "-json" flag will display in the new JSON output format. For compatibility,
previous admin CLI JSON output are still supported, user can use "-json-v1" to
display previous JSON v1 output format.
[#25917]
</li>
<li>
Introduce a new plan <code>plan verify-data</code> that verifies the primary
tables and secondary indices for data integrity. The users can run this plan on
Admins and/or RepNodes and can choose to verify either the checksum of data
records, or the B-tree of databases or both.
<p>
For example:
<pre>
plan verify-data -all-rns
</pre>
verifies both data record integrity and b-tree integrity of primary
tables and secondary indices for all RepNodes.
<p>
And:
<pre>
plan verify-data -verify-log disable -verify-btree enable -index disable -all-rns
</pre>
verifies the b-tree integrity of primary tables for all RepNodes.
<p>
[#26284]
</li>
<li>
Modify the Admin CLI command to support multiple helper hosts. Now users can
use either -helper-hosts or -host/-port to connect to the master admin. The
command can find the admin so long as it can contact any services at the
given hosts/ports, so the given hosts/ports do not need to have an admin. Two
flags -admin-host and -admin-port are removed. Scripts that rely on them can
simply remove these two flags as long as the given hosts/ports for
-helper-hosts or -host/-port can connect to an SN in the store.
[#26633]
</li>
<li>
Changed the release numbering convention to use the last two digits of
the current year as the major version number, and a sequential number
incremented for each release as the minor version number.  This
numbering scheme matches similar changes being made to other Oracle
products, so the Oracle major and minor release numbers
(<code>KVVersion.getOracleMajor()</code>
and <code>getOracleMinor()</code>) are now the same as the regular
release numbers (<code>KVVersion.getMajor()</code>
and <code>getMinor()</code>).  In addition, the release string no longer
contains separate Oracle version numbers.  Applications should use
the <code>KVVersion</code> methods to access individual version number
fields.  If application parse the version string, they will need to be
updated to account for the removal of the Oracle version numbers.
[#26756]
</li>
<li>
Added two new attributes to the RepNodeMXBean that is available via JMX.
<ul>
<li>
RepNodeMXBean.getOpMetric returns a JSON string containing a
bundle of operation-related metrics.
</li>
<li>
RepNodeMXBean.getEnvMetric returns a JSON string containing a
bundle of environment-related metrics.
</li>
</ul>
<p>
These JSON objects have been, and remain, available as the JMX
notifications oracle.kv.repnode.opmetric and
oracle.kv.repnode.envmetric. They are described in the Run Book.
<p>
[#26760]
</li>
<li>
The Key Distribution Statistics Utility (described in Appendix G of the Admin
Guide) has been changed so that if enabled (via the <code>rnStatisticsEnabled</code>
parameter) it is scheduled automatically when a RepNode is lightly loaded. As a
result, the parameters: <code>rnStatisticsLowActivePeriod</code>
and <code>rnStatisticsRequestThreshold</code>, have been rendered obsolete and
are no longer supported. Admin CLI scripts that set these parameters should be
updated to eliminate use of these obsolete parameters.
<p>
[#26635]
</li>
<li>
Added a new parameter, <code>rnStatisticsTTL</code>, to govern how long data
collected by the Key Distribution Statistics Utility remains in system tables
once statistics gathering is disabled (via the <code>rnStatisticsEnabled</code>
parameter) or a table or index has been dropped. The default time-to-live (TTL)
is 60 days. The time unit specified must be either days, or hours.
<p>
[#26796]
</li>
<li>
Release version strings now identify which edition is being used.  The
result of calling
<code>KVVersion.CURRENT_VERSION.toString()</code> will mention the
Client when using the <code>kvclient.jar</code> file.  For example:
<pre>
  18.1.1 2018-01-24 09:06:12 UTC  Build id: 3eef91c0eaf6 Edition: Client
</pre>
If the <code>kvstore.jar</code> file is used, then the version string
will identify the server edition of the release.
<p>
[#24136]
</li>
<li>
Implemented support for specifying the Admin directory, Admin directory
size and RN log directory in the makebootconfig command:
<ul>
<li>
<code>-admindir &lt;directory path&gt;</code>
<br>
A path to the directory that will contain the environment associated
with an Admin Node. In the absence of explicit directory arguments, the
environment files are located under the KVROOT/KVSTORE/SN'ID'/Admin'Id'/
directory. This argument is optional in makebootconfig but recommended.
</li>
<li>
<code>-admindirsize &lt;directory size&gt;</code>
<br>
The size of the Admin storage directory. This argument is optional in
makebootconfig but recommended.
</li>
<li>
<code>-rnlogdir &lt;directory path&gt;</code>
<br>
A path to the directory that will contain the log files associated with
a Replication Node. For capacity values greater than one, multiple
rnlogdir parameters must be specified in makebootconfig, one for each
Replication Node that will be hosted on the Storage Node. If rnlogdir is
not specified, by default the logs will be placed under the
KVROOT/KVSTORE/log directory. This argument is optional in
makebootconfig but recommended.
</ul>
<p>
If <code>-rnlogdir</code> is specified, then the je.info, je.config and
je.stat files for specific RN will be stored in rnlogdir.  In all cases,
the je.info, je.stat and je.config files for Admins will be stored under
kvroot log directory.
<p>
[#26444]
</li>
<li>
Full Text Search now uses an internal HTTP client which supports HTTPS
connections to Elasticsearch.
<p>
FTS does not use the elasticsearch transport client anymore.
It now uses it's own HttpClient built over apache's httpasyncclient library.
This implies that the port used while registering Elasticsearch cluster
changes to http port instead of the transport used in the earlier revision.
<p>
In the command shown below:
<pre>
plan register-es -clustername &lt;es_cluster_name&gt; -host &lt;host_name&gt;
                 -port &lt;http_port&gt; -secure true
</pre>
<p>
The port specified should be the HTTP port of ES cluster. It was the
transport port in the previous release.
<p>
As can be seen in the above command, a new secure flag is added whose
default value is true. That is, FTS now runs in secure mode by default
and this needs some additional certificate set up, as described in the
FTS documentation.
<p>
If an existing KVStore already has a registered Elasticsearch, then,
after the upgrade, it needs to be registered again using the <code>plan
register-es</code> command.  The additional registration is needed
because the registered port has changed from the transport port to the
HTTP port.
<p>
[#26059]
</li>
<li>
FTS security is only available in Enterprise Edition.
<p>
For the basic and community editions, the -secure flag needs to be set
to false explicitly:
<pre>
plan register-es -clustername &lt;es_cluster_name&gt; -host &lt;host_name&gt;
                 -port &lt;http_port&gt; -secure false
</pre>
<p>
[#26781]
</li>
</ol>
<h3><a name="BugFixes">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a bug that could cause temporary failures in the <code>plan
switchover</code> Admin CLI command. The bug caused plan task
<code>UpdateRepNodeParams</code> to fail. The failure could be identified by
the plan status output, such as,
<blockquote><code>
Failures:   Task  72       ERROR at   2018-01-01 01:01:01 UTC:
UpdateRepNodeParams rg1-rn1: 72/UpdateRepNodeParams rg1-rn1 failed.: null,
</code></blockquote>together with a message inside the admin log, such as,
<blockquote><code>
2018-01-01 01:01:01.001 UTC INFO [admin1] Couldn't update parameters for
rg1-rn1 because unexpected exception:
com.sleepycat.je.rep.ReplicaStateException: (JE 7.3.6) (JE 7.3.6) GroupService
operation can only be performed at master.
</code></blockquote>
[#26776]
</li>
<li>
Fixed a bug and improved read availability for when a rep node reaches disk
limit. The bug caused a rep node failing to restart after reaching disk limit
with a message inside the rep node log, such as,
<blockquote><code>
2018-01-01 01:01:01.001 UTC SEVERE [rg1-rn1] Process exiting
com.sleepycat.je.DiskLimitException: (JE 7.6.3) Disk usage is not within
je.maxDisk or je.freeDisk limits and write operations are prohibited: ... ...
</code></blockquote>
The fix also enables the rep node to keep serving read requests after reaching
disk limit.
[#26701]
</li>
<li>
Allow predicates inside path-filtering steps to be used as index-filtering
predicates.
<p>
For example, consider the following query:
<pre>
select id
from Foo f
where exists f.info.address.phones[$element.areacode > 408 and
                                   $element.kind = "home"]
</pre>
Assume we have an index on (info.address.phones.areacode,
                            info.address.phones.kind)
<p>
The areacode predicate will be used as a start/stop pred for the index scan.
The kind predicate can be used as an index-filtering pred, but before this
fix it wouldn't be used as such. If the kind pred is not pushed to the index,
we also loose the "covering-index" optimization for this query.
<p>
[#26162]
</li>
<li>
In case of a secondary covering index, locks were being acquired on the
table rows, which means that the primary index was being looked up for
every such lock. Instead, in this case, only the qualifying index
entries need to be locked. This fix can result in significant
performance improvement if all data accessed are found in main memory at
the server. For example, for a simple prepared query, this fix showed a
20% improvement in the end-to-end query latency.
[#26451]
</li>
<li>
Avoid data cloning in UPDATE query statements. In previous releases, new values
(computed in SET, ADD or PUT clauses) were cloned before they were used to update
the target item(s). This is because, it is possible to create cycles among items,
resulting in stack overflows when such a circular data structure is serialized.
This fix tries to avoid avoid such cloning in most common cases, by
detecting at compile time that a cycle is not possible.
</li>
<li>
When a query uses a multi-key index, it is often the case that duplicate results
must be eliminated. This is done based on primary key values. A bug was fixed
that would cause an exception to be thrown if a primary key column is of type
Number or Timestamp.
[#26460]
</li>
<li>
Fixed a bug that was preventing external variables to be used in update
statements.
[#26504]
</li>
<li>
Fixed a bug that ocurred when the SELECT clause contained a single
expression with no AS clause. In this case, the value returned by this expression
must be wrapped in a single-field record (because it may not be a record, and 
queries must always return records having the same record type). However,
this wrapping was not always done.
[#26767]
</li>
<li>
Fixed a query bug showing up when querying a key-only table with an order-by query.
A QueryStateEception would be thrown in this case during compilation, because the
order-by expressions were not being rewritten to access the index fields instead
of the table columns.
[#26632]
</li>
<li>
Fixed a bug with a select-star query that (a) queries a key-only table and
(b) uses a secondary index that indexes all the table columns. The bug would
cause the index entries to be returned instead of the table rows. Although,
in this case, the index entries contain the same information as the table
rows, the ordering of the columns and/or their names may be in different.
As part of this fix, an index that indexes all the tale columns will always
be recognized as a covering index, whereas this was not the case before.
[#26838]
</li>
<li>
Fixed a bug showing up in queries like the following example:

<pre>
declare $ext6 string;
select f.str
from foo f
where f.str >= $ext and f.str <= "ab"
</pre>

If the $ext variable is set to "ab", the query will return all rows whose
str column starts with "ab" rather than being equal to "ab". Notice that if an
external variable were not used, the bug would not show up, because the compiler
would convert the WHERE condition to f.str = "ab".
[#26671]
</li>
<li>
Fixed an issue where the <code>topology validate</code> command returns
"null" when the topology candidate that is being validated contains
Storage Nodes that do not exist in the current store. [#26294]
</li>
<li>
There is now a limit on the number of plans stored by the Admin. Plans with
an ID 1000 less than the latest plan will be automatically removed from
the Admin's persistent store. Only plans that are in a terminal state
(SUCCEEDED or CANCELED) are removed. [#22963]
</li>
<li>
A limitation has been placed on plan names which prevents the creation of
new plans with a name starting with "SYS$". This prefix is reserved to plans
which are created internal by the Admin to perform its own administrative
operations. Existing plans starting with "SYS$" are not affected. [#26279]
</li>
<li>
Fixed some issues that prevented requests from completing within the
specified request timeout, in particular when checking for quorum and
specifying JE transaction timeouts. Also, modify request handling to
prioritize ConsistencyException over RequestTimeoutException, since
ConsistencyException provides more specific information about the cause
of the request failure. [#22849]
</li>
<li>
Fixed a table scan issue where the order of rows returned by the following
method on the TableAPI interface may be incorrect when Direction.FORWARD and
Direction.REVERSE are specified. The bug required that the primary key field(s)
be declared in order at the beginning of the DDL statement to create the table.
That is no longer the case. This is the method with the problem:
<pre>
  TableIterator&lt;Row&gt; tableIterator(...)
</pre>
[#26769]
</li>
<li>
Made code changes and upgraded some external libraries to support Java
9.  Note that these changes are still preliminary: full testing will
move to the latest Java version in a future release.
<p>
[#25278]
</li>
<li>
Fixed an issue that Storage Node configured with "-noadmin" flag doesn't
suppress starting a Bootstrap Admin.
[#26840]
</li>
<li>
Fixed an issue that returns "Unknown statement" when execute update statement
on sql shell.
[#26357]
</li>
<li>
Support to parse Timestamp string with zone offset in format of
"+HH:MM"/"-HH:MM" or 'Z'(rep for UTC) with default pattern.
[#25808]
</li>
<li>
Fixed the output message for "show pool -name" command when supplying a
non-exist pool name. Previously it will display "Unknown Exception" with stack
trace.
[#26639]
</li>
<li>
Fixed the output of "ping" command to be directed to stdout when the command
exit code is 0. Previously all the output of "ping" will be directed to stderr.
[#26693]
</li>
<li>
Additional optional argument -shard added in ping command to check for services status specific to a particular shard. These changes have been done for both admin and top level ping version. ping -shard shardId will give status for SN, RNs and Arbiter associated with specific shard. Additional information about number of shard in topology added in show topology output with numShard=X.
[#25348]
</li>
<li>
Fixed a problem which prevented information about storage directories
specified with the <code>-storagedir</code>
and <code>-storagedirsize</code> flags to
the <code>makebootconfig</code> command from being included in the
output of the <code>generateconfig</code> command. [#26353]
</li>
</ol>
<h3><a name="Storage">Storage Engine Changes (JE 18.1)</a></h3>
<ol>
<li>
Fixed a bug that could on occasion cause a NullPointerException after an RN
transitions from Master to Replica with the representative stack trace below:
<pre>
   2017-08-08 06:59:15.498 UTC SEVERE [rg3-rn1] JE: Uncaught exception in feeder
   thread Thread[Feeder Output for rg1-rn1,5,main] nulljava.lang.NullPointerException
    at com.sleepycat.je.rep.vlsn.VLSNIndex.getLatestAllocatedVal(VLSNIndex.java:488)
    at com.sleepycat.je.rep.impl.node.Feeder$OutputThread.writeAvailableEntries(Feeder.java:1337)
    at com.sleepycat.je.rep.impl.node.Feeder$OutputThread.run(Feeder.java:1163)
</pre>
[#26495] (18.1.0)
</li>
<li>
JE's per-Database (per-partition) disk utilization metadata is no longer
maintained in order to better support very large numbers of partitions.
Using a worst case example of 20K partitions per RN with records spread over
1,000 data files, previously the utilization metadata would occupy roughly 2GB
of memory and over 100GB of disk. This metadata has been removed.  Due to the
metadata removal, the dataAdminBytes cache statistic has also been removed.
<p>
[#26597] (18.1.1)
</li>
<li>
JE recovery time (RN and Admin startup time after a crash) has been reduced.
To go along with this optimization, NoSQL DB has increased the default JE
checkpoint interval to reduce writing and improve disk utilization.
<p>
[#26179] (18.1.3)
</li>
<li>
Fixed a NullPointerException during deadlock detection on an RN or Admin, for
example:
<pre>
java.lang.NullPointerException:
  at com.sleepycat.je.txn.LockManager$DeadlockChecker.hasCycleInternal(LockManager.java:1942)
...
</pre>
This was never reported for NoSQL DB, but if it did occur would have caused
the RN or Admin to restart. It did not cause persistent corruption.
<p>
[#26570] (18.1.3, originally fixed in 7.4.6)
</li>
<li>
Fixed two bugs that sometimes caused internal operations to be included in
JE operation stats (priSearchOps, etc).
<ul>
    <li>
        The Btree verifier was incorrectly contributing to operation stats.
    </li>
    <li>
        Deletion operations sometimes incorrectly included search and position
        stats, depending on the timing.
    </li>
</ul>
<p>
[#26694] (18.1.4)
</li>
<li>
Fixed a very rare, timing related bug that could cause internal corruption.
The bug has always been present in JE HA and has been seen only once in a
stress test.
<p>
[#26706] (18.1.4)
</li>
<li>
The default for JE EnvironmentConfig.TREE_COMPACT_MAX_KEY_LENGTH has been
changed from 16 to 42 bytes. This reduces cache usage for Btree internal nodes
by 5 to 25%, depending on the key size used (smaller key sizes give larger
savings).
<p>
[ANDC-203] (18.1.6)
</li>
<li>
Fixed a bug that could cause the following exception on a replica node, when
using TTL in conjunction with record deletions:
<pre>
  2018-02-10 12:00:00.006 UTC INFO [rg1-rn1] JE: Replay thread exiting
  with exception:Environment invalid because of previous exception: ...
  Replicated operation could not be applied. DEL_LN_TX/14
  vlsn=1,711,027,333 isReplicated="1" txn=-834602813 LOG_INCOMPLETE:
  Transaction logging is incomplete, replica is invalid. Environment is
  invalid and must be closed. Problem seen replaying entry DEL_LN_TX/14
  vlsn=1,711,027,333 isReplicated="1" txn=-834602813
</pre>
The problem can occur under the following conditions:
<ul>
  <li>The TTL feature is used.</li>
  <li>A replica is lagging or down (this is not uncommon).</li>
  <li>Records with a TTL are also sometimes deleted explicitly at around
      the time the record expires.</li>
</ul>
Prior to this bug fix, the problem could be corrected only by performing a
network restore on the replica.
<p>
[#26851] (18.1.10)
</li>
</ol>
<h3><a name="Utilities">Utility Changes</a></h3>
<ol>
<li>
Snapshot utility will by default create snapshot for configurations as well as
service data. Introduced new arguments <code>-restore-from-snapshot</code> in
"start" command line to allow user directly restore from previous
snapshot when starting up SN.
[#26119]
</li>
<li>
Added new CLI command to limit the type of client requests enabled for the
whole store or specific shards.
<pre>
plan enable-requests -request-type {ALL|READONLY|NONE}
     {-shard &lt;shardId[,shardId]*&gt; | -store}
</pre>
There are three request types can be configured by this command, setting ALL
means the store or shards can process both read and write requests; READONLY
makes the store or shards only respond to read requests; NONE means no
requests will be processed by store or shards.[#25422]
</li>
<li>
Release version information provided in the output of the
<code>version</code> and <code>ping</code> commands, and also
the <code>show versions</code>, <code>ping</code>, and <code>verify
configuration</code> commands in the Admin CLI, now identifies the
edition of the release being used.  For <code>version</code>, the output
identifies the edition of the JAR file used for the command.
For <code>show versions</code>, the server information identifies the
edition of the Admin service.  For the other commands, the version
information for each Storage Node identifies the edition of the JAR file
being used to run that Storage Node.  For example:
<pre>
  java -jar kvstore.jar version
  18.1.1 2018-01-24 09:06:12 UTC  Build id: 3eef91c0eaf6 Edition: Community
</pre>
And:
<pre>
  java -jar dist/lib/kvstore.jar ping -host localhost -port 5000 \
       -security /tmp/kvroot/security/user.security
  Pinging components of store kvstore based upon topology sequence #14
  10 partitions and 1 storage nodes
  Time: 2018-01-24 21:35:59 UTC   Version: 18.1.1
  Shard Status: healthy:1 writable-degraded:0 read-only:0 offline:0 total:1
  Admin Status: healthy
  Zone [name=KVLite id=zn1 type=PRIMARY allowArbiters=false
      masterAffinity=false]   RN Status: online:1 offline:0
  Storage Node [sn1] on localhost:5000    Zone: [name=KVLite id=zn1
      type=PRIMARY allowArbiters=false masterAffinity=false]
      Status: RUNNING   Ver: 18.1.1 2018-01-24 06:34:44 UTC
      Build id: 3eef91c0eaf6 Edition: Community
	Admin [admin1]		Status: RUNNING,MASTER
	Rep Node [rg1-rn1]	Status: RUNNING,MASTER sequenceNumber:50
            haPort:5006
</pre>
[#24136]
</li>
<li>
Implemented the new feature master affinity zone for KVStore. This feature
allows users to set master affinity/no-master affinity for a zone when
deploying a zone. The zone with master affinity property has higher priority to
host master RNs. Besides, the feature also provides a command to allow users to
change the master affinity for the deployed zones.
<p>
The feature adds new flags <b>-master-affinity/-no-master-affinity</b> for the
existing command <b>deploy-zone</b> and adds a new command
<b>topology change-zone-master-affinity</b>. The usage of the new command is as
follows:
<pre>
Usage: topology change-zone-master-affinity -name &lt;name&gt;
    {-zn &lt;id&gt; | -znname &lt;name&gt;}
    {-master-affinity | -no-master-affinity}
    Modifies the topology to change the master affinity of the specified
    zone.
</pre>
<p>
[#25157]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 12cR2.4.5.12</u></h3>
<h3><a name="NewFeatures4512">New Features</a></h3>
<ol>
<li>
Introduced Streams API that allows users to subscribe to all the changes
from write operations to an Oracle NoSQL Database table. The changes
are streamed to your application as a series of discrete
<code>StreamOperation </code> class objects. These APIs are an
implementation of Reactive Streams interface
(http://www.reactive-streams.org). The Oracle NoSQL version of the
streams APIs are prefixed with NoSQL so as to differentiate them from
the APIs described by the Reactive Streams standard. For example,
Reactive Streams describes a <code>Publisher</code> class.
Oracle NoSQL Database's implementation of that class is
<code>NoSQLPublisher</code>. For more information refer to the
"Getting Started with Oracle NoSQL Database Streams API"
[#24871]
</li>
<li>
Added UPDATE statement to perform single-row, server-side updates with SQL.
<p>
The UPDATE statement in Oracle NoSQL is an extended version of the one in
standard SQL. In addition to the SET clause, which is used to replace the value
of existing data fields, the ADD, PUT, and REMOVE clauses have been added to
support adding and removing elements and fields to/from arrays and maps.
Furthermore, the already powerful path expressions of Oracle NoSQL can be used
to identify multiple target fields to update (whether those fields are inside
json or strongly typed data) and to compute new values, potentially based on
the current values. However, in the current implementation, only a single
row may be updated, which implies that the WHERE clause must specify a complete
primary key.
<p>
As an example, assume a table, called "People", with only two columns: an
integer "id" column and an "info" column of type JSON. Furthermore, let's
assume the following row to be updated:

<pre>
{
  "id" : 0,
  "info" :
  {
    "firstName" : "John",
    "lastName" : "Doe",
    "profession" : "software engineer",
    "income" : 200000,
    "address" :
    {
      "city" : "San Fransisco",
      "state" : "CA",
      "phones" : [ { "areacode":415, "number":2840060, "kind":"office" },
                   { "areacode":650, "number":3789021, "kind":"mobile" },
                   { "areacode":415, "number":6096010, "kind":"home" }
                 ]
    },
    "children":
    {
      "Anna" : { "age" : 10, "school" : "ABC", "friends" : ["John", "Maria"] },
      "Ron"  : { "age" : 2 },
      "Mary" : { "age" : 7, "school" : "XYZ", "friends" : ["Mark"] }
    }
  }
}
</pre>

The following UPDATE statement updates various fields in the above row:

<pre>
update People p
set p.info.profession = "surfing instructor",
set p.info.address.city = "Santa Cruz",
set p.info.income = $ / 10,
set p.info.children.values().age = $ + 1,
add p.info.address.phones 0 { "areacode":831, "number":5294368, "kind":"mobile" }
remove p.info.address.phones[$element.kind = "office"]
put p.info.children.Ron { "friends" : ["Julie"] },
where id = 0
returning *
</pre>

The RETURNING clause at the end of the above statement specifies that the
whole row, after the update, must be returned. So, the result of the statement
looks like this:

<pre>
{
  "id" : 0,
  "info" :
  {
    "firstName" : "John",
    "lastName" : "Doe",
    "profession" : "surfing instructor",
    "income" : 20000,
    "address" :
    {
      "city" : "Santa Cruz",
      "state" : "CA",
      "phones" : [ { "areacode":831, "number":5294368, "kind":"mobile" },
                   { "areacode":650, "number":3789021, "kind":"mobile" },
                   { "areacode":415, "number":6096010, "kind":"home" }
                 ]
    },
    "children":
    {
      "Anna" : { "age" : 11, "school" : "ABC", "friends" : ["John", "Maria"] },
      "Ron"  : { "age" : 3, "friends" : ["Julie"] },
      "Mary" : { "age" : 8, "school" : "XYZ", "friends" : ["Mark"] }
    }
  }
}
</pre>

The first two SET clauses change the profession and city of John Doe. The third
SET reduces his income to one tenth. In this SET, the implicitly declared $
variable is bound to the target item of the SET, i.e., to the result of the
p.info.income expression. The fourth SET increases the age of John's children
by 1. Notice again the use of the $ variable here: the expression
p.info.children.values().age returns 3 ages; the SET iterates over these ages,
binds the $ variable to each age in turn, computes the expression $ + 1 for each
age, and updates the age with the new value.
<p>
The ADD clause adds a new phone at position 0 inside the phones array. The REMOVE
removes all the office phones (only one in this example). The PUT clause adds a
friend for Ron. In this clause, the expression p.info.children.Ron returns the
value associated with the Ron child. This value is a map (the json object
{ "age" : 3 }) and becomes the target of the update. The 2nd expression in
the PUT ({ "friends" : ["Julie"] }) constructs and returns a new map. The fields
of this map are added to the target map.
[#26161]
</li>
<li>
Changes in the cast expression.
<ul>
  <li>
  A record can now be cast to a map. This allows a user to cast a record to a
  json object.
  </li>
  <li>
  A map can be cast to a record. This is needed for updates, because we don't
  have a record constructor, so if a user wants to replace a whole record with
  a new record, the user constructs a map, which is then cast to the record by
  the update stmt.
  <li>
  In the previous implementation casting to JSON was a noop if the input value
  was a subtype of JSON. However, this was actually a bug, because for example,
  ARRAY(INT) is a subtype of JSON. and if we want to cast ARRAY(INT) to JSON,
  we should create an array of ARRAY(JSON) type. So, if the target type is JSON,
  the current implementation makes sure that any arrays/maps contained in the
  input value are cast to ARRAY(JSON)/MAP(JSON) in the output value.
  Furthermore, since we now allow casting records to maps, casting a record to
  JSON is now treated as casting the record to MAP(JSON). Before, this would
  raise an error.
  </li>
</ul>
[#26161]
</li>
<li>
Added SQL function seq_concat. It simply returns the concatenation of the
sequences returned by its argument expressions. [#26161]
</li>
<li>
Added SQL functions to extract temporal fields from a TIMESTAMP field. [#26046]
</li>
<li>
Storage directory sizes are now used to enforce disk usage, and new statistics
are provided for monitoring disk usage. We strongly recommend that all
applications:
  <ul>
      <li>Specify storage directories and sizes for all RNs.</li>
      <li>Monitor disk usage using the new availableLogSize statistic and take
          correction action well before this value reaches zero.</li>
  </ul>
<p>
Specifying a storage size is important because the storage engine reserves data
files for potential replication to nodes that are out of contact. More reserved
files are retained for potential replication in this release. If a storage size
is not specified, all the free space on the volume (minus 5GB of free space),
will eventually be used.
<p>
If monitoring is not performed or corrective actions are not taken, there
is a danger that the storage size (or the volume size) will be exceeded as the
size of the data set grows. Although less likely, this could also occur due to
a configuration error (for example, too small a cache size), by neglecting to
delete a snapshot, etc. Disk usage is now monitored internally and write
operations will be rejected when the storage size (or volume size) is in danger
of being exceeded. In this situation, read operations are still allowed.
Previously, the RN would cease to function when the volume was filled, i.e., no
operations could be performed.  Allowing read operations now provides partial
availability in this situation.  In addition, it is now guaranteed that at
least 5GB of free space on the volume will be maintained, regardless of the
specified storage size.
<p>
The availableLogSize statistic represents the amount of space that can be used
by write operations, taking into account that reserved data files will be
deleted automatically when necessary to perform write operations.  Note that
monitoring disk usage in the file system is not meaningful, because of the
presence of these reserved files that will be deleted automatically.
<p>
The availableLogSize statistic is one of several new statistics:
  <ul>
    <li>activeLogSize -- Bytes used by all active data files: files required
        for basic operation.</li>
    <li>reservedLogSize -- Bytes used by all reserved data files: files that
        have been cleaned and can be deleted if they are not protected.</li>
    <li>protectedLogSize -- Bytes used by all protected data files: the subset
        of reserved files that are temporarily protected and cannot be
        deleted.</li>
    <li>protectedLogSizeMap -- A breakdown of protectedLogSize as a map of
        protecting entity name to protected size in bytes.</li>
    <li>availableLogSize -- Bytes available for write operations when
        unprotected reserved files are deleted: free space + reservedLogSize -
        protectedLogSize.</li>
    <li>totalLogSize -- Total bytes used by data files on disk: activeLogSize +
        reservedLogSize.</li>
  </ul>
<p>
These statistics are included in the .stat files and can be monitored using the
JMX oracle.kv.repnode.envmetric type [TODO: doc ref]. In the JMX output, these
statistic names are prefixed by "Cleaning_" because they are in the log
cleaning (disk garbage collection) statistics group, for example:
"Cleaning_availableLogSize".
<p>
For a new store, the storage size is specified using the makebootconfig the
-storagedirsize argument.  For an existing store, the storage size can be added
(or modified) using the change-storagedir plan.  Note that in both cases the
-storageDir must be specified, even if the capacity is one.
<p>
Because specifying a storage directory size is recommended, a warning is now
printed by makebootconfig when -storagedir is specified but -storagedirsize is
not specified.
<p>
[#25220]
</li>
<li>
<p>
<code>Verify Configuration</code> now issues a warning if the user does not
specific the <code>-storagedirsize</code> and <code>-rootdirsize</code>.
We recommend that users set these parameters when installing the store
to help manage disk space.
<p>
[#26187]
</li>
<li>
Increased the table name size from 32 characters to 256 characters. [#26021]
</li>
</ol>
<h3><a name="BugFixes4512">Bug and Performance Fixes</a></h3>
<ol>
<li>
Better index usage by queries.
<p>
In prior releases, conditions that appear inside path filtering steps were
not considered as sargable, that is, they would never be used in determining
the start or stop points of an index scan. In the current release, this
restriction is removed. As an example, consider the following query:

<pre>
select id
from foo f
where f.info.address.phones[408 <= $element.areacode and
                            $element.areacode <= 650].kind =any "work"
</pre>

If there is an index on
(info.address.phones[].areacode, info.address.phones[].kind),
all predicates in the query can now be used for the index scan. So, a scan
on this index will start at areacode 408 and stop right after areacode 650.
During the scan, only entries whose "kind" field is equal to "work"
will be selected. Before this fix, if the index was chosen by the query,
the full index would be scanned and only the equality pred on kind would
applied during this scan.
<p>
In addition to path-filtering predicates, EXISTS predicates are also
treated as potentially sargable predicates in this release. For example,
consider the following query:

<pre>
select id
from foo f
where exists f.info.address.state and exists f.info.address.phones.areacode
</pre>

In this case, if we have an index on
(info.address.state, info.address.phones[].areacode)
both predicates in the query are sargable. Two ranges of the index will be
scanned. The first range starts at the beginning of the index and finishes
at the first entry having EMPTY as the value of the state field. The second
range start just after this EMPTY value and finishes at the end of the index.
During each scan, entries having the EMPTY value for the areacode field will
be eliminated.
[#26044]
</li>
<li>
Fixed a bug in the case where a query uses a secondary index and it also has
a predicate on a primary-key column, which is not part of the index definition.
Under some conditions, the predicate on the primary-key column was used as
a start/stop predicate for the index scan. This is not possible and the query
would raise an IndexOutOfBoundsException during compilation. An example is the
following:

<pre>
create table t1(id integer, name string, primary key(id));

create index idx1 on t1(name);

select * from t1 where name = "alex" and id > 0
</pre>

With this bug fix, the condition on the "id" column is not used as a
start/stop predicate any more, but it is used as an index-filtering
predicate instead. [#26358]
</li>
<li>
Added functionality to plan failover command to add, move or remove
Arbiters to the topology. [#25269]
</li>
<li>
Fixed performance bug in SQL query processing. Removed an unnecessary
remote call to fetch table metadata. This call was adding a one-time
overhead of close to 2ms to each SQL query. For queries that access
few rows, this is a huge overhead, especially when the rows are cached
in memory. For example, the latency of a query that accesses and
returns a single memory-cached row was 5x slower than an equivalent
table iterator API call.
[#26232]
</li>
<li>
Fixed a query bug that occurs when a TableQuery operation
is forwarded by a server to another server. For example, this may
happen during partition migration. The bug was in the serialization
method of TableQuery, because that method assumed that serialization
occurs only when the TableQuery is sent from a client to the servers.
[#26385]
</li>
<li>
Users can now set the <code>PASSWORD LIFETIME</code> to zero.
The password will never expire if the value is set to zero days.
Prior to this fix, when the user tried to issue
"ALTER USER admin PASSWORD LIFETIME 0 DAYS", the statement
will fail with message "Time value must not be zero or negative".
[#26040]
</li>
<li>
Changed the way the Java driver configures Java loggers to make it
easier to configure additional log handlers.  Applications can now be
configured to send logging output to a file by specifying a file logging
handler for the "kv.oracle" logger. [#26134]
</li>
<li>
Fixed bugs that allow queries to execute against a secure kvstore after a
session timeout without returning <code>AuthenticationRequiredException</code>.
[#26250], [#26249]
</li>
<li>
The method <code>oracle.kv.table.Index.createIndexKey(RecordValue value)</code> has been
deprecated in this release, this method is not able to construct index keys for
<em>multi-key</em> indexes that include elements of a map or array and can result in
multiple index entries, or distinct IndexKey values for a single row.
[#26211]
</li>
<li>
Fixed a bug where altering a key-only table by adding a non-primary-key column
would cause subsequent queries and index creation to fail. This bug exists in
R4.4 as well.
[#26354]
</li>
<li>
Fixed the output for <code>SHOW AS JSON USERS</code> and <code>SHOW AS
JSON ROLE role</code> to output results in the correct JSON format. The
incorrect output format was causing parsing issues in their
applications.
[#26355]
</li>
<li>
When upgrading from a pre-4.2 release to 4.2, 4.3, or 4.4, the
presence of multiple outstanding plans in the ERROR state can cause
the Admin to fail when starting up.  That bug has been fixed in this
release.
[#26303]
</li>
</ol>
<h3><a name="Utilities4512">Utility Changes</a></h3>
<ol>
<li>
Introduced two new arguments <code>-registry-open-timeout</code> and
<code>-registry-read-timeout</code> for Admin CLI and ping utility, which are
used to configure open and read timeout in milliseconds associated with the
sockets used to make registry requests.
[#24164]
</li>
</ol>
<h3><a name="Storage4512">Storage Engine Changes (JE 7.5)</a></h3>
<ol>
<li>
Fixed a compatibility problem with the Azul Zulu JVM. Previously the following
exception would occur when using Zulu:
<pre>
The database environment could not be opened: java.lang.IllegalStateException:
Could not access Zing management bean. Make sure -XX:+UseZingMXBeans was
specified.
</pre>
[#26163]
</li>
<li>
Fixed a bug that could cause OutOfMemoryError when performing a network
restore. This could cause an RN to unnecessarily restart and retry the network
restore. (A network restore is used when an RN has been down for some period
of time, and is lagging the master node in its shard.) [#26305]
</li>
<li>
Fixed a bug that could prevent performing a network restore, after a prior
network restore was aborted or incomplete for any reason. (A network restore
is used when an RN has been down for some period of time, and is lagging the
master node in its shard.)
<p>
For example, this could occur if the RN process is killed during the first
network restore, and then another network restore is attempted. The problem
could occur only in an environment with a relatively large data set,
specifically where at least one billion write transactions had been performed.
An example stack trace is below.
<pre>
java.lang.NumberFormatException: For input string: "7473413648"
at java.lang.NumberFormatException.forInputString(
        NumberFormatException.java:65)
at java.lang.Integer.parseInt(Integer.java:583)
at java.lang.Integer.parseInt(Integer.java:615)
at com.sleepycat.je.rep.InsufficientLogException.init(
        InsufficientLogException.java:218)
at com.sleepycat.je.rep.impl.RepImpl.handleRestoreRequired(
        RepImpl.java:2296)
at com.sleepycat.je.recovery.RecoveryManager.findEndOfLog(
        RecoveryManager.java:543)
at com.sleepycat.je.recovery.RecoveryManager.recover(
        RecoveryManager.java:339)
at com.sleepycat.je.dbi.EnvironmentImpl.finishInit(
        EnvironmentImpl.java:841)
at com.sleepycat.je.dbi.DbEnvPool.getEnvironment(DbEnvPool.java:222)
at com.sleepycat.je.Environment.makeEnvironmentImpl(Environment.java:267)
at com.sleepycat.je.Environment.init(Environment.java:252)
at com.sleepycat.je.rep.ReplicatedEnvironment.init(
        ReplicatedEnvironment.java:607)
at com.sleepycat.je.rep.ReplicatedEnvironment.init(
        ReplicatedEnvironment.java:466)
at oracle.kv.impl.rep.RepEnvHandleManager.openEnv(
        RepEnvHandleManager.java:628)
at oracle.kv.impl.rep.RepEnvHandleManager.renewRepEnv(
        RepEnvHandleManager.java:465)
at oracle.kv.impl.rep.RepNode.startup(RepNode.java:913)
</pre>
This has been fixed. Without the fix, a workaround for the problem is to
remove all the .jdb files on the RN node, and restart the RN.
<p>
[#26311]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 12cR2.4.4.6</u></h3>
<h3><a name="NewFeatures446">New Features</a></h3>
<ol>
<li>
Added indexing for JSON data.
<p>
As of the current release, SQL for Oracle NoSQL supports typed JSON indexes. As
their name implies, such indexes place some type-related restrictions on the
JSON data that is being indexed. Creation of a typed JSON index will fail if
the associated table contains any rows with data that violate the restrictions
imposed by the index. Similarly, an insert/update operation will be rejected
if the new row does not conform to the restrictions imposed by one or more
existing JSON indexes. However, as long as the type constraints are satisfied,
typed JSON indexes are very similar to indexes on strongly typed data, both
in the way their contents are evaluated as well as in the ways they are used
by queries.
<p>
Syntactically, the only difference between JSON and non-JSON indexes is that
a type must be specified in the CREATE INDEX statement for each index path that
indexes a JSON field. The type must be one of the JSON atomic types (a numeric
type, or string, or boolean). Such a type declaration implies that the items
returned by the index path expression, when evaluated on a table row, must be
of the specified type, or SQL NULL, or JSON null. It is also allowed for the
indexed path to not exist in the data; in this case the path expression returns
an empty result and a special (internal) value EMPTY is placed in the index.
<p>
Like non-JSON indexes, JSON indexes may be "simple" or "multikey". The later
are used to index all the elements of an array, or all the entries of a JSON
object. An example for each kind of index is shown below. They examples use
the following table:
<pre>
create table foo (id integer,
                  firstName string,
                  lastName string,
                  address json,
                  primary key(id));
</pre>
A sample row of the above table may look like this (shown in JSON format):
<pre>
{
  "id":0,
  "firstName" : "John",
  "lastName" : "Doe",
  "address": {
    "street" : "somewhere",
    "city": "San Francisco",
    "state"  : "CA",
    "phones" : [ { "area":408,  "number":5039567, "kind":"work" },
                 { "area":415,  "number":2854026, "kind":"work" },
                 { "area":null, "number":8390129, "kind":"home" },
               ]
  }
}
</pre>
<pre>
create index idx1 on foo (address.state as string,
                          address.city as string)
</pre>
In the above index, both the <code>address.state</code> and
<code>address.city</code> paths must return strings, or NULL, or JSON null,
or EMPTY (an SQL NULL may be returned only if the top-level <code>address</code>
column is NULL). Furthermore, since the paths do not contain any multikey steps
([], or .values(), or .keys()), they must return at most one item, which
implies that none of the fields in the paths (<code>address</code>, or
<code>address.state</code>, or <code>address.city</code>) may be arrays.
<pre>
create index idx2 on foo (address.state as string,
                          address.phones[].area as integer,
                          address.phones[].kind as string)
</pre>
In the above index, the paths <code>address.phones[].area</code> and
<code>address.phones[].kind</code> are multikey, because they contain the
[] step. This implies that <code>address.phones</code> is expected to be an
array (and none of the other fields in these 2 paths can be arrays). However,
it is also allowed for <code>address.phones</code> to be a single JSON object,
or even an atomic value. In general, the index paths are evaluated the same
way as path expressions in DML queries. So, if <code>address.phones</code>
is a single object having area and kind fields, the values of these
fields will be indexed. If <code>address.phones</code> is an atomic value,
the result of the path expression is empty, and EMPTY will be placed in the
index.
[#25509]
</li>
<li>
An EMPTY value is used internally to represent cases where an expression
returns an empty result. Applications do not normally have to deal with
EMPTY values. The only exception is in IndexKey instances: when a
TableIterator is used to scan an index and return index keys, the EMPTY
value may appear in the returned IndexKey instances.
The <code>FieldValue.isEMPTY()</code> method can be used to check if the
value of an IndexKey field is EMPTY. Applications may also use the
<code>IndexKey.putEMPTY()</code> method to search an index for entries
containing the EMPTY value in one or more of their fields.
[#25509]
</li>
<li>
Added NUMBER data type.  The NUMBER data type represents the
java.math.BigDecimal value. It can be used as a universal numeric type
that can handle numeric values of any size and precision.  A field of
type NUMBER can be used as a field of a primary key or an index key.
All query expression that work on numbers have been extended to handle
NUMBER values as well. [#25447]
</li>
<li>
Added operators IS NULL and IS NOT NULL in SQL for NoSQL. As in standard
SQL, the operators test whether the result of an expression is (or is not)
the SQL NULL. The operators are "sargable", that is, they can be evaluated
as conditions on index keys, if appropriate indexes exist. [#25809]
</li>
<li>
Indexing of NULL values was introduced in 4.2. However, in 4.2 and 4.3 NULL was
also used to index "missing" values, or more precisely, in cases where the
evaluation of an index path on a row would return an empty result (EMPTY). In
the current release, NULL and EMPTY are indexed separately. This is required
to make the IS (NOT) NULL operators sargable.  To see why, consider the
following example:
<pre>
create table foo (id integer, map MAP(RECORD(f1 integer, f2 integer)))

create index idx on foo (map.somekey.f1)

select * from foo where map.somekey.f1 IS NULL

Row R1: { "id" : 1, "map" : null }

Row R2 : { "id : 2, "map" : { } }

Row R3 : { "id : 3, "map" : { "somekey" : {"f2" : 10} } }
</pre>
Rows R1 and R3 are in the result set of the query, but not R2 (because on R2,
map.key.f1 returns EMPTY).
<p>
In 4.2, the index will contain NULL for all of the above rows. In the current
release, it will contain NULL for R1 and R3, and EMPTY for R2. So, in the
current release, the index can be used to optimize the query. [#25509]
</li>
<li>
Allow quoted strings as steps in index paths. This is needed to be able to
index a specific entry of a map, when the key of that entry in not a simple
identifier. For example:
<pre>
CREATE TABLE Foo(id INTEGER, map MAP(INTEGER)), primary key(id))

create index idx on Foo (map."@abc")
</pre>
<p>
Prior to this release, creating the above index was not possible, because
quoted strings were not allowed as steps. An attempt to use the path
<code>map.@abc</code> would fail, because <code>@abc</code> is not a valid
identifier (due to the '@' char). [#25854][#25958][#25963][#25974]
</li>
<li>
Any escape sequences that appear in string literals inside a query are converted
(inlined) to their corresponding unicode character when the query is parsed.
This is required, because the JSON data model applies the same conversion. So,
for example, when JSON text is loaded into Oracle NoSQL, any escape sequences
in the JSON text are inlined. As a result, the string literal appearing in
queries must have the same "format" internally, as the one used by the stored
data. [#25767]
</li>
<li>
Added a new plan <code>plan network-restore</code> to perform network restore
from one RepNode to another within the same shard. This plan can be used to
restore data from a secondary node to a primary RepNode; restore a replica
from another one if the shard lose quorum and no master available and also
could be used to restore a RepNode having corrupted data. [#25834]
</li>
<li>
Since this release, configuration files of storage node, Admin, RepNode and
security are set to owner read only by default. For example, the "config.xml"
in root directory and "security.xml" in security configuration directory.
[#25835]
</li>
<li>
Oracle NoSQL Database store passwords of users after hashing in the security
metadata database, the hashing algorithm was using PBKDF2WithHmacSHA1. Since
this release, replace with stronger algorithm PBKDF2WithHmacSHA256. Note that
this change won't update hashes of existing user passwords. It's recommended to
update user passwords to make use of the new algorithm after upgrade. [#26014]
</li>
<li>
Supports the "describe table" and "describe index" output in tabular
format. [#25720]
</li>
<li>
Displays the "describe table" and "describe index" output in tabular format. [#25720]
</li>
<li>
The progress of a plan will be available via JMX. A JMX notification is generated to
report on the status of a plan and its associated tasks for both serial and parallel
plans. It reports on both the general tasks as well as tasks associated with
elasticity operations such as migrate partition as shown in the sample out below.
<pre>
{
  "planId": 17,
  "planName": "Deploy Topo (17)",
  "reportTime": 1483445963460,
  "state": "RUNNING",
  "attemptNumber": 1,
  "migratePartition_Total": 150,
  "generalTask_Total": 14,
  "migratePartition_Successful": 15,
  "generalTask_Successful": 13,
  "migratePartition_Running": 135,
  "generalTask_NotStarted": 1
}
</pre>
 [#25200]
</li>
</ol>
<h3><a name="BugFixes446">Bug and Performance Fixes</a></h3>
<ol>
<li>
In previous releases, the "covering index" optimization was not being considered
for queries that did not have a WHERE clause. This has been fixed in the
current release. As a result, a query like <code>select id1 from foo</code>,
where "id1" is a primary key column of table "foo", will be evaluated by a
keys-only scan over the primary index of the table, instead of retrieving all
the table rows. [#25509]
</li>
<li>
A bug has been fixed for order-by queries where the order-by clause includes
primary-key columns. Because sorting is indexed-based, <b>all</b> of the
indexed fields must appear in the order-by clause, before the primary-key
columns. Otherwise, the query should be rejected. This restriction was not
enforced in prior releases, which could lead to wrongly sorted results. [#25509]
</li>
<li>
Certain combinations of queries and indexes on maps would cause ar error
during query execution. The most important case is when an index indexes
more than 2 specific keys of a map and a query is using the index to evaluate
one or more of its expressions during the index scan using only the index fields
(without the need to retrieve the full table row). Here is an example that
demonstrates such a case:
<pre>
CREATE TABLE Foo(
   id INTEGER,
   g  LONG,
   rec RECORD(a INTEGER,
              b ARRAY(INTEGER),
              c MAP(RECORD(ca INTEGER, cb INTEGER, cc INTEGER, cd INTEGER))),
primary key(id))

create index idx on Foo (rec.c.key1.ca, rec.c.key2.ca, rec.c.key3.cb)
</pre>
<p>
Query:
<p>
<code>
select id
from Foo f
where f.rec.c.key1.ca >= 3 and f.rec.c.key2.ca = 20
</code>
<p>
In this query, the 1st predicate in the WHERE clause is used as the start
condition for the index scan. This does not cause any problems. The problem
is caused by the 2nd predicate, which  is used as a "filtering" predicate:
it is evaluated as the index is being scanned, using the 2nd field
("rec.c.key2.ca") of the current index entry. Furthermore, the index indexes
3 specific map keys ("key1", "key2", and "key3"). If the path "rec.c.key3.cb"
was not part of the index definition, the bug would not show up.
[#25822]
</li>
<li>
The fact that map keys are case-sensitive was not taken into account when
the query processor would consider using an index on a specific map key.
This could lead to the wrong index being used by a query. For example:
<pre>
CREATE TABLE Foo (id INTEGER, map MAP(INTEGER), primary key(id))

CREATE INDEX idx ON Foo (map.SomeKey)

select id
from Foo f
where f.map.somekey = 3
</pre>
The above query would use the index. But this would be wrong because the map
keys "SomeKey" and "somekey" are not the same.
<p>
The case-sensitivity of the map keys was also not taken into account when,
during and INDEX CREATE statement, a check is made to see if an index with
the same fields exists already.
[#25959]
</li>
<li>
Elimination of duplicate query results was not done in some cases. Specifically,
if a query used a multikey index and no predicates were pushed to that index,
duplicate elimination was not done. An index will be used by a query, even if
no predicates are pushed into ti, if the index is used for sorting (order-by
queries) or if its use is forced by an index hint. [#26008]
</li>
<li>
Fixed several bugs in comparison operators. The bugs can cause a
query to return wrong results or raise an NPE. Fortunately the bugs show
up in corner cases only. [#25832]
<ul>
<li>
A bug can occur when long or double literal is compared with an expression
whose type is integer or float, respectively, and the long/double literal
is outside the range of integers/floats. Furthermore, the expression must
return one or more NULLs, or an empty result, or more than one items and
the operator is a value comparison operator.
</li>
<li>
A bug can occur when long or double literal is compared via != or !=any with
an expression whose type is integer or float, respectively, and the long/double
literal is outside the range of integers/floats.
</li>
<li>
A bug occurs when JSON null is compared with an expression whose
type does not contain JSON null, and either (a) the expression returns SQL
NULL, or (b) the expression returns EMPTY (the empty sequence) and the
comparison operator is !=any.
</li>
<li>
A bug occurs when a multi-valued path expression is compared
with a const, the path expression matched a multi-key path of an index,
the query will use that index, and the comparison predicate is converted
to a start/stop condition for the index scan. For example, t.array[] = 5
where "array" is a column of table t with type array(integer). Normally,
this predicate will raise an error if there is any row where the array
contains more than 1 elements. However, if there is also an index on
"array" and the predicate is pushed to that index, the error could be lost,
and the query would return a result.
</li>
</ul>
</li>
<li>
Fixed a compilation bug in array filter expression, when the input expression
has EMPTY type. For example, the following query will raise an
EmptyStackException:

select f.info.children.keys().age[$element > 4]
from foo f

In the path expression appearing in the SELECT clause, the keys() step will
always return a bunch of strings. As a result, the .age step on those strings
will always an empty result. So, the compiler would assign the type EMPTY to
the f.info.children.keys().age expression. This was not handled correctly by
the following array-filter step ([$element > 4]). [#25877]
</li>
<li>
The code that parses JSON text and maps it to a strongly-typed table schema
was not handling invalid JSON documents correctly. This has been fixed in this
release. [#25842]
</li>
<li>
Clarified in the documentation that the values returned
by <code>toByteArray</code> (and related) methods are not guaranteed to
work with older releases.  Byte array values created with either the
current or earlier releases can passed to the associated methods that
accept byte array values for the current or later releases, but values
created by later releases are not guaranteed to be compatible when
passed to methods for earlier releases.
<p>
These are the affected methods:
<ul>
<li><code>Consistency.toByteArray</code> and <code>fromByteArray</code>
<li><code>Durability.toByteArray</code> and <code>fromByteArray</code>
<li><code>ExecutionFuture.toByteArray</code>
  and <code>KVStore.getFuture</code>
<li><code>Key.toByteArray</code> and <code>fromByteArray</code>
<li><code>KeyRange.toByteArray</code> and <code>fromByteArray</code>
<li><code>Value.toByteArray</code> and <code>fromByteArray</code>
<li><code>Version.toByteArray</code> and <code>fromByteArray</code>
</ul>
<li>
Fixed the RMI registry filter issue occurs while running a secure store
with Java SE Development Kit 8, Update 121 (JDK 8u121), which is caused by
the Java new feature called RMI better constraint checking. The fix is to
add patterns <code>oracle.kv.**;java.lang.Enum</code> to RMI registry filter
<code>sun.rmi.registry.registryFilter</code> automatically if they are not
present while starting a Storage Node Agent for both secure and non-secure
stores. [#25923]
</li>
<li>
Changed the SSL cipher suites preference order to favor suites using GCM cipher
algorithm mode if no user-specified cipher suite is configured. In our
experimental performance test, it is tracked that suites using GCM provide
better performance, particularly on hardware with limited sources of secure
randomness. [#25949]
</li>
<li>
Changed the error message when issue a query on a closed store handle to be more
understandable. [#25883]
</li>
<li>
Fixed the issue that failover operation may fail if a secondary zone has more
recent data than existing alive primary zones. The fix added potential data
loss verification to detect if there is a data loss after failover. To retain
data in secondary zones, users need to perform network restore first from
leading secondary nodes to primaries. If not,specify force and re-execute the
failover plan. [#24772]
</li>
<li>
Fixed the issue that the '0.0' in JSON string is failed to be parsed as a float value.
[#25983]
</li>
<li>
Fixed the issue that restarting a secured KVLite in EE version may fail with
IllegalStateException "Unable to access the configured wallet store". This is
due to concurrent attempts to open the wallet file.[#25990]
</li>
<li>
Upgraded the Elasticsearch library to v2.4.4. [#25943]
</li>
<li>
Fixed the issue where the Admin failed to restart on a IllegalCommandException.
When an Admin node restarts and becomes a master, it restarts all the plans that
were running at the time of failover. Prior to this fix If
IllegalCommandException occurred during the restarting of a plan, the Admin may
fail to restart. [#26022]
</li>
<li>
Fixed the issue for bulk put API where the entries with duplicate key supplied
by a single stream are marked as existed before the key is actually found in
store. [#25903]
</li>
</ol>
<h3><a name="Utilities446">Utility Changes</a></h3>
<ol>
<li>
Change field name from "datetime" to "reportTime" in following type of SN JMX
notification JSON format data.
<ul>
<li>oracle.kv.repnode.opmetric</li>
<li>oracle.kv.repnode.envmetric</li>
<li>oracle.kv.repnode.replicationstate</li>
<li>oracle.kv.repnode.status</li>
<li>oracle.kv.plan.status</li>
</ul>
[#25979]
</li>
<li>
Added "put" command to sql shell to put row(s) into the named table:
<code>
put -table &lt;name&gt; [-json &lt;string&gt; | -file &lt;file&gt; [JSON | CSV]]
</code>
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 12cR1.4.3.11</u></h3>
<h3><a name="BugFixes4311">Bug and Performance Fixes</a></h3>
<ol>
<li>
Updates to improve security related to JLine and the shell command line
history. [#25940]
</li>
<li>
Fixed an RMI registry filter failure that could occur when running the
Oracle NoSQL Database in a secure configuration using Java SE
Development Kit 8, Update 121 (JDK 8u121). The failure was caused by the
new <i>RMI better constraint checking</i> feature. The fix adds the
patterns <code>oracle.kv.**;java.lang.Enum</code> to the RMI registry filter
<code>sun.rmi.registry.registryFilter</code> automatically if they are
not present when starting a Storage Node Agent.
<p>
The failures would produce stack traces like the following:
</p>
<pre>
Jan 25, 2017 11:15:45 AM java.io.ObjectInputStream filterCheck
INFO: ObjectInputFilter REJECTED: class java.lang.Enum, array length: -1, nRefs: 14, depth: 4, bytes: 768, ex: n/a
KVLite: exception in start: java.rmi.RemoteException: Can't rebind snaService at localhost:5000 csf: &lt;SSLClientSocketFactory name=$|sna|main id=1690670528 connectMs=0 readMs=0 kvStoreName=null clientUse=USER&gt; ssf: &lt;SSLServerSocketFactory backlog=1024 port range=0,0 ssl control = oracle.kv.impl.security.ssl.SSLControl@5836ad63&gt;; nested exception is:
	java.rmi.ServerException: RemoteException occurred in server thread; nested exception is:
	java.rmi.UnmarshalException: error unmarshalling arguments; nested exception is:
	java.io.InvalidClassException: filter status: REJECTED
	at oracle.kv.impl.util.registry.RegistryUtils.rebind(RegistryUtils.java:853)
	at oracle.kv.impl.sna.StorageNodeAgent.bindUnregisteredSNA(StorageNodeAgent.java:974)
	at oracle.kv.impl.sna.StorageNodeAgent.startupUnregistered(StorageNodeAgent.java:793)
	at oracle.kv.impl.sna.StorageNodeAgent.start(StorageNodeAgent.java:624)
	at oracle.kv.impl.sna.StorageNodeAgentImpl.start(StorageNodeAgentImpl.java:133)
	at oracle.kv.util.kvlite.KVLite.startSNA(KVLite.java:298)
	at oracle.kv.util.kvlite.KVLite.start(KVLite.java:524)
	at oracle.kv.util.kvlite.KVLite.start(KVLite.java:513)
	at oracle.kv.util.kvlite.KVLite.main(KVLite.java:647)
	at oracle.kv.impl.util.KVStoreMain$1.run(KVStoreMain.java:190)
	at oracle.kv.impl.util.KVStoreMain.main(KVStoreMain.java:477)
Caused by: java.rmi.ServerException: RemoteException occurred in server thread; nested exception is:
	java.rmi.UnmarshalException: error unmarshalling arguments; nested exception is:
	java.io.InvalidClassException: filter status: REJECTED
	at sun.rmi.server.UnicastServerRef.oldDispatch(UnicastServerRef.java:460)
	at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:294)
	at sun.rmi.transport.Transport$1.run(Transport.java:200)
	at sun.rmi.transport.Transport$1.run(Transport.java:197)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.Transport.serviceCall(Transport.java:196)
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:683)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
	at sun.rmi.transport.StreamRemoteCall.exceptionReceivedFromServer(StreamRemoteCall.java:276)
	at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:253)
	at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:379)
	at sun.rmi.registry.RegistryImpl_Stub.rebind(Unknown Source)
	at oracle.kv.impl.util.registry.RegistryUtils$ExceptionWrappingRegistry.rebind(RegistryUtils.java:1339)
	at oracle.kv.impl.util.registry.RegistryUtils.exportAndRebind(RegistryUtils.java:1184)
	at oracle.kv.impl.util.registry.RegistryUtils.rebind(RegistryUtils.java:849)
	... 10 more
Caused by: java.rmi.UnmarshalException: error unmarshalling arguments; nested exception is:
	java.io.InvalidClassException: filter status: REJECTED
	at sun.rmi.registry.RegistryImpl_Skel.dispatch(Unknown Source)
	at sun.rmi.server.UnicastServerRef.oldDispatch(UnicastServerRef.java:450)
	at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:294)
	at sun.rmi.transport.Transport$1.run(Transport.java:200)
	at sun.rmi.transport.Transport$1.run(Transport.java:197)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.Transport.serviceCall(Transport.java:196)
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:683)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.io.InvalidClassException: filter status: REJECTED
	at java.io.ObjectInputStream.filterCheck(ObjectInputStream.java:1244)
	at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1832)
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1713)
	at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1829)
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1713)
	at java.io.ObjectInputStream.readEnum(ObjectInputStream.java:1938)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1532)
	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2231)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2155)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2013)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1535)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:422)
	at sun.rmi.transport.tcp.TCPEndpoint.read(TCPEndpoint.java:555)
	at sun.rmi.transport.LiveRef.read(LiveRef.java:292)
	at sun.rmi.server.UnicastRef2.readExternal(UnicastRef2.java:78)
	at java.rmi.server.RemoteObject.readObject(RemoteObject.java:455)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2122)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2013)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1535)
	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2231)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2155)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2013)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1535)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:422)
	... 15 more
</pre>
<p>
[#25923]
</p>
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 12cR1.4.3.10</u></h3>
<h3><a name="NewSQLFeatures4310">New Features in SQL for Oracle NoSQL</a></h3>
<ol>
<li>
JSON data type and querying of JSON data.
<p>
JSON can be used as the data type of a top-level table column, of a nested
record field, or as the element type of an array or map. JSON is an abstract
type: the actual value stored in a field of type JSON can be a valid json
atomic value (integer, long, double, string, boolean, or the json null value),
or an array, or a map. If the value is an array/map, the element type of the
array/map will also be JSON. This implies that, unlike their fixed-schema
counterparts, arrays and maps of JSON can contain heterogeneous elements.
<p>
On input, JSON data is passed to Oracle NoSQL as a string or a text stream.
In both cases, the text is parsed internally, and its constituent parts are
converted to a tree of maps, array, and atomic value instances. Direct
construction of JSON trees is also possible via APIs that construct and
connect maps, array, and atomic values. For persistent storage, the tree
is serialized into a binary format.
<p>
JSON data is schemaless, in the sense that a field of type JSON can have
very different kind of values in different table rows. For example, if
"info" is a top-level table column of type JSON, in one row the value of
"info" may be an integer, in another row an array containing a mix of doubles
and strings, and in a third row a map containing a mix of other maps, arrays,
and atomic values. Furthermore, the data stored in a JSON column or field, can
be updated in any way that produces a still valid JSON instance. As a result,
each JSON tree (either in main memory or as a serialized byte array on disk)
is self-describing with regard to its contents.
<p>
SQL for Oracle NoSQL can operate seamlessly on both data models: the
strongly typed data supported in prior releases, as well as the schemaless
JSON data. Tables can mix data from both models and all of the DML expressions
can operate on both kinds of data.
[#25455]
<p>
Indexing JSON data is not supported yet.
<p>
[#25455] [#25436] [#25437] [#25727] [#25197] [#25731] [#25681] [#25683]
[#25688] [#25559] [#25740] [#25629] [#25669] [#25671]
</li>
<li>
New kinds of expressions in SQL for Oracle NoSQL.
<ul>
<li>
NOT operator.
Negates a boolean value. [#25455]
</li>
<li>
EXISTS operator.
Checks whether an expression returns at least one value. [#25455]
</li>
<li>
IS OF TYPE expression.
Checks whether a value or a set of values has a specified data type. [#25437]
</li>
<li>
CAST expression.
Casts, if possible, a value or set of values to a specified data type. [#25436]
</li>
<li>
Map constructor.
Constructs a new map value. Both the field names and the field values may
be computed by other expressions. Field values may be heterogeneous.
[#25455] [#25629]
</li>
<li>
CASE expression.
Implements if-then-else semantics. [#25197]
</li>
<li>
json null value and true/false literals.

The (case-insensitive) keywrods null, true, and false can be used as literals
in a query. These are the only reserved keywords in SQL for NoSQL. DML operators
and expressions were extended, if needed, to handle the new json null value.
[#25455] [#25731] [#25683]
</li>
</ul>
<li>
TIMESTAMP data type and values.
A timestamp represents a point in time. It contains a date and a time. The
date part has 3 components: year, month, and day of month. The time part has
4 components: hour, minute, second, and a decimal fraction of the second.
The number of digits used to represent the fraction of a second is called
the precision of the timestamp, and it can be a number between 0 (no fractional
second) to 9 (nano second precision). Fields of timestamp types can be indexed
and accessed in SQL queries. The SQL comparison operators have been extended
to compare timestamps, and the cast operator can cast strings of appropriate
formats to timestamp values.
[#24775] [#25707]
</li>
</ol>
<h3><a name="SQLChanges4310">Other Changes in SQL for Oracle NoSQL</a></h3>
Several of the pre-existing expressions in SQL for Oracle NoSQL have changed
in this release, mostly to make such expressions more "JSON friendly". Some
of these changes are backwards incompatible and applications may have to
change their queries as a result.
<ol>
<li>
Implicit array construction in SELECT clause
If any expression in the SELECT list returns more than one values, an array
is constructed to contain the values. [#25455] [#25629]
</li>
<li>
Several changes in path expressions, both syntactic and semantic.
<ul>
<li>
Field steps accept atomic items as input.
A field step returns an empty result if its input is an atomic item. Previously,
an error would be raised in this case. [#25455] [#25688]
</li>
<li>
New syntax for filtering the entries of maps and records.
[#25455] [#25575] [#25740] [#25724]
<p>
Previously, square brackets ([&lt;cond>?]) were used to filter the values of
both maps and arrays. Furthermore, there was no way to filter map entries
and return the qualifying map keys (instead of the values). Finally, there
was no way to filter the entries of records. This release introduces the
.keys(&lt;cond>?) and .values(&lt;cond>?) path steps. They are both supposed to
work primarily with maps and records. .keys(&lt;cond>?) selects the map/record
entries that satisfy the condition (if any) and returns the keys (field names)
of these entries. .values(&lt;cond>?) selects the map/record entries that satisfy
the condition (if any) and returns the field values of these entries.
If the input is an array, .keys(&lt;cond>?) and .values(&lt;cond>?) are applied
recursively on the array elements. If the input is an atomic item, the result
is empty.
<p>
This change also affects DDL statements that use paths, because the syntax for
DDL paths is a subset of the DML syntax for paths. Most importantly, CREATE
INDEX statements must use the new syntax to index maps. Furthermore, applications
that access multi-key map indexes directly, via the TableIterator APIs, must be
updated to use the new path syntax to name the fields of the IndexKey instances
they build to probe the indexes (alternatively, the IndexKey fields can be
accessed by their position as well).
</li>
<li>
Filtering and slicing arrays.
The square brackets are still used to filter or slice arrays. They work the same
way as before on arrays, except that the variable $elementPos has been renamed
to $pos. However, in 4.3, the behavior is different if the input is not an
array: in this case, an array is created on the fly, and the input item is
inserted into that array; then, the filtering/slicing step operates on that
array the same way as with any other array. [#25455] [#25575] [#25740]
</li>
</ul>
</li>
<li>
Change in how the value comparison operators handle empty operands.
Previously, if an operand returned the empty result, the result of the comparison
would also be empty. In 4.3, if both operands return the empty sequence, the
operands are considered equal (so true will be returned if the operator is =,
<=, or >=). If only one of the operands returns empty, the result of the
comparison is false unless the operator is !=.
[#25763]
</li>
<li>
Change in how the value comparison operators handle incomparable values.
Previously, an error would be returned in this case. In 4.3, false is returned
as the result of the comparison.

[#25455] [#25681]
</li>
<li>
Change in how the sequence-comparison operators handle the SQL NULL
Previously, if any of the operand sequences contained NULLs, those NULLs would
just be ignored. In 4.3, if a matching pair of items is not found, and either
of the sequences contains a NULL, the result of the comparison is NULL (instead
of false).
[#25455]
</li>
<li>
Changes in array constructors.
In 4.3, queries can construct arrays containing heterogeneous items. Furthermore,
if an input expression returns an SQL NULL, the NULL is ignored (not inserted in
the constructed array). Previously, both heterogeneous items and NULLs would
cause an error to be raised.

[#25455] [#25730] [#25629]
</li>
</ol>
<h3><a name="OtherNewFeatures4310">Other New Features</a></h3>
<ol>
<li>
The information that is published to the &lt;kvroot>/log/&lt;storename&gt;.stats
and &lt;kvroot&gt;/log/&lt;storename&gt;.perf files is also available through
the NoSQL JMX agent, via the standard javax.management.Notification mechanism.
See the javadoc for oracle.kv.mgmt.jmx.StorageNodeMXBean for more information.
[#24979]
</li>
<li>
The "makebootconfig" command now enables security by default.
The <code>-store-security</code> flag is now optional, and has the
value <code>enable</code> if not specified. You can still configure a
non-secure store by specifying <code>none</code> as the value of this
flag. In addition, the "kvlite" command now creates a secure store by default.
You can create a non-secure store by specifying <code>-secure-config
disable</code>.  [#25440]
</li>
</ol>
<h3><a name="BugFixes4310">Bug and Performance Fixes</a></h3>
<ol>
  <li>Strings used as keys in the MapValue type are now case-sensitive.
  Previously they were case-insensitive, which was a bug. Applications that
  assume case-insensitivity in MapValue keys may be affected. Field names in
  Record values remain case-insensitive, as documented. [#25598]
  </li>
  <li> Tables created with map of json and array of json types will now work
  properly. Previously rows of these types would be created but could not
  be deserialized and retrieved. [#25559]
  </li>
  <li> Removed the no-longer needed MapValue.putNull method and added
  methods on MapValue, ArrayValue, RecordValue and FieldDef, to allow
  construction of JSON null values for insertion into JSON maps and arrays.
  [#25671]
  </li>
  <li> Fixed a problem where, if a table was created with fields other than
  primary key fields and it was evolved such that it contained only primary
  key fields, queries on the table could fail to return data. [#25766]
  </li>
  <li> Fixed a problem that could result in a NullPointerException on a
  RepNode processing a query if a different RepNode were to become unavailable.
  [#25792]
  </li>
  <li> Fixed a problem that could result in an ArrayIndexOutOfBoundsException
  when specifying a ReturnRow on a table where the primary key fields are not
  declared as the first fields of the table.
  [#25819]
  </li>
  <li> Implemented compatibility with pre-4.3 DDL syntax for creating map
  indexes. Syntax allowed now includes:
  <ul>
    <li>path-to-map.keys() and path-to-map.values(), which are the current/new
    syntax.
    <li>KEYOF(path-to-map)</li>
    <li>KEYS(path-to-map)</li>
    <li>ELEMENTOF(path-to-map), path-to-map[]</li>
  </ul>
  In addition, code has been added to handle pre-4.2 clients operating against
  4.2 and later indexes that support null values.
  [#25864]</li>
  <li>
  Added kvstore-ee.jar to the kvclient.jar manifest so that the Enterprise
  Edition works without the need to fix the classpath. This works in the
  Community Edition as well, where kvstore-ee.jar does not exist at all.
  </li>
<li>
Fixed a bug that "create fulltext index if not exists" throws exception if the index
exists, it should complete successfully but not require execution.
[#25664]
</li>
<li>
Fixed a query bug where an "always false" filtering step, like
<code>t.array[false].field</code>, would actually be evaluated as an "always
true" step (<code>t.array[false].field</code>). [#25708]
</li>
<li>
Fixed a query bug that would remove the entire FROM clause if the table name or
table alias was not used anywhere in the rest of the query. This would cause the
query compiler to throw an ArrayIndexOutOfBoundsException. [#25768]
</li>
<li>
Fixed a query bug that would cause a NPE when the table queried is a child table
and is used without a table alias. [#25645]
</li>
<li>
Fixed a query bug that could cause an ArrayIndexOutOfBoundsException if the
compiler could deduce that an expression would always return an empty result.
For example, an ArrayIndexOutOfBoundsException would be thrown by this query:
<code>select id[10:0] from foo f</code>[#25673]
</li>
<li>
Fixed a query bug: The fact the table names are case insensitive was not always
taken into account in resolving column reference in a query. [#25747]
</li>
<li>
Fixed a bug that would cause an IllegalCommandException to be raise for a
valid ALTER TABLE statement, when an index on an array or map existed on
the same table. [#25782]
</li>
<li>
Fixed a query bug where a NULLS LAST directive in the order-by was being
ignored, if the sort direction was DESC. Instead, an error should be thrown
in this case. [#25785]
</li>
<li>
Added new methods to the oracle.kv.table.FieldValueFactory class for
creating a TimestampValue from a Timestamp, String, or components:
<pre>
public static TimestampValue createTimestamp(Timestamp v, int precision);
public static TimestampValue createTimestamp(String s, int precision);
public static TimestampValue createTimestamp(int year, int month, int day,
                                             int hour, int minute,
                                             int second, int nano,
                                             int precision);
</pre>
<p>
Added new methods to the oracle.kv.table.TimestampValue interface to
return the components of a Timestamp value:
<pre>
public int getYear();
public int getMonth();
public int getDay();
public int getHour();
public int getMinute();
public int getSecond();
public int getNano();
</pre>
[#25654]
</li>
<li>
Fixed a bug that could result in failure in reading records from a table which
contains a map/array field with min/max contraints on its element after
upgrade from KV 3.0 to KV 4.3. [#25799]
</li>
<li>
Fixed a problem that could result in failure in table evolving when adding a
new field that contains a nested fixed_binary, enum or record field. [#25793]
</li>
<li>
Changed query shell output default from COLUMN to JSON. [#25700]
</li>
<li>
Restricted numeric type mapping in JSON to integer, long, and double.
This eliminates float as an option in JSON. [#25699]
</li>
<li>
Improved the error checking performed when processing DDL commands to
provide clearer feedback when the requested command uses a feature that
is not supported on all of the nodes in the store because of the nodes
still need to be upgraded.  [#25712]
</li>
<li>
Added checks to confirm that all shards have quorum and a majority of
nodes in each zone being changed are online before deploying a topology
that changes the type of one or more zones.  This change makes it more
likely that the topology change will detect and report, prior to making
any changes, that, given the current lack of availability of certain
replication nodes, the command will fail.  [#24503]
</li>
<li>
Fixed upgrade problem where primary key fields marked as not nullable
would cause serialization issues in queries causing them to fail. Primary keys
can no longer be explicitly marked a not nullable or with a default because
they are implicitly not nullable and cannot have default values. [#25533]
</li>
<li>
Fixed a memory leak that could, in some cases, cause an OutOfMemoryError
to be thrown when a replication node needs to do a Network Restore when
performing replication. [#25649]
</li>
<li>
Improved the ability of the Admin CLI to validate new SN parameters when
performing 'plan change-parameters' and 'change-policy' commands.  With
this change, commands that specify invalid SN parameters will fail
without modifying the parameters, rather than having the incorrect
parameters prevent SNs from being restarted.  [#25636]
</li>
<li>
Fixed a problem in the Load utility that prevented it from restoring
security information for a secure store. [#24642]
</li>
<li>
Fixed a problem that could prevent master rebalancing from working
correctly because of excessive logging by reducing redundant debug
logging entries.  [#25625]
</li>
<li>
Fixed a problem in Hive and Big Data SQL query processing where a the
SELECT clause from one query might affect the behavior of the next query
if that query did not specify a SELECT clause. [#25626]
</li>
</ol>
<h3><a name="Storage4310">Storage Engine Changes (JE 7.3)</a></h3>
<ol>
<li>
JE's low-level operation throughput statistics have been simplified and
improved. Previously, these statistics represented API calls rather than CRUD
operations and this caused confusion when a single API call performed multiple
CRUD operations. Also, some CRUD operations (key search operations on any RN
in a shard, all operations on a replica RN) were missing, and no operation
statistics were included in the admin .stat files. The JE throughput stats were
previously only visible via the env/je.stat.csv file.
<p>
Now, the following statistics representing CRUD operations are output in the
admin .stat files as well as env/je.stats.cvs, and are included for all RNs,
including replicas.  The new statistics should be considered internal
operations or internal units of work. This approach is used to allow
correlating internal operations to performance measurements.
<pre>
    priSearch
    priSearchFail
    secSearch
    secSearchFail
    priPosition
    secPosition
    priInsert
    priInsertFail
    secInsert
    priUpdate
    secUpdate
    priDelete
    priDeleteFail
    secDelete
</pre>
<p>
[#23792]
</li>
<li>
Data corruption is now detected as soon as possible by a new internal JE
background task. This detects data corruption caused by media/disk failure by
reading the log sequentially and verifying checksums. This is the equivalent of
running the JE DbVerifyLog utility, but it is performed automatically and
periodically on every RN.
<p>
By default, verification is on and occurs once a day at midnight, local time.
Although this should not normally be necessary, verification can be disabled
or the verification schedule can be changed using the JE
EnvironmentConfig.ENV_RUN_VERIFIER, VERIFY_SCHEDULE and VERIFY_LOG parameters
(je.env.runVerifier, je.env.verifySchedule and je.env.verifyLog).
<p>
When corruption is detected, the RN will be shut down and will not be restarted
automatically by the SN. A SEVERE level exception will be logged in the RN's
log and the exception message will contain the LOG_CHECKSUM token. Manual
intervention by an administrator is necessary in this situation. We do not
recommend restarting the RN without first replacing the media and/or forcing a
network restore from another node in the shard.
<p>
The advantage of performing verification frequently is that a media/disk
problem may be detected sooner than it would be otherwise. This means that the
network restore can be done while the other RNs in the shard are up, minimizing
exposure to additional failures.
<p>
[#25221]
</li>
<li>
Repeat-fault reads have been eliminated for LNs (Btree leaf nodes, which
represent record data on disk.) Previously, if an LN's on-disk size was greater
than 4kB, two reads would be required to fetch the LN from disk. The first read
would always include the log entry header, which contains the exact entry size,
and the second read (repeat-read) was needed to read the entire entry. The
second read includes the entire entry, although normally it will be cached by
the file system.
<p>
Now, only a single read is needed because the last logged size for LNs is now
stored in the Btree, and this can be used to determine the exact size needed
for the read buffer.  The benefits of this change are 1) the amount of IO is
reduced (although the repeat-read normally reads data that is cached by the
file system), and 2) the statistics describing IO activity are simpler to
analyze without the repeat-reads in the picture.
<p>
Note that INs (Btree internal nodes) can still cause repeat-reads when they are
fetched, because the last logged size for INs is not stored in the Btree.
However, in most applications all INs are cached and therefore INs are rarely
read from disk (except during a cache warm-up period). The nRepeatFaultReads
statistic (EnvironmentStats.getNRepeatFaultReads) indicates the number of
repeat-reads.
<p>
[#25387]
</li>
<li>
A network restore (data copy from one RN to another RN in a shard) may be
instigated for various reasons, for example, when a replica has been down for a
long time period and is then brought up again.  Previously, if a network
restore was interrupted and the RN was then restarted, the RN could have
attempted to operate with a partial data set, causing unpredictable results.
Now, the use of a partially restored RN is not possible, and the network
restore will automatically be restarted.  If a network restore is interrupted,
the RN's env directory will contain a marker file named 0x7fffffff.jdb, which
is recognized and managed by JE.
<p>
[#25369]
</li>
<li>
Fixed a bug that prevented the request timeout for a write operation from being
honored. Under certain circumstances, the request took longer than the
specified timeout.
[#25692]
</li>
</ol>
<h3><a name="Deprecation4310">Deprecated and Removed Features</a></h3>
<ol>
<li>
The NONE_REQUIRED_NO_MASTER
(oracle.kv.Consistency.NONE_REQUIRED_NO_MASTER) consistency policy that
requires that a read operation be serviced on a replica, never the
Master, is deprecated in this release. Applications should use the
NONE_REQUIRED consistency policy or KVStoreConfig.setReadZones instead.
</li>
<li>
The web-based Admin Console feature has been removed in this release.
Since removal of this feature also eliminates the need for the Admin's
http port, the -admin parameter of the makebootconfig command has been
deprecated.
</li>
<li>
The capability to monitor Oracle NoSQL Database via SNMP has been
removed in this release. As a result, several commands have changed
syntax; in particular makebootconfig and the change-params commands no
longer allow SNMP as an option, and have lost their SNMP-specific
flags for specifying pollport, traphost, and trapport.
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 12cR1.4.2.14</u></h3>
<h3><a name="NewFeatures4214">New Features</a></h3>
<ol>
<li>
This release introduces the Basic Edition. Basic Edition (BE) only
contains the server and is distributed under the Oracle Database
Enterprise Edition license.  The Basic Edition is functionally identical
to NoSQL Database Community Edition. [#25663]
</li>
</ol>
<h3><a name="BugFixes4214">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fix a bug that was introduced in release 4.2.10 that results in failures when
executing some Admin commands. The bug arises after an upgrade, when the store
has explicit storage directories. These are the directories used by
Replication Nodes and are specified via the <code>plan change-storagedir</code>
CLI command or the <code>makebootconfig</code> utility. After the upgrade
the <code>verify configuration</code> and some <code>plan</code> CLI commands
will fail, with an error reporting that a parameter cannot be represented as
long. [#25689]
</li>
<li>
 Fix a bug in the EXPORT utility where it no longer hangs when the number of
 tables exceeds the fixed number of threads allocated for the operation.[#25717]
</li>
<li>
Oracle NoSQL Database server will only verify the major and minor versions of
Oracle Java SE and not the patch version at <code>makebootconfig</code>
time. [#25647]
</li>
<li>
Primary keys are implicitly not nullable but also have no default values. Marking
primary key fields as not nullable or with default values is no longer allowed and
the table schema reflects that. This also fixed an upgrade issue related to allowing
this in earlier releases.
[#25533]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.4.2.10</u></h3>
<h3><a name="NewFeatures4210">New Features</a></h3>
<ol>
<li>
The topology builder has been enhanced to take storage directory sizes into
account when laying out shards and partitions. What this means is a RepNode
with larger storage directory will be assigned a larger portion of the store's
data than a RepNode with smaller directory. Storage directory size layout will
happen automatically during elasticity operations when directory sizes have
been configured. To enable this feature on an existing store the size of
storage directory for each RepNode needs to be set, usually by the
administrator. Then a rebalance, redistribute, or contract topology operation
will adjust the shards and/or partitions to account for differences in
directory sizes.
<p>
To set or change the directory size on existing stores there is a new
<code>-storagedirsize</code> flag on the <code>plan change-storagedir</code>
Admin CLI command. To set the directory size on a new configuration the flag
<code>-storagedirsize</code> has been added to
<code>makebootconfig</code>. Both flags can accept size values with units, for
example: "1_TB" can be used to specify a 1 terabyte directory.
[#24981] [#25166]
</li>
<li>
DDL operations are now logged with the standard audit logging prefix,
"<i>timestamp</i> KVAuditInfo", to support searching and filtering.
[#25460]
</li>
<li>
Added Arbiter functionality. Using this feature, KVStore DML operations using
Durability.ReplicaAckPolicy.SIMPLE_MAJORITY durability succeeds even with one
RepNode node unavailable in a shard. The data written with "relaxed" durability
will be migrated to the other RepNode when it becomes available. Also, only the
node with the "relaxed" durability data can become master until the data is
migrated to the other RepNode. This fact relaxes the write availability to a
single node failure as opposed to write availability with any node failure
(on a shard basis).  [#20590]
</li>
<li>
Added the new 'topology contract' command to the Administrative CLI.
This command provides support for removing a specified set of storage
nodes from the topology and shrinking the size of the store by removing
shards.  Also added the new 'pool leave' command to simplify the process
of specifying which storage nodes should be removed.  [#24425]
</li>
<li>
Secondary indexes now contain entries for rows that have null values for
index fields. This serves two purposes:
<ol>
  <li>It means that an index will have an entry for every row in the table,
  regardless of values, which was not true previously</li>
  <li>It makes composite indexes (those with multiple fields) more useful
  because an application can use a partial key and know that rows will
  not be skipped because of a null in another field</li>
</ol>
<p>
This change required a modification of the format of the index databases
themselves. All new indexes will have this new format and will support
null values. Existing indexes cannot support null values and will continue
to operate as they have in the past, without nulls. For this reason, it is
recommended that indexes be dropped and re-added if null values are desired.
[#24785]
</li>
<li>
Added new policy parameters that permit administrators to enforce
password complexity requirements when users create a new passwords or
change existing passwords.  [#24985]
</li>
<li>
Added new position-based put and get methods on RecordValue that work more
efficiently than the name-based methods if the application knows the position
of a field within a RecordValue. [#25214]
</li>
<li>
Includes a preview release of Java API support for a field type of JSON. Use of
this type is for preview only.  Any stores that use this type will <em>not</em>
be supported, and must be removed and not re-used when full support is
provided. This preview includes
<ul>
  <li> The ability to declare a field as type JSON. Doing so means that any type
  that can be interpreted as valid JSON can be used in this field, including the
  numeric types, boolean, string, map (JSON object), array (JSON array).
  </li>
  <li> Methods on FieldDef and FieldValue and related types to put and get
  JSON values as well as to navigate into JSON fields in a Row.
  </li>
</ul>
The preview release has the following known limitations and issues, which can
result in failures or unpredictable results:
<ul>
  <li>Indexes into JSON are not yet supported. This is a feature that will be
  supported in a future release.
  </li>
  <li>Queries involving JSON are not yet supported, and will fail to compile
  and/or execute. This is a feature that will be supported in a future release
  </li>
  <li> Not all numeric values in JSON are supported. Any number that cannot be
  represented as a long or double will fail to be handled. This feature will be
  supported in a future release.
  </li>
  <li>Map keys are case-insensitive, which extends to JSON objects. This is a
  bug and will be fixed in a future release.
  </li>
  <li>Support for declarations of MAP(JSON) and ARRAY(JSON) in fields is not
  complete. These declarations will work in DDL statements, but rows in such
  tables will not be usable and must be avoided. This is a bug and will be
  fixed in a future release.
  release.
  </li>
</ul>
[#23589]
</li>
</ol>
<h3><a name="BugFixes4210">Bug and Performance Fixes</a></h3>
<ol>
<li>
Enhanced the Load utility to use a disk-ordered cursor to read entries
from multiple databases of snapshot.  This change improves the input
throughput, thus improving the overall performance of loading. [#25294]
</li>
<li>
Fixed a problem where specifying a large value for the rnHeapMaxMB
storage node parameter could result in the replication nodes hosted by
that storage node being given heap sizes that do not support compressed
object references, even though a smaller heap size that supports
compressed object references would be more efficient. [#25472]
</li>
<li>
Fixed a bug that the TextIndexFeeder failed to act accordingly when the
topology changed and partition migrated between replication groups. The
fix ensures that the TextIndexFeeder will stream all writes to
Elasticsearch when the store undergoes elasticity operations. [#25334]
</li>
<li>
Fixed a problem where an unexpected InsufficientAcksException caused by
a lack of shard quorum during an access control change could cause a
replication node to be restarted. [#25439]
</li>
<li>
Fixed a problem where a lack of shard quorum during an access control
change could result in a temporary deadlock and an unexpected
InsufficientAcksException. [#25442]
</li>
<li>
Fixed a problem where an upgrade of a 3.x version store would fail if
the store contained a table that previously had been schema
evolved. [#25532]
</li>
<li>
Disable full text search (FTS) in secure store. If a KV store is
configured as a secure store, FTS will be disabled and user will not be
allowed to register an external Elasticsearch cluster. In addition, for
a KV store in which FTS is already enabled, user will not be able to
re-configure the store from a non-secure to a secure store. Instead,
she need to drop all text indices, deregister the external Elasticsearch
cluster, and re-configure the non-secure store to a secure store.
[#25245][#25246]
</li>
<li>
RepNodes are now configured to use the Java option -XX:+AlwaysPreTouch
by default on Linux platforms when using the Oracle Java virtual
machine. This change slows Java startup slightly (roughly 10 sec for a
32GB heap using 4K pages and less than 1 sec if using 2MB Large pages),
but reduces subsequent latency pauses as larger amounts of heap storage
are used by the RepNode. [#25161]
</li>
<li>
RepNodes now use the Garbage First Garbage Collector (G1 GC) by default.
The G1 GC typically provides shorter GC pause times than the Concurrent
Mark Sweep (CMS) collector, which was the previous default.  As a
result, the G1 GC should reduce both average and peak latency for store
operations, and improve throughput.
<p>
Applications can revert to the previous GC settings using the CMS GC by
including <code>-XX:+UseConcMarkSweepGC</code> in the value of the
RepNode <code>javaMiscParams</code> parameter. [#24695]
</li>
<li>
The representation of IndexKey has been changed in an incompatible manner.
The reason is a combination of ease of use, function, and performance.
Prior to this release an IndexKey shared schema (the RecordDef) with
the corresponding Row objects for the same table. The old
representation was confusing and cumbersome in the face of indexes on fields
in deeply nested records, maps, and arrays. The new representation is a
<em>flattened</em> version of the fields indexed, with only a single level
of structure, where the field name is a path to the indexed field.
<p>
Consider this table and index:
<pre>
  CREATE TABLE user (id INTEGER, PRIMARY KEY(id), address RECORD(city String, state String))
  CREATE INDEX City on user(address.city)
</pre>
Prior to this release the Java code required to create an IndexKey used to
iterate the City index would look like this:
<pre>
  /* assume userTable is a handle on the table */
  Index index = userTable.getIndex("City");
  IndexKey indexKey = index.createIndexKey();
  indexKey.createRecord("address").put("city", "Chicago");
</pre>
Note the need to create the <em>structure</em> of the record to use it.
The new flattened representation is:
<pre>
  /* assume userTable is a handle on the table */
  Index index = userTable.getIndex("City");
  IndexKey indexKey = index.createIndexKey();
  indexKey.put("address.city", "Chicago");
</pre>
The syntax for indexes involving maps and arrays is as follows:
<ul>
  <li> Map keys:  <em>keys(path-to-map-field)</em>.
  For example <em>keys(this_is_a_map)</em></li>
  <li> Map values: <em>path-to-map-field[]</em>. For example,
  <em>this_is_a_map[]</em>.
  If the index is on a field within a map of records it would look like
  <em>map_of_records[].path-to-field</em>
  <li> Array values: these are similar to map values and require use of "[]":
  <em>path-to-array[]</em>.
</ul>
The same syntax rules are used for these paths as are used in the
statements that create the indexes themselves.  Similar syntax works for
indexes on other complex types such as maps and arrays.
<p>
This is an incompatible change and will require any applications that use indexes
on complex types to be modified to use the new format and syntax. If unchanged,
errors will be seen as IllegalArgumentException thrown from
IndexKey.put*() calls as well as FieldRange construction for such fields.
Applications that do not use indexes on records, maps, or
arrays will continue to work without modification. See the documentation for
details on how to represent paths to complex index fields.
[#25090]
</li>
<li>
Changed to allow an existing client to access store without reopening a KVStore
handle during updating SSL certificate of a secure store.  [#25062]
</li>
<li>
The exception, KVSecurityException, extended FaultException, which was not
correct, according to the contract for FaultException. KVSecurityException
now extends RuntimeException.
<p>
This is a minor API change but it affects the possible exceptions thrown
from most of the methods on the KVStore and TableAPI interfaces. They can
now throw KVSecurityException, which no longer falls under the umbrella of
FaultException. Applications that need to catch one or more of the
KVSecurityException instances &mdash; UnauthorizedException,
AuthenticationRequiredException, and AuthenticationFailureException &mdash;
need to do so explicitly. [#24967]
</li>
<li>
To make text indexing more efficient, index population now uses
Elasticsearch's bulk operations interface. [#25040]
</li>
<li>
Duplicate results from map and array indexes have been eliminated. Previously,
when performing a query involing map value or array indexes, it was possible
to see duplicate results for rows that have multiple independent entries in
the index. This would occur when using the index iteration methods as well.
These duplicates are now removed so that the user will see only one instance
of each matching record. [#25023]
</li>
<li>
To avoid a compatibility issue, NoSQL Database by default now connects
to an Elasticsearch cluster via Elasticsearch's Transport Client
rather than its Node Client. [#25146]
</li>
<li>
Records that contain only empty strings in text-indexed fields are now
correctly added to the text index. Previously, such records were
omitted. [#25058]
</li>
<li>
Two race conditions that could occur during text index creation have
been fixed. [#25093] [#25182]
</li>
<li>
The size of the service port range required for storage nodes has been
reduced.  Previously, when -servicerange was used when calling
makebootconfig to configure a storage node that hosts an admin, the
range required 8 ports for a non-secure deployment.  That number has now
been reduced to 3.  For details, see the documentation for the
servicePortRange parameter in the section on
<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSADM-GUID-E5F09161-ABD3-4F8A-8EF8-26271EB82116">
Storage Node Parameters</a> in the Admin Guide. [#24708]
</li>
<li>
Allow the anonymous user to use a DDL statement in the Admin CLI to
create the first user for a secure store. [#25051]
</li>
<li>
Fixed a problem where a client with an incorrect set of helper hosts
could cause replication nodes to fail and not restart.  The problem
could occur if the client was configured with helper hosts from
unrelated stores and attempted to forward topology updates obtained from
one store to another store.  Such an occurrence is now logged but no
longer causes the replication node to fail.  [#24693]
</li>
<li>
Changed the maximum value of the memoryMB parameter from 500 GB to 128
TB, to accommodate machines with large amounts of memory.  [#25017]
</li>
<li>
Fixed a problem in the statistics gathering code that could cause a
replication node to fail because of an unexpected InterruptedException:
<pre>
2016-04-12 13:34:42.678 UTC INFO [rg1-rn3] Exception accessing the migration db {0}
com.sleepycat.je.ThreadInterruptedException: (JE 7.0.5) Environment must be closed, caused by: com.sleepycat.je.ThreadInterruptedException: Environment invalid because of previous exception: (JE 7.0.5) rg1-rn3(3):/scratch/yfei/nftest/dm_mode/kv_isolate_rn/scratch/kvroot/mystore/sn3/rg1-rn3/env java.lang.InterruptedException THREAD_INTERRUPTED: InterruptedException may cause incorrect internal state, unable to continue. Environment is invalid and must be closed.
       at com.sleepycat.je.ThreadInterruptedException.wrapSelf(ThreadInterruptedException.java:135)
       at com.sleepycat.je.dbi.EnvironmentImpl.checkIfInvalid(EnvironmentImpl.java:1720)
       at com.sleepycat.je.Transaction.checkEnv(Transaction.java:886)
       at com.sleepycat.je.Transaction.commit(Transaction.java:350)
       at oracle.kv.impl.rep.migration.PartitionMigrations.fetch(PartitionMigrations.java:295)
       at oracle.kv.impl.rep.migration.MigrationManager$3.call(MigrationManager.java:1286)
       at oracle.kv.impl.rep.migration.MigrationManager$3.call(MigrationManager.java:1282)
       at oracle.kv.impl.rep.migration.MigrationManager.tryDBOperation(MigrationManager.java:1464)
       at oracle.kv.impl.rep.migration.MigrationManager.getMigrations(MigrationManager.java:1282)
       at oracle.kv.impl.rep.migration.MigrationService.pendingSources(MigrationService.java:180)
       at oracle.kv.impl.rep.migration.MigrationManager.awaitIdle(MigrationManager.java:445)
       at oracle.kv.impl.rep.table.MaintenanceThread.run(MaintenanceThread.java:149)
</pre>
[#25046]
</li>
<li>
Fixed an unhandled security exception in the master rebalancing code
that could cause a replication node to fail unexpectedly when a storage
node is being restarted. [#25134]
</li>
<li>
Fixed a problem where a replication node in a secure store could exit
with a NullPointerException if it received a request before it is fully
initialized.
<pre>
2016-05-03 18:08:42.191 UTC SEVERE [rg5-rn3] Process exiting
java.lang.NullPointerException
at oracle.kv.impl.rep.login.KVSessionManager.initializeKVStore(KVSessionManager.java:495)
at oracle.kv.impl.rep.login.KVSessionManager.isReady(KVSessionManager.java:259)
at oracle.kv.impl.rep.login.KVSessionManager.resolve(KVSessionManager.java:425)
at oracle.kv.impl.security.login.TokenResolverImpl.resolvePersistentToken(TokenResolverImpl.java:216)
at oracle.kv.impl.security.login.TokenResolverImpl.resolve(TokenResolverImpl.java:168)
at oracle.kv.impl.security.login.TokenVerifier.verifyToken(TokenVerifier.java:97)
at oracle.kv.impl.security.AccessCheckerImpl.identifyRequestor(AccessCheckerImpl.java:141)
at oracle.kv.impl.security.ExecutionContext.create(ExecutionContext.java:181)
at oracle.kv.impl.security.SecureProxy$CheckingHandler$1.execute(SecureProxy.java:609)
at oracle.kv.impl.security.SecureProxy$CheckingHandler$1.execute(SecureProxy.java:600)
at oracle.kv.impl.fault.ProcessFaultHandler.execute(ProcessFaultHandler.java:148)
at oracle.kv.impl.rep.admin.RepNodeAdminFaultHandler.execute(RepNodeAdminFaultHandler.java:124)
at oracle.kv.impl.security.SecureProxy$CheckingHandler.invoke(SecureProxy.java:598)
at oracle.kv.impl.security.SecureProxy.invoke(SecureProxy.java:144)
at com.sun.proxy.$Proxy9.getTopoSeqNum(Unknown Source)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:323)
at sun.rmi.transport.Transport$1.run(Transport.java:200)
at sun.rmi.transport.Transport$1.run(Transport.java:197)
at java.security.AccessController.doPrivileged(Native Method)
at sun.rmi.transport.Transport.serviceCall(Transport.java:196)
at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568)
at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826)
at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:683)
at java.security.AccessController.doPrivileged(Native Method)
at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
at java.lang.Thread.run(Thread.java:745)
</pre>
[#25092]
</li>
<li>
Added TableOperationResult.getPreviousExpirationTime() to return the
expiration time of a previous row, if defined. Previously the expiration
time was available from the previous Row, which was a partial solution.
[#25229]
</li>
<li>
Fixed a problem that client may push update of topology without signature
against a secure store. Before this fix, server audit logging may have warning
entries like:
<pre>
2016-06-13 06:53:32.476 UTC SEC_WARNING [rg2-rn1] Empty signature. Verification failed for topology seq# 38
</pre>
[#25273]
</li>
<li>
Fixed a bug where an application that used a KVStore handle from an
old, defunct store, against a new, recreated store on the same hosts
with the same ports could cause replication node restarts in the new
store. Now the store is unaffected and the application will receive an
oracle.kv.StaleStoreHandleException, letting it know that the handle
should be closed and reopened.
[#24693]
</li>
</ol>
<h3><a name="Utilities4210">Utility Changes</a></h3>
<ol>
<li>
If users need to configure Kerberos manually, for example when using
Active Directory, they can now specify "none" for the "-kadmin-path"
argument in the makebootconfig and securityconfig commands. In this
case, the keytab is not automatically generated and must be generated
and copied manually. [#25445]
</li>
<li>
The <code>verify configuration</code> Administrative CLI command now
shows a warning if a failed deployment resulted in a store topology with
shards that have no partitions. [#22098]
</li>
<li>
Added security configuration utilities:
<ul>
<li>security config update<br/>
Update security parameters in given security configuration.
<li>security config verify<br/>
Verify the consistency and correctness of given security configuration.
<li>security config show<br/>
Print out all information of given security configuration.
</ul>
[#24948]
</li>
<li>
Enhanced "oracle.kv.util.Load" utility to support loading data from multiple shard backup
directories concurrently, and use bulk put to improve performance of loading data.
[#25085]
</li>
<li>
Running the admin web service is no longer supported for secure stores,
which results in the following changes to utilities:
<ul>
<li>Using the <code>makebootconfig</code> command to configure a storage
node for a secure store must specify <code>-runadmin</code> if the
storage node should run an admin, and either specify the admin port as 0
or leave the admin port unspecified
<li>An admin deployed on a secure store with <code>plan
deploy-admin</code> must specify 0 for the value of
the <code>-port</code> flag
<li>The <code>securityconfig add-security</code> command fails when
performed against a non-secure store that has an admin with an admin web
service
<li>The <code>plan change-parameters</code> command fails when
attempting to specify a non-zero admin port on a secure store
<li>The <code>plan migrate-sn</code> command fails when attempting to
migrate a storage node with a non-zero admin port on a secure store
</ul>
<p>
Storage nodes in a secure store that run an admin with the admin web
service enabled will not start successfully after upgrading to this
release.  Make sure to disable the admin web service before performing
an upgrade.
<p>
If you attempt to upgrade a storage node for a secure store that has the
admin web service enabled, the node will fail to start with a message
like:
<pre>
Failed to start SNA: Cannot start the storage node agent for a secure
store when the storage node has an admin with the admin web service
enabled.  Please start this storage node and reconfigure the storage
node to disable the admin web service, or disable store security with
12.1.4.0.9 before starting this storage node.
</pre>
If you see this message when starting a storage node, you can work
around the problem by reverting to the previous release software and
restarting the storage node.  Then, use the <code>plan
change-parameters</code> command to disable the admin web service.  For
example, to disable the web service on admin1, you could use the
command:
<pre>
plan change-parameters -service admin1 -wait -params adminHttpPort=0
</pre>
<p>
[#25249]
</li>
</ol>
<h3><a name="Query4210">SQL Query Language and Shell Changes</a></h3>
<ol>
<li>
The Oracle NoSQL Database SQL query language has been enhanced with the
following features:
<ul>
  <li>Support for OFFSET and LIMIT [#25078]</li>
  <li> ALTER TABLE, used for schema evolution, has been modified to allow
  modification of RECORD types nested within other records, maps, and arrays.
  [#24049]
  </li>
</ul>
</li>
<li>
Paths used in DDL statements to reference indexes involving arrays,
map keys, and map values have been modified to be consistent with those
used in queries. The statements affected include <code>CREATE INDEX</code>
and <code>DESCRIBE TABLE</code>.
<p>
There are 3 types of paths:
<ol>
  <li>Paths to array values.
  <pre>
    Previous syntax: path-to-array or path-to_array[]
    New syntax: path-to-array[] ("[]" is required)
    For example, to create an index on the values in an array:
      CREATE TABLE MyTable(id INTEGER, myArray ARRAY(INTEGER), PRIMARY KEY(id))
      CREATE INDEX ArrayIndex on MyTable(myArray[])
  </pre>
  </li>
  <li>Paths to map values:
  <pre>
     Previous syntax: path-to-map or path-to-map[]
     New syntax: path-to-map[] ("[]" is required)
     For example, to describe the field used in a map:
      CREATE TABLE MyTable(id INTEGER, myMap MAP(STRING), PRIMARY KEY(id))
      DESCRIBE AS JSON MyTable(myMap[])
  </pre>
  </li>
  <li>Paths to map keys:
  <pre>
     Previous syntax: KEYOF(path-to-map)
     New syntax: KEYS(path-to-map)
     For example, to create an index on the keys of a map:
      CREATE TABLE MyTable(id INTEGER, myMap MAP(STRING), PRIMARY KEY(id))
      CREATE INDEX MapIndex on MyTable(myMap[])
  </pre>
  </li>
</ol>
[#25167]</li>
<li>
The <b>CREATE FULLTEXT INDEX</b> and <b>DROP INDEX</b> DDL statements
have acquired new syntax to allow overriding of the new constraints.
[#24809]
</li>
<li>
New constraints are now enforced when text indexes are created and
deleted.  These operations are not allowed unless the health status of
the Elasticsearch cluster is <i>GREEN</i>. [#25093]
</li>
<li>
Fixed a bug where executing a query statement that contains != condition in
the SQL shell could result in a java.io.IOException: Invoke method readLine of
Jline.ConsoleReader failed: !=... : event not found. [#25065]
</li>
<li>
Added a command "show query &lt;statement&gt;" to display the query plan
for a query to the SQL shell. This is not part of the query language itself; it
is a feature of the SQL shell. [#25170]
</li>
</ol>
<h3><a name="Storage4210">Storage Engine Changes (JE 7.2)</a></h3>
<ol>
<li>
Fixed a problem where checkpointing sometimes did not occur after log cleaning
when application write operations stopped, which prevented reclamation of disk
space. This was a common problem with tests that expect disk space to be
reclaimed after write operations have stopped. In production systems it could
also be a problem during repair of an out-of-disk situation.  Note that an
earlier fix [#23180] in JE 7.1 caused cleaning to occur in this situation, but
a checkpoint is also needed to reclaim disk space, so the earlier fix was
incomplete.  [#25364]
</li>
<li>
Unexpected JE data file (.jdb file) deletions are now automatically detected by
a background task. Normally all JE data file deletions should be performed
internally as a result of JE log cleaning. If an external file deletion is
detected, JE assumes this was accidental. This will now cause the RN to fail
very quickly, so that the problem is made visible as soon as possible.
Previously, the problem could be undetected for a period of time if the deleted
file was not frequently accessed. [#25201]
</li>
<li>
Further reduced the possibility that multiple node failures could cause the
loss of data (JE's RollbackProhibitedException). When NO_SYNC durability is
used, JE flushes the log to disk periodically to avoid this. Previously, an
fsync (flush to the storage device) was performed every 5 minutes. Now, a flush
to the file system is performed every 5 seconds and an fsync is performed every
20 seconds. [#25417]
</li>
<li>
JE's DbCacheSize utility has been improved for applications like NoSQL DB that
use CacheMode.EVICT_LN and an off-heap cache. The -offheap argument should be
specified when running DbCacheSize during NoSQL DB capacity planning. The
documentation for running DbCacheSize has been updated in the Determine JE
Cache Size section of the NoSQL DB Administrator's Guide, C. Initial Capacity
Planning. This documentation was previously incorrect because it did not take
into account use of the off-heap cache. [#25380]
</li>
</ol>
<h3><a name="Deprecation4210">Deprecated Features</a></h3>
<ol>
<li>
The SNMP agent (oracle.kv.impl.mgmt.snmp.SnmpAgent), which makes store
metrics available for access via the SNMP protocol, is deprecated in
this release.  It will be removed from the product in a future
release, circa July 2017.
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.4.0.9</u></h3>
<h3><a name="NewFeatures409">New Features</a></h3>
<ol>
<li>
Added the ability to define a Time To Live (TTL) on an individual
table row.  The TTL can be defined in terms of hours or days and can
be declared as a default on a table or applied per-row on put
operations. Applying a TTL to a row results in an absolute expiration
time on that row after which it will not be available. The expiration
time is available using new API on Row. [#24743]
</li>
<li>
Includes a preview release of an SQL-like declarative query language,
called ONQL, that can be used to access data in tables in a read-only
fashion. As a preview release its use and feedback is encouraged. We
expect that additions and changes done for a later formal release will
be backward-compatible with this preview, however we cannot rule out
minor incompatibilities.
<p>
As of this preview release the language supports
SELECT-FROM-WHERE-ORDERBY queries that can perform projection,
predicate-based filtering, simple arithmetic operations, index-based
sorting, and path expressions for navigating and projecting out data
from complex structures (records, arrays, and maps). Bind variables
are also supported for reuse of prepared queries.
<p>
The ONQL processor performs all operations on the server side and
automatically takes advantage of primary and secondary indexes to
increase query performance. The language also supports hints to allow
users to explicitly choose an index for a query, in cases where the
query processor is not making the best choice among the multiple
indexes applicable to a query.
<p>
In addition a new ONQL shell has been added to facilitate use of the
query language in an interactive, command line interface. [#24186]
</li>
<li>
Added Export/Import utility. Export utility allows a user to export the
contents from Oracle NoSql Store to an external export store (Local File
System / Oracle Storage Cloud Service). Import utility allows a user to
import the contents from an external export store (Local File System /
Oracle Storage Cloud Service) to Oracle NoSql store. [#24734]
</li>
<li>
Added a preview release of integration with Elasticsearch to provide
full text search indexing.  Text indexes can be added to tables in
Oracle NoSQL Database, which will cause a corresponding index in an
attached Elasticsearch cluster to be populated and maintained. [#23733]
<p>
To use this feature, users must first make available on the network an
Elasticsearch 2.0 cluster, and register the cluster with the NoSQL
Store.  This enables use of the CREATE FULLTEXT INDEX DDL command.
</li>
<li>
Added mechanism to support creating statistics tables automatically at the
end of the existing plan deploy-topology. [#24768]
</li>
<li>
Added a <em>predicate pushdown</em> mechanism to the
<a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/examples/hadoop/hive/table/package-summary.html#ondb_hive_integration_classes">
<b><code>Oracle NoSQL Database Table API Hive Integration
classes</code></b></a>.  Specifically, a mechanism was added which
supports the decomposition of a Hive or Big Data SQL
query's <code>WHERE</code> clause (the <em>predicates</em>) into
information that can be passed to the KVStore database so that some/all
search processing can be performed in the database itself rather than in
the processing performed on the client side of the query. For more
details on this new mechanism, refer to
<a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/examples/hadoop/hive/table/package-summary.html#appendix_d_predicate_pushdown">
<b><code>Appendix D of the <em>Table API Hive
Cookbook</em></code></b></a>. [#24525]
</li>
<li>
Added a non-interactive login mode for command line utilities like Admin
command line interface and Ping utility. Setting the login property introduced
this release, "oracle.kv.password.noPrompt" as true, the non-interactive login
mode will be enabled. If users are not using password store and configuring
login properties incorrectly, the utilities would directly exit without
automatically prompting password or user name like previous releases. [#24931]
</li>
<li>
Added a new example that demonstrates how to perform Kerberos
authentication on the client side. [#24328]
</li>
<li>
Ranges declared on fields in DDL "CREATE TABLE" expressions are no longer
supported. In previous releases it was possible to declare range constraints on
fields in tables. This was done using the data definition language (DDL)
keyword "CHECK" and providing a range. The primary intent of this
feature was to allow the system to optimize primary key size for such
fields because keep primary key size small is an important optimization.
This feature was allowed for numeric and String types.
<p>
As of this release the CHECK syntax and generalized ranges are no longer
supported. Existing tables created with such fields will continue to
operate correctly and enforce the range constraints.
To replace this function, an optional storage size
specification is allowed on fields declared in the primary key. This
makes the intent of the feature very clear &mdash; reducing primary key size.
This is only allowed on fields of type INTEGER at this time. [#24769]
</li>
<li>
Added new methods to support bulk put operations in the table API.  See
the documentation for the
<a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/java-api/oracle/kv/table/TableAPI.html#put-java.util.List-oracle.kv.BulkWriteOptions-">
<code>TableAPI.put(List&lt;EntryStream&lt;Row&gt;&gt;, BulkWriteOptions)
</code></a> and
<a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/java-api/oracle/kv/KVStore.html#put-java.util.List-oracle.kv.BulkWriteOptions-">
<code>KVstore.put(List&lt;EntryStream&lt;KeyValue&gt;&gt;, BulkWriteOptions)
</code></a> methods for more details. [#24563]
</li>
</ol>
<h3><a name="BugFixes409">Bug and Performance Fixes</a></h3>
<ol>
<li>
Changes have been made to the Admin and Rep Node service's persistent store
to support more flexible upgrades in future releases. This change will have a
one-time impact when upgrading from a previous release to this release. During
the upgrade the Admin may temporarily enter a "read-only" mode. While in the
read-only mode it will not be possible to change the persistent state of the
Admin. This includes creating new topologies, changing parameters, creating
new plans, or running existing plans. A read-only Admin will attempt to
exit this mode by transferring control to another Admin node. [#24634] [#24725]
</li>
<li>
System tables that are internally managed and maintained by the system are
now read-only when security is enabled on the store. In addition,
whether or not security is enabled, the schema for system tables are now
immutable, and users are not permitted to alter, or drop or add indexes
for system tables. The old tables (TableStatsPartition, TableStatsIndex,
PartitionStatsLease and IndexStatsLease) used by statistics gathering are
deprecated in this release.  If enabled statistics gathering in an earlier
release, you are still able to read these tables to check old statistics data,
but they will not be updated in this release. You can drop old tables
if you do not have any plan to maintain old statistics. [#24467]
</li>
<li>
Fixed a problem that prevented the ping command from authenticating
properly when used with a secure store. [#24808]
</li>
</ol>
<h3><a name="Utilities409">Utility Changes</a></h3>
<ol>
<li>
Due to changes in the Admin service's persist store (described in the "Bug and
Performance Fixes" section above) the new versions of the dump and load
utilities can only be used after the store has been fully upgraded. Also,
previous versions of these utilities will no longer work once an upgrade to
this release has begun.  During an upgrade the new utilities will not operate
until all of the Admin nodes have been upgraded and the Admin is no longer in
the read-only mode described above. [#24634] [#24725]
</li>
<li>
The "table size" sub command was mistakenly marked to be deprecated together
with its parent command "table" command in release 12cR1.3.5.2, move "table size"
to top level command and rename it to "table-size".
</li>
<li>
Added a new status utility command that shows the status of a storage
node agent. [#23561]
</li>
<li>
Fixed a problem where executing a Hive query against a table containing
an array with no elements would cause an exception like the following:
<pre>
2016-02-09 13:31:24,213 ERROR [main]: CliDriver (SessionState.java:printError(921)) - Failed with exception java.io.IOException:java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
java.io.IOException: java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
at org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:507)
at org.apache.hadoop.hive.ql.exec.FetchOperator.pushRow(FetchOperator.java:414)
at org.apache.hadoop.hive.ql.exec.FetchTask.fetch(FetchTask.java:138)
at org.apache.hadoop.hive.ql.Driver.getResults(Driver.java:1655)
at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:227)
at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:159)
at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:370)
at org.apache.hadoop.hive.cli.CliDriver.executeDriver(CliDriver.java:756)
at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:675)
at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:615)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:497)
at org.apache.hadoop.util.RunJar.run(RunJar.java:221)
at org.apache.hadoop.util.RunJar.main(RunJar.java:136)
Caused by: java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
at java.util.ArrayList.rangeCheck(ArrayList.java:653)
at java.util.ArrayList.get(ArrayList.java:429)
at oracle.kv.impl.api.table.ArrayValueImpl.get(ArrayValueImpl.java:97)
at oracle.kv.hadoop.hive.table.TableSerDe.objectInspector(TableSerDe.java:458)
at oracle.kv.hadoop.hive.table.TableSerDe.deserialize(TableSerDe.java:286)
at org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:488)
... 15 more
</pre>
[#24900]
</li>
</ol>
<h3><a name="Deprecation409">Deprecated Features</a></h3>
<ol>
<li>
The interfaces and classes related to support of Avro have been deprecated
in favor of the use of tables and the table API.
All Avro features are available more simply using the table API. The
interfaces and code supporting Avro will continue remain available for
some time, but users are encouraged to migrate to the table API.
<p>
The interfaces and classes affected are mostly in the oracle.kv.avro
package. Interfaces that use those classes are also affected.
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.5.2</u></h3>
<h3><a name="NewFeatures352">New Features</a></h3>
<ol>
<li>
Added support for gathering key distribution statistics. To enable
statistics gathering, the statistics tables need to be created first by
executing the runadmin script
file <code>CreateStatisticTables.kvs</code>, which is located in
the <code>lib</code> directory of the release package. [#23422]
</li>
<li>
Added support for Kerberos user authentication.
Users that wish to use this new capability should be aware of the
following changes:
<ul>
<li>
The makebootconfig utility has a new optional
<code>-external-auth</code> command-line argument which is used to
enable external authentication mechanisms. Currently, Kerberos is the
only supported mechanism. This new flag is only permitted when the value
of the <code>-store-security</code> flag is specified
as <code>configure</code> or <code>enable</code>.
</li>
<li>
The securityconfig tool has been enhanced to provide the ability to:
<ul>
<li>Add Kerberos configuration information to an existing security
configuration</li>
<li>Renew a store's Kerberos service principal keytab for security
maintenance tasks</li>
</ul>
</li>
<li>
A new class, KerberosCredentials, which implements LoginCredentials, has
been introduced, and its instances can be used in the
KVStoreFactory.getStore method to perform a Kerberos login:
<ul>
<li><code>KVStoreFactory.getStore(KVStoreConfig, LoginCredentials, ReauthenticateHandler)</code></li>
</ul>
<li>New Kerberos-related security properties have been added that must
be specified when using a KVStore command-line utility program against a
secure store that has enabled Kerberos authentication.</li>
</ul>
<p>
There are two approaches that applications can use to authenticate using
Kerberos. Client applications that use the
<a href="https://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASRefGuide.html">
Java Authentication and Authorization Service (JAAS)</a> programming
framework can specify credentials by using <code>Subject.doAs</code>.
Applications that do not use the JAAS framework can use the new security
properties to specify parameters needed to acquire user credentials from
the Kerberos Key Distribution Center (KDC).
<p>
Kerberos authentication is described in greater depth in the Oracle
NoSQL Database Security Guide, as well as in the Administrators Guide
and the Javadoc.  [#24328]
</li>
<li>
The off-heap cache is now enabled by default with a systemPercent setting of
10%. Please
review <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSADM-GUID-A467B643-9D14-43AF-AD4B-65A3376D802C">
Managing the Off-heap Cache</a> for details.
</li>
</ol>
<h3><a name="BugFixes352">Bug and Performance Fixes</a></h3>
<ol>
<li>
In earlier versions, a LOB read operation with
<code>Consistency.NONE_REQUIRED</code> could
fail in the absence of a master for the shard hosting the LOB metadata. The read
operation will now use a suitable replica when the read consistency allows for
it. [#24460]
</li>
<li>
Fixed a bug where a client calling TableAPI.getTable() while an index is being
created and populated (is not yet ready) could result in a
ConcurrentModificationException on a RepNode, causing the RepNode to become
unavailable. [#24691]
</li>
<li>
Corrected a problem in the configuration of the external tables example
that caused the example to generate errors.  The property name for
specifying the name of the table in the <code>config.xml</code> file was
incorrect &mdash; changed from "oracle.kv.table" to
"oracle.kv.tableName". [#24650]
</li>
<li>
Fixed a problem in the implementation of the <code>show admins</code>
command in the Administrator CLI that prevented it from authenticating
correctly when used with a secure store. [#24648]
</li>
<li>
Improved the algorithm used to calculate the maximum number of threads
used to perform concurrent table requests when the default is requested
by specifying <code>TableIteratorOptions.maxConcurrentRequests</code>
as <code>0</code>.  This change affects the behavior of table multi-get
operations, and table and index iterations. [#24188]
</li>
<li>
Fixed a security flaw in table-level access checking.  Before this
fix, it might have been possible for an authenticated client to access
a table without permission if the user had permission to access other
tables in the store.
</li>
</ol>
<h3><a name="Utilities352">Utility Changes</a></h3>
<ol>
<li>
There were several changes made to the ping command to make it easier to
use in scripts.
<p>
First, modified the <code>java -jar kvstore.jar ping</code> command to
add a new flag, <code>-helper-hosts</code>, which is an alternative to
the existing <code>-host</code> and <code>-port</code> flags. If
multiple helper hosts are provided, the ping utility will have multiple
nodes it can use to make an initial point of contact with the store, and
will have a greater chance of success if some nodes of the store are
unavailable.  The new <code>-helper-hosts</code> flag can be specified
as a comma-separated list of hosts and ports.  For example:
<pre>
java -jar kvstore.jar ping -helper-hosts hst1:5000;hst2:5100
</pre>
<p>
Second, ping now generates an exit code which acts as a quick summary of
the results.  The exit code is returned both as a process exit code, if
ping is called as a standalone utility, and as part of the JSON
output. The exit code is meant to direct the caller to perform the
appropriate follow-on action.  The values, defined in
the <code>Ping.ExitCode</code> enum, are:
<dl>
<dt>0 (EXIT_OK)
<dd>All services in the store could be located and are in a known, good
    state (e.g. RUNNING).
<dt>1 (EXIT_OPERATIONAL)
<dd>One or more services in the store could not be reached, or are in an
    unknown or not usable state.  In this case the store should support
    all data operations across all shards, as well as all administrative
    operations, but may be in a state of degraded performance.  Some
    action should be taken to find and fix the problem before part of
    the store becomes unavailable.
<dt>2 (EXIT_NO_ADMIN_QUORUM)
<dd>The Admin Service replication group does not have quorum or is not
    available at all, and it's not possible to execute administrative
    operations which modify store configuration. The store supports all
    normal data operations despite the loss of admin quorum, but this
    state requires immediate attention to restore full store
    capabilities.
<dt>3 (EXIT_NO_SHARD_QUORUM)
<dd>One or more of the shards does not have quorum and either cannot
    accept write requests, or is completely unavailable.  This state
    requires immediate attention to restore store capabilities.  This
    exit code takes precedence over EXIT_NO_ADMIN_QUORUM, so if this
    exit code is used it is possible that the admin capabilities are
    also reduced or unavailable.
<dt>100 (EXIT_USAGE)
<dd>A usage error.
<dt>101 (EXIT_TOPOLOGY_FAILURE)
<dd>Ping was unable to find a Topology in order to operate.  This could
    be a store problem, a network problem, or it could be a usage
    problem with the parameters passed to Ping (e.g. the host and port
    or helper-hosts list are not part of a store).
<dt>102 (EXIT_UNEXPECTED)
<dd>The utility has experienced an unexpected error.
</dl>
<p>
Note that exit codes 1 through 3 may indicate a network connectivity
issue that should be checked first before concluding that any services
have a problem.
<p>
Finally, the following section has been added to Ping's JSON output,
which can be requested using the <code>-json</code> flag, and appears
when ping is called as a standalone command or as part of the Admin CLI.
For example:
<pre>
  "operation" : "ping",
  "return_code" : 5000,
  "description" : "No errors found",
  "exit_code" : 0
</pre>
<p>
[#24407]
</li>
<li>
Some table commands in the Administrative CLI were deprecated in favor
of using the execute command to perform DDL statements.  The newly
deprecated commands are:
<ul>
<li>table
<li>plan add-index
<li>plan add-table
<li>plan evolve-table
<li>plan remove-index
<li>plan remove-table
</ul>
<p>
[#23937]
</li>
<li>
Some additional Admin CLI commands now support displaying output in JSON
format. If <code>-json</code> is specified when starting the Admin CLI
using <code>runadmin</code>, or is specified as an argument of a command, the
execution result of the command will be displayed in a JSON format string
containing standard NoSQL error messages.  In addition to the
`configure` command, support has been added for the following commands:
<ul>
<li>plan deploy-zone
<li>plan deploy-sn
<li>pool create
<li>pool join
<li>plan deploy-admin
<li>topology create
<li>plan deploy-topology
<li>show plan
<li>verify configuration|upgrade|prerequisite
</ul>
<p>
[#24346]
</li>
<li>
The admin CLI command `pool add` is now idempotent.  Calling the command
with a pool that already exists now returns without error. This change
is intended to make the command easier to use in scripts. [#24445]
</li>
<li>
The <code>makebootconfig</code> command was modified to support the
new <code>-dns-cachettl</code> flag.  This flag specifies the number of
seconds that replication nodes should cache host name to IP address
mappings.  A value of 0 means mappings should not be cached.  A value of
-1 means mappings should be cached indefinitely, which is the default.
The value of the flag is used to set the "networkaddress.cache.ttl" and
"networkaddress.cache.negative.ttl" security properties.  Note that
specifying a non-default value can have security implications.  See the
Java <a href="https://docs.oracle.com/javase/7/docs/api/java/net/doc-files/net-properties.html#AddressCache">
Networking Properties</a> page for more details. [#24087]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.4.7</u></h3>
<h3><a name="NewFeatures347">New Features</a></h3>
<ol>
<li>
Added a new command to the CLI for reestablishing Admin service quorum
that has been lost due to failure:
<pre>
repair-admin-quorum {-zn &lt;id&gt;|-znname &lt;name&gt;|-admin &lt;id&gt;}...
</pre>
The command repairs admin quorum by reducing membership of the admin
group to the admins included in the specified zones and in the list of
the specific admins.  Reestablishing admin quorum is one of the first
steps in performing disaster recovery. [#23983]
</li>
<li>
Added a new command to the Admin CLI to recover shard quorum lost due to
failure by change zone types:
<pre>
plan failover { {-zn &gt;zone-id&lt;|-znname &gt;zone-name&lt;}
                -type {primary|offline-secondary} }...
              ...
</pre>
The command repairs shard quorum by changing the type of currently
offline primary zones to secondary zones and, optionally, changing some
secondary zones to primary zones.  Failover is one of the final steps in
performing a disaster recovery. [#23546]
</li>
<li>
Added the ability to change a zone type. Previously a zone could be created as
either a PRIMARY or SECONDARY zone and once created the type could not be
changed. With this release the new CLI command:
<code>topology change-zone-type</code> allows
the administrator to change a zone in a topology from PRIMARY to SECONDARY or
from SECONDARY to PRIMARY. Once changed the topology can then be deployed as
normal with the <code>plan deploy-topology</code> command. [#24308]
</li>
<li>
The Storage Node Agent (SNA) now supports a start-up mode that ensures its
managed services are disabled before the SNA starts. If the
<code>-disable-services</code> flag is specified on the SNA command line
with the kvstore <code>start</code> command, the SNA's services will
first be disabled before the SNA starts. If there is a failure disabling
the services the SNA will not start. This ability is useful during
disaster recovery to prevent unwanted services from starting.
<p>
The kvstore <code>disable-services</code> command has been removed. Instead
use <code>stop -disable-services</code>. The <code>-disable-services</code>
option can be used with the kvstore <code>start</code>, <code>stop</code>, and
<code>restart</code> commands.
[#24337]
</li>
<li>
Improved the <code>plan repair-topology</code> command.  The command now
can repair parameter differences for Admin and Replication Node services
between the reference copy maintained by the Admin and the storage node
configuration files or parameters in the running services. [#23555]
</li>
<li>
Added a new command to the CLI which will wait for replica nodes to
reach a specified threshold of consistency with their masters. This
command can be used when performing a switchover to wait for secondary
nodes to catch up with their masters and to obtain information about
progress towards reaching consistency. The new command:
<pre>
await-consistent -timeout &lt;timeout-secs&gt;
    [-zn &lt;id&gt; | -znname &lt;name&gt;]...
    [-replica-delay-threshold &lt;time-millis&gt;]
</pre>
will wait up to <code>timeout-secs</code> seconds for the replication
delay of the replica nodes in the zones specified by <code>-zn</code>
or <code>-znname</code> to be less than or equal to <code>time-millis</code>
milliseconds.
If no zones are specified then the command will wait on all replicas
in the store.
If <code>-replica-delay-threshold</code> is not specified the default value
of 5000 milliseconds (5 seconds) is used.
<p>
If any replicas do not reach the threshold within the timeout period
the command will return with a list of those nodes along with their
lag time, and information about whether the replica is catching up if known.
[#23982]
</li>
<li>
Modified the output of the `ping` and `verify configuration` Admin CLI
commands so that shard and zone status entries are named more clearly
using non-overlapping categories.  For shard status, the 'total' entry
has been removed, the 'degraded' entry has been renamed to
'writable-degraded', and the 'noQuorum' entry has been renamed to
'read-only'.  For zone status, the 'total' entry has been removed, and
the 'offline' entry has been added. [#24336]
</li>
<li>
Modified the output of the `ping` and `verify configuration` Admin CLI
commands to add an entry that provides an overview of the status of the
Admin service nodes.  Also modified the output of the `show admins` command
to include information about the status and replication state of each
admin. [#23984]
</li>
<li>
Modified the classes and interfaces in <code>oracle.kv.hadoop.table</code>
and <code>oracle.kv.hadoop.hive.table</code> to support the Oracle NoSQL Database
security model. Specifically, you can now run MapReduce jobs, Hive queries, and
Big Data SQL queries against table data located in a store configured for secure access.
In addition to the changes made in <code>oracle.kv.hadoop.table</code> and
<code>oracle.kv.hadoop.hive.table</code> to support security, example code and
detailed documentation has also been provided that explains and walks you through
the details of executing a MapReduce job or Hive/Big Data SQL query against table
data in a secure store; which can be found, respectively, in the sections of
<a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/examples/hadoop/table/package-summary.html"> <code>The Table API MapReduce Cookbook</code></a>
and
<a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/examples/hadoop/hive/table/package-summary.html"> <code>The Table API Hive Cookbook</code></a>.
[#23714] [#24107] [#24108]
</li>
<li>
Modified the <code>oracle.kv.hadoop.hive.table.TableSerDe</code> and related
classes to support executing Hive or Big Data SQL queries against data contained
in tables whose schema may consist of complex (non-<em>primitive</em>) data types;
that is, <code>Map</code>, <code>Record</code>, <code>Array</code> types.
Additionally, documentation and examples have been provided that walk you through
the details of the data model and how it maps to the Hive and Big Data SQL data
models; which can be found
<a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/examples/hadoop/hive/table/package-summary.html#mapping_hive_to_ondb_data_model"> <code>here</code></a>
and
<a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/examples/hadoop/hive/table/package-summary.html#mapping_ora_to_ondb_data_model"> <code>here</code></a>
respectively. [#24357] [#24358]
</li>
<li>
Topology candidates with names that contain the dollar sign ('$')
character are now reserved for use by the system, which may modify or
remove them.  The `topology create` and `topology clone` commands will
print a warning if they are called to create topology candidates whose
names contain the reserved character.  Administrators should avoid
creating or using topology candidates with names using dollar
signs. [#24386]
</li>
<li>
The <code>plan start-services</code> and <code>plan stop-services</code>
commands now support starting and stopping Admin services. Previously,
these plans only operated on Replication Nodes (RNs). With this release
the <code>-service</code> option accepts the name of an Admin service.
In addition, if a zone is specified (with either the <code>-zn</code> or
<code>-znname</code> flags) and the <code>-all-rns</code> is not
specified, then all of the services, RNs and Admins, in that zone are affected.
[#24149]
</li>
<li>
Some commands in the Admin CLI now supports displaying JSON format results. If
<code>-json</code> is specified when starting the Admin CLI using
<code>runadmin</code>, or is specified as an argument of a command, the
execution result of the command will be displayed in a JSON format string
containing standard NoSQL error messages. In this release, only the `configure`
command has been changed to support JSON format result.
[#24444]
</li>
<li>
The admin CLI commands `configure`, `topology create`, `pool join` and
`plan deploy-admin` are now idempotent to support admin automation scripting.
[#24445]
</li>
<li>
Added support for configuring replication nodes to use off-heap caches,
which are disabled by default.  An off-heap cache can be used to utilize
large memories more efficiently than when using the same memory for the
file system cache, while avoiding the Java GC overhead associated with
large Java heaps.  Please see
<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSADM-GUID-A467B643-9D14-43AF-AD4B-65A3376D802C">
Managing the Off-heap Cache</a> for details.  [#24370]
</li>
</ol>
<h3><a name="APIChanges347">API Changes</a></h3>
<ol>
<li>
The iterators <code>ParallelScanIterator</code> and <code>TableIterator</code>
now support both <code>Direction.FORWARD</code> and
<code>Direction.REVERSE</code>.
<p>
Note that, due to the internal changes to support the new iterator options,
the method <code>getStoreIteratorMetrics</code> on
<code>oracle.kv.stats.KVStats</code> has been deprecated. This method returns
an instance of <code>oracle.kv.stats.StoreIteratorMetrics</code> which has
also been deprecated. All of the methods of the returned
<code>StoreIteratorMetrics</code> object will return <code>0</code>.
[#23583]
</li>
<li>
Add Java <code>Map</code> based API for Record and Map field in
<code>RecordValue</code> interface. Add Java <code>Iterable</code> and
array based API for Array field in <code>RecordValue</code> interface.
[#24177]:
<pre>
<code>RecordValue putRecord(String fieldName, Map&lt;String, ?&gt; map)</code>
<code>RecordValue putMap(String fieldName, Map&lt;String, ?&gt; map)</code>
<code>RecordValue putArray(String name, Iterable&lt;?&gt; list)</code>
<code>RecordValue putArray(String name, Object[] array)</code>
</pre>
</li>
<li>
The interfaces for the methods <code>oracle.kv.hadoop.table.TableInputFormat.setKVSecurity</code>
and <code>oracle.kv.hadoop.hive.table.TableInputSplit.setKVStoreSecurity</code> have
each been changed to specify new information needed for security-related initialization;
specifically,
<ul>
  <li>The name of the file that specifies the transport properties the client uses when connecting to the store (the <em>login file</em>).
  <li>The PasswordCredentials containing the username and password the client presents to the store during authentication.
  <li>The name of the file containing the public keys and/or certificates needed for authentication (the <em>trust file</em>).
</ul>
<p>
[#23714] [#24107] [#24108]
</li>
<li>
A new exception, <code>MetadataNotFoundException</code>, has been added to
indicate that a client's metadata may be out of sync.  It extends
<code>FaultException</code> and can be caught by applications to trigger the
need for a refresh of their metadata, and in particular, <code>Table</code>
handles obtained via <code>TableAPI.getTable</code>.
</li>
<li>
Added bulk get APIs to fetch large numbers of keys and values efficiently based
on discrete keys. The APIs can be used with both the Key/Value and Table data
models. The following is a list of the new methods:
<ul>
<li>New methods defined on <code>oracle.kv.KVStore</code>:
<pre>
ParallelScanIterator&lt;KeyValueVersion&gt; storeIterator(Iterator&lt;Key&gt;, int, KeyRange, Depth, Consistency, long, TimeUnit, StoreIteratorConfig)
ParallelScanIterator&lt;Key&gt; storeKeysIterator(Iterator&lt;Key&gt;, int, KeyRange, Depth, Consistency, long, TimeUnit, StoreIteratorConfig)
ParallelScanIterator&lt;KeyValueVersion&gt; storeIterator(List&lt;Iterator&lt;Key&gt;&gt;, int, KeyRange, Depth, Consistency, long, TimeUnit, StoreIteratorConfig)
ParallelScanIterator&lt;Key&gt; storeKeysIterator(List&lt;Iterator&lt;Key&gt;&gt;, int, KeyRange, Depth, Consistency, long, TimeUnit, StoreIteratorConfig)
</pre>
</li>
<li>New methods defined on <code>oracle.kv.table.TableAPI</code>:
<pre>
TableIterator&lt;Row&gt; tableIterator(Iterator&lt;PrimaryKey&gt;, MultiRowOptions, TableIteratorOptions)
TableIterator&lt;PrimaryKey&gt; tableKeysIterator(Iterator&lt;PrimaryKey&gt;, MultiRowOptions, TableIteratorOptions)
TableIterator&lt;Row&gt; tableIterator(List&lt;Iterator&lt;PrimaryKey&gt;&gt;, MultiRowOptions, TableIteratorOptions)
TableIterator&lt;PrimaryKey&gt; tableKeysIterator(List&lt;Iterator&lt;PrimaryKey&gt;&gt;, MultiRowOptions, TableIteratorOptions)
</pre>
</li>
</ul>
<p>
Please review the javadoc associated with these new methods for details.
<p>
[#24285]
</li>
</ol>

<h3><a name="BugFixes347">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a problem where some plans would enter the INTERRUPTED state.
This would happen when a plan needed to stop, or restart the master Admin which
was running the plan. Once in the INTERRUPTED state, user action
was required to have the plan resume execution. The fix allows the plan to
automatically restart on the new master Admin (either some other Admin, or the
original Admin which has restarted).
<p>
Along with this fix, the Admin CLI has been updated so that it will wait
for a plan even if the plan is restarted on an Admin which was not the Admin
the CLI was originally connected to. This change affects the <code>plan</code>
command's <code>-wait</code> flag as well as the <code>plan wait</code> command.
[#24535]
</li>
<li>
Fixed a problem where <code>ArrayValue.set()</code> would result in the same
behavior as <code>ArrayValue.add()</code>, mistakenly adding to the array
rather that putting an entry at a specific index. [#24326].
</li>
<li>
Fixed a bug that a release 3.2 replication node cannot resolve the name of a
role principal created by a new replication node running release 3.3 during an
upgrade of a NoSQL cluster. This situation works properly when upgrading from
the 3.2 release to the current release. [#24502].
</li>
<li>
Fixed a bug that caused the <code>makebootconfig</code> utility command
to fail when it was called with a value for the <code>-capacity</code>
flag that was greater than 1 when using a 32-bit Java virtual
machine. [#24550]
</li>
<li>
Improved the performance of topology redistribution by batching
transactional operations performed during partition migrations. [#24529]
</li>
<li>
Corrected problems where the table API implementation failed to perform
case insensitive comparisons when comparing field names. [#24553]
</li>
<li>
Modified elasticity operations to provide improved store availability
during an elasticity change by waiting for replicas to catch up with
masters before counting them as contributing to the shard quorum.  This
change reduces the chance of a temporary loss of write availability
during an elasticity change that moves replication nodes, particularly
when the store is under heavy write loads. [#24511]
</ol>
<h3><a name="Utilities347">Utility Changes</a></h3>
<ol>
<li>
The Admin CLI utility (<code>runadmin</code>) and the Admin
CLI <code>connect store</code> command now support the following new
flags to override the default configuration:
<ul>
<li><code>-timeout</code> to specify the store request timeout,
<li><code>-consistency</code> to specify the store request consistency, and
<li><code>-durability</code> to specify the store request durability.
</ul>
<p>
[#24101]
</li>
</ol>

<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.3.4</u></h3>
<h3><a name="NewFeatures334">New Features</a></h3>
<ol>
<li>
A number of new security features have been added.
<p>
Users are now able to enforce table-level access checks through both
the API and administrative command line interface (Admin CLI) by using
the following new series of table-specific privileges:
<table border="true" summary="List security privileges">
    <tr>
        <td><strong>Privilege</strong></td>
        <td style="text-align: left"><strong>Description</strong></td>
    </tr>
    <tr>
        <td>READ_ANY_TABLE</td>
        <td>Read from any table in kvstore</td>
    </tr>
    <tr>
        <td>DELETE_ANY_TABLE</td>
        <td>Delete data from any table in kvstore</td>
    </tr>
    <tr>
        <td>INSERT_ANY_TABLE</td>
        <td>Insert and update data to any tables in kvstore</td>
    </tr>
    <tr>
        <td>READ_TABLE</td>
        <td>Read from a specific table in kvstore</td>
    </tr>
    <tr>
        <td>DELETE_TABLE</td>
        <td>Delete data from a specific table in kvstore</td>
    </tr>
    <tr>
        <td>INSERT_TABLE</td>
        <td>Insert and update data to a specific table in kvstore</td>
    </tr>
    <tr>
        <td>CREATE_ANY_TABLE</td>
        <td>Create any table in kvstore</td>
    </tr>
    <tr>
        <td>DROP_ANY_TABLE</td>
        <td>Drop any table in kvstore</td>
    </tr>
    <tr>
        <td>EVOLVE_ANY_TABLE</td>
        <td>Evolve any table in kvstore</td>
    </tr>
    <tr>
        <td>CREATE_ANY_INDEX</td>
        <td>Create any index on any table in kvstore</td>
    </tr>
    <tr>
        <td>DROP_ANY_INDEX</td>
        <td>Drop any index on any table in kvstore</td>
    </tr>
    <tr>
        <td>EVOLVE_TABLE</td>
        <td>Evolve a specific table</td>
    </tr>
    <tr>
        <td>CREATE_INDEX</td>
        <td>Create index on a specific table</td>
    </tr>
    <tr>
        <td>DROP_INDEX</td>
        <td>Drop index on a specific table</td>
    </tr>
</table>
<p>
Users are now able to create new roles to group together privileges or
other roles. This provides a way to grant a group of desired
privileges to a user. New role management commands have been added to
support create and drop roles, and to grant and revoke privileges or
roles to and from other roles.
<p>
Modifications to the data definition language (DDL) have been added to
provide a declarative interface to all security operations. The
language reference is
in <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSSEC-GUID-6C5875FE-9765-45E6-9EC7-0D6EAEE3F95D">
Security Guide</a>. The language is accessible via the API as well as
via the "execute" command in the Admin CLI.
<p>
Passwords now have lifetimes and will expire when they have been in use beyond
the specified lifetime. It is also possible now to explicitly expire a
password when adding a new user or by altering the profile of an existing
user. Users are required to renew the expired password before they can log in
to the store successfully.
[#23951]
</li>
<li>
Admin service configuration has been enhanced to better match the use
of primary and secondary zones. It is now possible for an Admin
service to be a <i>primary</i> or a <i>secondary</i>
Admin. This <i>Admin type</i> is analogous to zone type. A primary
Admin can serve as a master or replica of the Admin shard, and vote in
master elections.  Secondary Admins can only serve as replicas and do
not vote in master elections.  All Admins created in earlier releases
are primary Admins. With this release new Admins are created with the
same type as their containing zone.
<p>
Admin services created in a secondary zone by previous release will have the
wrong type (primary). This mismatch will be reported as a <i>violation</i>
from the <code>verify configuration</code> command. This condition can be
remedied through the <code>plan repair-topology</code> command.
<p>
In addition to the changes in Admin service type behavior, new rules have
been put in place regarding Admin service deployment. In general it is
recommended that Admin services follow the same rules as data nodes,
specifically the number of Admin services in a zone should match the zone's
replication factor. [#23985][#24182]
</li>
<li>
The Command Line Interface (Admin CLI) now supports a <i>read only</i> mode if
the Admin shard does not have quorum or if the master Admin is unreachable.
In this read-only mode any commands which require the Admin to
update persistent state, such as plan creation and execution, are disabled.
However, most commands which provide status or configuration information will
function. In addition to a notification in the CLI informing the user that
the CLI is in this mode, the <code>show admins</code> command will also
indicate that the CLI is connected read-only.
<p>
Additional re-connect capabilities have been added to the Admin CLI to
improve robustness of the CLI in the face of Admin node failures.
[#23943]
</li>
</ol>

<h3><a name="APIChanges334">API Changes</a></h3>
<ol>
<li>
The methods <code>oracle.kv.table.TableAPI.execute</code> and
<code>oracle.kv.table.TableAPI.executeSync</code> have been deprecated in
favor of the new APIs, <code>oracle.kv.KVStore.execute</code> and
<code>oracle.kv.KVStore.executeSync</code>. The motivation for the
change is the introduction of new DDL statements which
manage objects that are above the scope of a single table, such as
users and roles. Likewise, the
classes <code>oracle.kv.table.ExecutionFuture</code> and
<code>oracle.kv.table.StatementResult</code> are deprecated in favor of
<code>oracle.kv.ExecutionFuture</code> and
<code>oracle.kv.StatementResult</code>.
[#23937]
</li>
<li>
New methods have been added
to <code>oracle.kv.table.RecordValue</code> to provide the ability to
use JSON values for complex fields in a table. In the past, JSON could
be used to specify the entire row, but not portions of a row. The
following 6 JSON input methods for complex types in RecordValue are
new: [#24069]
<pre>
<code>RecordValue putRecordAsJson(String fieldName, String jsonInput, boolean exact);</code>
<code>RecordValue putRecordAsJson(String fieldName, InputStream jsonInput, boolean exact);</code>
<code>RecordValue putArrayAsJson(String fieldName, String jsonInput, boolean exact);</code>
<code>RecordValue putArrayAsJson(String fieldName, InputStream jsonInput, boolean exact);</code>
<code>RecordValue putMapAsJson(String fieldName, String jsonInput, boolean exact);</code>
<code>RecordValue putMapAsJson(String fieldName, InputStream jsonInput,boolean exact);</code>
</pre>
</li>
<li>
New methods have been added to better support DDL use by stateless
applications. <code>oracle.kv.ExecutionFuture.toByteArray()</code>
returns a serialized version of the future that can later be passed to
<code>oracle.kv.KVStore.getFuture(byte[])</code> to recreate a Future
instance.
[#24228]
</li>
<li>
There are changes to the way the results and status of DDL operations
are reported in the API. Information about the execution of a DDL
operation continues to be returned
via <code>oracle.kv.StatementResult</code>. In past releases, both
return values and execution status were returned
via <code>StatementResult.getInfo(),
StatementResult.getInfoAsJson()</code>. Now, results are return via a
new method, <code>StatementResult.getResult()</code>, while status is
returned via <code>StatementResult.getInfo(),
getInfoAsJson</code>. [#24277]
</li>
</ol>
<h3><a name="Utilities334">Utility Changes</a></h3>

<ol>
<li>
<code>plan deploy-admin</code> now deploys an Admin with the same
type (primary or secondary) as the zone in which it resides. Previously
the Admin was always created as a primary.
</li>
<li>
<code>plan repair-topology</code> will change an Admin's type so that
the type matches the zone in which it resides.
</li>
<li>
<code>verify configuration</code> will report the following:
<ul>
<li>
A <i>violation</i> for each Admin service whose type does not match the
type of the zone in which it resides
<li>
A <i>violation</i> if the number of Admin services in a zone is less than
the zone's rep factor
</li>
<li>
A <i>note</i> if the number of Admins services in a zone is greater than
the zone's rep factor
</li>
</ul>
</li>
<li>
The put command in the Admin CLI now has a new <code>-exact</code> flag. When
true, the input json string or file specified to the command must
contain values for all columns in the table, and cannot contain
extraneous fields.
</li>
<li>
The Admin CLI now supports a new "show versions" command, which
displays client and server version information. [#24005]
</li>
<li>
The Admin CLI now provides the ability to use the semicolon character as a
command terminator to enter multiple commands, or to enter commands on
multiple lines.
<p>
For example, the following command would have had to be typed in a single line:
<pre>
  kv-> execute "create table users(name string, address string, primary key (name))"
</pre>
or
<pre>
  kv-> execute "create table users \
    ->                 (name string, \
    ->                  address string, \
    ->                  primary key (name))"
</pre>
but can now be entered this way:
<pre>
  kv-> execute "create table users
    ->                 (name string,
    ->                  address string,
    ->                  primary key (name))";
</pre>
In addition, multiple commands can be entered as below, using a semicolon as
a terminator.
<pre>
  kv-> show table -name users; get table -name users;
</pre>
[#24119]
</li>
<li>
A new command line utility has been added that disables services
associated with a storage node.  You can use the new utility when
starting a storage node whose services had configuration changes while
the node was offline, to allow the configuration to be updated so that
the services can be started with the proper configuration.
<p>
The new utility is invoked this way:
<pre>
  java jar -kvstore.jar disable-services -root ROOT_DIRECTORY [-config CONFIG_FILE]
</pre>
[#23988]
</li>
<li>
Improvements have been made to the output of the Admin CLI <code>verify
configuration</code> command, and both the Admin CLI and top level
versions of the <code>ping</code> command:
<ul>
<li>Output now uses JSON format if the new <code>-json</code> flag is
specified
<li>Output now includes summaries of the status of shards and zones in
the store, and information about the replication status of non-master
replication nodes
<li>Output for the ping commands now includes information about admin
services, to match the information provided by verify configuration
</ul>
<p>
[#23981]
</li>
<li>
A new "verify" option has been added to the  diagnostics command line
utility. This option does a variety of health and configuration
checks, such as:
<ul>
<li>configuration values are valid</li>
<li>inter-node clock skew is within the permissible maximum skew value </li>
<li>all nodes have supported Java versions</li>
<li>all nodes have correct network connectivity</li>
<li>all nodes have compatible NoSQL DB versions</li>
</ul>
<pre>
java -jar kvstore.jar diagnostics verify -help

Usage: verify -checkLocal |
              -checkMulti

</pre>
</li>
</ol>

<h3><a name="BugFixes334">Bug and Performance Fixes</a></h3>

<ol>
<li>
Changes have been made to transfer the RN master nodes on SN shutdown.
When a SNA shuts down it checks if any of the RNs managed by the SNA is
a master for its replication group. If an RN is a master, the SNA causes
a master-transfer before shutting down the RN. The implementation performs
the transfers one at a time so that each transfer can take into account the
results of the previous one, to avoid overloading the target SNs.  [#22426]
</li>
<li>
Modified the replication node and admin services to permit them to start
up even if other members of a service's replication group were managed
by storage nodes whose hostnames cannot be resolved via DNS.  This
change allows the store to continue to function, and in particular to
support restarting services, if failures of storage nodes cause the
nodes to have unresolvable DNS names.  [#23120]
</li>
<li>
Modified the 'topology validate' CLI command. In addition to the
'violations' and 'notes' that are currently displayed by that command,
it now also notes when the topology contains any zones that are empty;
that is, the zones that contain no SNs.  [#23222]
</li>
<li>
Currently the 'verify configuration' CLI command performs a
component-by-component comparison of the store's current state or
configuration against what is reflected in the store's Admin database,
and displays any inconsistencies. Modified the command to also note
when any empty zones exist in the store. With respect to the current
the flags taken by the 'verify configuration' command, any changes
related to empty zones should apply to all arguments except the
optional -sn argument; in which case, the new behavior related to
identifying empty data centers should not be executed.  [#23223]
</li>
<li>
The CLI 'snapshot' commands currently allow one to collect a snapshot
from each Admin and RN of every reachable SN in the store, or to
remove one or all instances of previously collected snapshot
data. These commands have been modified to take a '-zn' or '-znname'
flag so that the command applies to all the SNs executing in the zone
with the specified id or name.  [#23224]
</li>
<li>
A bug has been fixed that could cause the Admin service to hang if the
Admin web console is enabled, and is displaying log file output within
the logtail pane, and an administrative command that updates Admin
service configuration, such as plan deploy-admin, is running. [23907]
</li>
<li>
Clarified an error message that would occur when a field name was
used instead of <i>elementof()</i> in a CHECK expression involving a map
or array. [#24055]
</li>
<li>
Relaxed the DDL PRIMARY KEY expression, allowing the statement to
redundantly specify single primary key fields as a SHARD keys as
well.  In a top-level (non-child) table the primary key is equivalent
to the shard key unless otherwise specified.  This change makes statements
like this legal even though use of "SHARD" is redundant:
<i>CREATE TABLE mytable(id INTEGER, PRIMARY KEY(SHARD(id)))</i>.
[#24105]
</li>
<li>
Changes have been made to the request dispatcher to favor more rapid
request failover on a node failure, reducing the possibility of a
RequestTimeoutException. As part of this change, the default socket
open timeouts have been reduced from 5 seconds to 3 seconds to permit
a redispatch of requests within the request timeout period.  [#24152]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.2.15</u></h3>
<h3><a name="NewFeatures3215">New Features</a></h3>
<ol>
<li>
A declarative data definition language has been defined that allows
declarative creation and management of tables and indexes.  The
language reference is
in <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSTBJ-GUID-F1053BED-01E9-4BD4-BF9E-6354A8AA12FF">
Table Data Definition Language Overview</a>.  The language is accessible via APIs
in Java as well as the new C driver.  It can also be executed using the new
"execute" command in the administrative command line interface (Admin CLI).
</li>
<li>
The Command Line Interface (Admin CLI) has a new "execute" command that can
be used to execute data definition language (DDL) statements. The Java
or C API is the preferred mechanism for defining tables, but if you
wish to define and manage tables via the Admin CLI, the "execute" command is
preferred over the previous "table" command.
</li>
<li>
A new C driver has been created to operate on tables and indexes
in Oracle NoSQL Database.  It is a separately downloadable product on
the same page as this distribution.  It is source code and must be compiled,
along with its dependent libraries.  Complete instructions are in its
distribution.
</li>
<li>
The implementation of indexes on maps has been enhanced so that it is
now possible to create an index on the key strings of a map as well as
an index on the values of a map, making these indices much more useful
for a variety of data models. These indexes result in multiple
index entries for a given row, up to the number of map
entries. Additional APIs were added to help use these indexes.
</li>
<li>
When using the Admin CLI interactively, you can now use backslash to
enter a command on multiple lines. For example, you can now type:
<pre>
kv-> show events -type stat
 or
kv-> show events \
> -type stat
</pre>
</li>
<li>
A new diagnostics command line utility is available to provide support
for troubleshooting an Oracle NoSQL DB cluster. Currently, the
"collect" functionality lets a user easily retrieve and package
logfiles each node in the cluster for further analysis. Additional
functionality will be rolled out over time. The new utility is invoked
this way:
<pre>
java -jar kvstore.jar diagnostics

diagnostics-> help
Oracle NoSQL Database Diagnostic Utility Commands:
	setup
	collect
	exit
	help

diagnostics->
</pre>
</li>
</ol>
<h3><a name="APIChanges3215">API Changes</a></h3>
<ol>
<li>
<code>oracle.kv.table.TableAPI.execute(String)</code> and
<code>oracle.kv.table.TableAPI.executeSync(String)</code> were added
to execute Data Definition Language (DDL) statements.
</li>
<li>
New interfaces, <code>oracle.kv.table.StatementResult</code> and
<code>oracle.kv.table.ExecutionFuture</code> were added to handle
results of the new statement execution methods
on <code>TableAPI</code>.
</li>
<li>
<code>oracle.kv.table.MapValue.putNull(String)</code> and the constant,
<code>oracle.kv.table.MapValue.ANONYMOUS</code>, were added in order to
handle new the map indexes.
</li>
<li>
<code>oracle.kv.table.Index.createMapKeyFieldRange(String)</code> and
<code>oracle.kv.table.Index.createMapValueFieldRange(String)</code> were added
to create <code>FieldRange</code> instances for the new map indexes.
</li>
<li>
The method
<code>oracle.kv.table.TableAPI.execute(List&lt;TableOperation&gt;,
WriteOptions)</code> used to throw
<code>oracle.kv.OperationExecutionException</code>. However,
<code>OperationExecutionException</code> provides information that
applies to the key value API in the <code>oracle.kv</code> package
rather than the Table API in
<code>oracle.kv.table</code>.The method has been changed to throw a
new exception,
<code>oracle.kv.table.TableOpExecutionException</code>, which provides
information suitable for the Table API.
<p>
Note that this is an incompatible API change. Applications which
invoked <code>TableAPI.execute(List&lt;TableOperation&gt;,
WriteOptions)
</code> must be modified to
handle <code>TableOpExecutionException</code> instead of
<code>OperationExecutionException</code>.

</li>
</ol>
<h3><a name="BugFixes3215">Bug and Performance Fixes</a></h3>
<ol>
<li>
The CLI verbose and hidden commands have been enhanced so they can be
specified using on/off parameters in addition to the previous toggle
type functionality.
[#23245]
</li>
<li>
Modified the Admin CLI help to not display deprecated commands by
default.A new -includeDeprecated flag was added for the CLI help
command. If this flag is used, the deprecated commands are listed along
with other commands.
[#23365]
</li>
<li>
The <code>java -jar kvstore.jar load</code> utility did not provide
proper feedback when there were errors in operation, and incorrectly
returned "Load succeeded". Now it returns both a non-zero status code
when an error has been found and an accurate status message. [#23681]
</li>
<li>
Fixed a security weakness that let arbitrary authenticated clients
modify the store's topology by specifying an altered topology when
propagating topology changes from one RN to another. A signature-based
topology integrity check is employed to prevent it. [#23709]
</li>
<li>
A window existed where a secondary index could incorrectly lose
entries if the store was expanded while updates to the underlying
table were happening. This window has been closed. [#23724]
<li>
Fixed an issue that required users to reauthenticate to the store in
order for changes made by granting or revoking roles for the current
user to take effect. A real-time session update mechanism was
introduced that allows existing login sessions to reflect role changes
immediately without reauthentication. [#23839]
</li>
<li>
Fixed a bug that sometimes prevented re-execution of interrupted
change-parameters plans, when Admin parameters were being changed. [#23880]
</li>
<li>
Fixed a problem where a client performing a parallel scan against a
secure store without having permission to read the store would get a
timeout exception rather than having the scan return no values. This
problem could be encountered when using the <code>get kv -all</code>
command with the administrative CLI:
<pre>
kv-> get kv -all
Error handling command get kv -all: Failed to iterate records :
Parallel storeIterator Request Queue take timed out.
(12.1.3.1.3) Timeout: 5000ms
</pre>
If the scan was performed via the API using the
<code>KVStore.storeIterator</code> or <code>storeKeysIterator</code>
method overloadings that supply a <code>StoreIteratorConfig</code>, the
problem could cause the method call to throw a
<code>RequestTimeoutException</code>. In all of these cases, the
iteration now returns no elements. [#23881]
</li>
<li>
Fixed an issue that would result in duplicate values returned from the
Hadoop APIs when a complete primary key is specified. [#23958]
</li>
<li>
Fixed a bug where iteration over array indexes when the result set was
larger than the batch size (default 100) could result in incorrect
results or a hang. [#23977].
</li>
<li>
Fixed a slow memory leak in the handling of socket timeouts: The socket
object associated with a failed socket connect operation continued to be
referenced and could not be garbage collected. [#24039]
</li>
</ol>

<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.1.7</u></h3>
<h3><a name="NewFeatures317">New Features</a></h3>
<ol>
<li>Added a convenience method on the Table interface to construct a
  MultiRowOptions instance from a single list of table names and
  optional FieldRange. [#23807]
</li>
<li>Added FieldRange.getField() to return the FieldDef instance that
was used to construct the FieldRange object. [#23908]</li>
</ol>
<h3><a name="BugFixes317">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a problem that caused index creation on an empty table to take as
much as 10 minutes to complete. [#23826]
</li>
<li>
Fixed a performance regression in the CLI delete command.  This fix
may result in some delete commands being slower because the problem
was an optimization for some delete cases, but in the general
case delete will have the same performance it had in release
3.0.5. [#23918]
</li>
<li>
Removed unnecessary non-topology metadata broadcasts to replica rep nodes.
Since only a master rep node can update the metadata for the shard there is no
point in attempting to update a replica. With this change two new admin
parameters have been added to control the metadata broadcast:
<ul>
    <li>
    <i>broadcastMetadataDelay</i> specifies the broadcast metadata retry delay.
    This delay is the time between attempts to update RNs when trying to meet
    the metadata threshold. If not specified, the default delay is 10 seconds.
    </li><li>
    <i>broadcastMetadataThreshold</i> specifies the broadcast metadata
    threshold. The threshold is the percent of shards that must be successfully
    updated during a broadcast. If not specified, the default threshold is 20%.
    </li>
</ul>
<br>
Note that this fix only affects the broadcast of table and security metadata.
The topology broadcast parameters and behavior remain unchanged. [#23362]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.1.5</u></h3>
<h3><a name="NewFeatures315">New Features</a></h3>
<ol>
<li>
Added support for role-based authorization for both the API and the
administrative CLI. Authorization is built on the authentication mechanism
introduced in release 3.0. Each authenticated user of the KVStore can be
granted roles which determine which APIs and CLI commands the user can
access. This release only supports built-in roles, including the "read" and
"write" roles for data access control, and the "sysadmin" and "dbadmin" roles
for system and database operation control, respectively. More details of this
feature are described in the Oracle NoSQL Database Security Guide.
<p>
The KVStore logging system has also been enhanced to log security
sensitive events.  Two new logging levels named SEC_WARNING and
SEC_INFO have been introduced.  Messages logged at SEC_WARNING level
will produce critical events in the CLI.  High level security events
like failed login attempts and unauthorized operations will be
recorded as SEC_WARNING KVStore events. Execution of CLI commands
which require sysadmin or dbadmin roles will be recorded as SEC_INFO
events. Logging messages of all security sensitive events have
"<i>timestamp</i> KVAuditInfo" as the prefix for the ease of grepping
and filtering. [#23423]
</li>

<li>
The makebootconfig command has been enhanced to do validity checking
of all parameters. The -force flag has been added to let the user
manually override the default validity checks if desired.
[#23422]
</li>
</ol>

<h3><a name="BugFixes315">Bug and Performance Fixes</a></h3>
<ol>
  <li>Fixed a bug that could cause the plan change-parameters command
  to fail in some cases, reporting a NullPointerException in the plan
  history. This could only come about in some situations where the
  parameter change requires restarting all nodes, but not all nodes
  are available.
  [#22673]
  </li>

  <li>
  Modified heap size calculations for replication nodes to reduce heap
  sizes in some cases to permit using compressed object references.
  <p>
  The supported Java environments can use compressed object references
  when the heap size is smaller than a certain size, currently between
  25 and 32 GB depending on the implementation. Because the space
  savings provided by compressed references are substantial, using a
  larger heap size typically results in less usable space unless the
  heap size is at least 50% larger than the largest size that supports
  compressed references.
  <p>
  The system now automatically reduces the replication node heap size if
  the value of the memoryMB storage node parameter produces a heap size
  that is too large to support compressed references but not large
  enough to provide more usable space. The heap size is not reduced if
  the application specifies a javaMiscParams replication node parameter
  that explicitly specifies either non-compressed references or the
  maximum heap size. Note that, if the memoryMB parameter is not
  specified explicitly, or is set to zero, the system sets it to the
  amount of physical memory available on the host, and will reduce the
  heap size in the same way as when memoryMB is set explicitly to a
  non-zero value. [#22695]
  </li>

  <li>The Version.getVersion method has been deprecated and removed from
  the public documentation.  It will probably be removed entirely in a
  future release.  The getVersion method returns an internal version
  number which is only meaningful relative to a particular shard.  For
  that reason, it is not a safe to compare the method results for
  arbitrary versions, and so it has been removed.  Applications can
  continue to use the equals method to compare versions for identity,
  but there is currently no official way to compare versions to
  determine which is newer.  We could add that capability in the future
  if applications have a need for it.  [#23526]
  </li>

  <li> The plan add-index command has been changed to check for
  index creation status more promptly, which lets the command finish sooner.
  [#23568]
  </li>

  <li>Added additional type validation when JSON input is used to
  construct Row and PrimaryKey instances.  Previously it was possible
  to provide incorrect types that were silently cast to the correct
  type based on the table schema, possibly resulting in loss of
  information. [#23765].
  </li>

  <li>Fixed a problem that could be encountered during the
  configuration of a NoSQL Database cluster hosted within an IBM J9
  JVM environment.  If the Storage Nodes were deployed without
  providing an explicit value for the optional memory_mb parameter,
  the available memory calculation for the Replication Node hosted on
  that SN was incorrect, which might cause an "OutOfMemoryError" for
  that replication node when the plan deploy-topology command was
  run. This could only happen on the J9
  JVM, and has been fixed. [#23737].
  </li>

  <li>
  Both Hadoop and Oracle External Tables employ independent processes to
  read data from a store in parallel. A change has been made to the way work is
  distributed among these processes. The new algorithm attempts to distribute
  work in a way that minimizes contention on a single replication node, while
  maximizing the amount of parallelism across the store. The number of shards,
  the replication factor, and the requested consistency, are input into the
  calculation. This change may also affect the number of Hadoop processes, or
  splits which are generated. In addition to the change in work distribution,
  both Hadoop and external table processes may use the Parallel Scan APIs,
  allowing multiple threads to operate in a single process. [#23749]
  <br>
  Note that the public method
  <code>oracle.kv.hadoop.KVInputFormatBase.setDirection(Direction)</code>
  has been deprecated since only <code>Direction.UNORDERED</code> is supported.
  </li>

  <li>Fixed a problem where, if an index was created on an array, or
  field in an array, and the array itself is null in a Row, a
  ClassCastException could be thrown during index key extraction on a server
  node. [#23757].
  </li>

  <li> Modified the Ant build script so that the default target, which
  builds the JAR files, works for the Community Edition.  You can now
  use ant to build new versions of the JAR files after making
  modifications to the source code. [#23764]
  </li>

  <li>
  If a client program made an unexpected, non-secure call to the trusted
  login service of an Storage Node, a flaw in the service implementation caused the
  service to hang, causing future user logins to fail. This bug has been
  fixed. [#23786]
  </li>

  <li>Fixed an issue with a runaway number of client threads when multiple
  index iterators are opened and closed in quick succession. Specifically,
  the iterator's close() method will now wait for its threads to exit before
  returning. This is the same behavior as the parallel scan iterators,
  though it is documented that it does not wait. The documentation has
  been corrected. [#23797]
  </li>

  <li> Fixed a bug which could result in a deadlock situation when an index
  iterator is closed. As part of this fix the Javadoc for the
  <code>oracle.kv.KVStore</code> and <code>oracle.kv.table.TableAPI</code>
  interfaces have been updated to make it clear that the iterators returned by
  those interfaces can only be used safely by one thread at a time unless
  synchronized externally.
  [#23799]
  </li>

  <li>
  In the course of upgrading a NoSQL cluster from R2.X to R3.x, when
  the first Storage Node upgrade occurs, the Replication Node it hosts
  will transition into "STARTING" status and will wait until more nodes
  are upgraded. If the user runs the "verify upgrade" command at this
  point, they would see the following, misleading error:
  <pre>
   kv-> verify upgrade
   Unknown Exception: class oracle.kv.impl.rep.admin.RepNodeAdminFaultException
   RepNode is not RUNNING, current status is STARTING (12.1.3.1.2)
   oracle.kv.impl.rep.admin.IllegalRepNodeServiceStateException:
   RepNode is not RUNNING, current status is STARTING
  </pre>
  This has been fixed. [#23859]
  </li>

  <li>The following parameters used by the Berkeley DB JE storage
  engine used within NoSQL Database have been changed to reflect
  changes in the updated version of JE used by this release:
  <ul>
  <li>EnvironmentConfig.EVICTOR_MAX_THREADS which was previously set to 2
  now uses the default JE value.
  </li>
  <li>EnvironmentConfig.CHECKPOINTER_BYTES_INTERVAL has been changed from
  200000000 to 500000000.
  </li>
  </ul>
  </li>

  <li>
  Fixed a performance issue where
  the <a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/AdminGuide/independent_commands.html#stopagent">
  stop</a> utility command resulted in an incomplete checkpoint
  if the checkpoint took more than 10 seconds. The incomplete checkpoint could
  result in the replication node taking longer to restart than it would
  with a complete checkpoint. The <i>stop</i> command has also been modified to
  initiate checkpoints in parallel across all the replication nodes hosted by
  the storage node being shutdown, thus making the command run faster.
  </li>
  <li>
  Fixed a problem that caused upgrading from earlier releases to a 3.0
  release to fail in some cases, with the following stack trace in the
  Admin log. [#23879]
  <pre>
com.sleepycat.persist.evolve.IncompatibleClassException: (JE 6.2.5) Changes to the fields or superclass were detected when evolving class:
oracle.kv.impl.admin.plan.task.StopAdmin version: 1 to class: oracle.kv.impl.admin.plan.task.StopAdmin version:
1 Error: A new higher version number must be assigned
---
(Note that when upgrading an application in a replicated environment, this exception may indicate that the Master was mistakenly upgraded
before this Replica could be upgraded, and the solution is to upgrade this Replica.)
    at com.sleepycat.persist.impl.PersistCatalog.init(PersistCatalog.java:512)
    at com.sleepycat.persist.impl.PersistCatalog.initAndRetry(PersistCatalog.java:268)
    at com.sleepycat.persist.impl.PersistCatalog.&lt;init&gt;(PersistCatalog.java:228)
    at com.sleepycat.persist.impl.Store.&lt;init&gt;(Store.java:202)
    at com.sleepycat.persist.EntityStore.&lt;init&gt;(EntityStore.java:190)
    at oracle.kv.impl.admin.Admin.initEstore(Admin.java:2126)
</pre>
  </li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.0.14</u></h3>
<h3><a name="NewFeatures3014">New Features</a></h3>
<ol>
<li>
When using the Table API, it is now possible to create indices on
fields in records, maps, and arrays. [#23091]
</li>
<li>
The integration of Oracle NoSQL Database with Oracle Coherence has been updated to
support Coherence 12c (12.1.2). As of Coherence 12.1.2, cache configuration
parameters are specified within a custom XML namespace and are processed by the
NoSQL Database namespace handler at runtime. Though it's possible to use this
updated module with Coherence version 3.7.1, we highly recommend that you upgrade
Coherence to the latest version. Please see the javadoc for
<code>oracle.kv.coherence</code> package for information on how to configure a NoSQL Database
backed cache with Coherence 12.1.2, or the earlier Coherence 3.7.1. [#23350]
</li>
<li>
It is now possible to use Oracle External Tables to access Oracle NoSQL Database tables created with the Table API.
In addition to the usual required properties, users need to specify the
table name in the external table configuration file.
Please see KVHOME/examples/externaltables/cookbook.html for details.[#23605]
</li>
<li>
Added a new "size" option to the Admin CLI table command, to estimate
the in-memory size of the given table. The results of the size command
can be used as inputs when planning resource requirements for a store.
[#23444]
</li>
<li>
Oracle Enterprise Manager can now monitor instances of Oracle NoSQL Database.
For more information, please see
<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSADM-GUID-414B80D2-64EF-4C64-8515-025481DACF05 with Oracle NoSQL Database)">
Integrating Oracle Enterprise Manager (OEM) with Oracle NoSQL Database</a> in the Admin Guide.
</li>
<li>
It is now possible to access data written to an Oracle NoSQL Database via the
Table API from within a Hadoop MapReduce job. In addition to the usual required
properties, users now need to specify the table name in the command line used
to initiate the MapReduce job. Please refer to the javadoc of the class,
KVHOME/examples/hadoop/table/CountTableRows.java for additional details.[#23714]
</li>
<li>
It is now possible to execute Hive queries against data written to an Oracle
NoSQL Database via the Table API. To employ this feature, one must create a
Hive external table that is 'STORED BY' the new oracle.kv.hadoop.hive.table.TableStorageHandler
class, with fields similar to the fields with which the Oracle NoSQL Database
table was created; that is, same number and types. Additionally, the Hive
TBLPROPERTIES must specify the store name, the helper host and ports, and the
table name (which does not have to be equal to the Hive table name).[#23714]
</li>
</ol>
<h3><a name="BugFixes3014">Bug and Performance Fixes</a></h3>
<ol>
<li>
Added more sanity checking and improved error messages for the
securityconfig add/remove-security commands.  [#23311]
</li>
<li>
Fixed a bug where specifying an invalid value for the Storage Node
parameter, "mgmtClass" could cause a crash in the Admin service.
[#23227]
</li>

<li>
Modified the oracle.kv.RequestLimitConfig constructor to improve
bounds checking and correct problems with integer overflow. [#23244]
</li>

<li>
Fixed a bug that sometimes caused Admin parameters not to take effect
until the Admin's hosting SNA was rebooted. [#23429]
</li>

<li>
Added a new attribute (String replicationState) in the RepNode MBean
presented via JMX, to indicate the state of the RepNode's membership
in its replication group.  Typically the value will show "MASTER" or
"REPLICA", but it can also report "DETACHED" or "UNKNOWN".  This same
value is reported via SNMP in the repNodeReplicationState object, as
defined in nosql.mib. [#23459]
</li>

<li>
Modified the Durability, RequestLimitConfig, and Version classes to
implement Serializable to permit serializing instances of
oracle.kv.KVStoreConfig, which was already serializable.  [#23474]
</li>

<li>
Fixed a bug where an operation using the Table API might see a
SecondaryIntegrityException if there is a replication node failover
while secondary index is populated. [#23520]
</li>

<li>
Prior to this release, it was not possible use the Load utility to create
a new store from snapshot files that had been taken against a store
with security enabled, or a store that was using the Table API.  This
has been fixed. The -security, -username, -load-admin, and -force
flags were added to the load utility to use in this case. See the
Administrator's Guide for more information. [#23528]
</li>

<li>
Fixed a bug where invoking the "history" command in the Admin CLI with
the "-last" option and a value that is greater than the total number
of commands executed in the store could result in a
java.lang.ArrayIndexOutOfBoundsException. [#23579]
</li>

<li>
Fixed a bug where an Admin service might exit with the following
exception. Before the fix, administrative functionality would
seamlessly fail over to another admin service, but the process exit
was unnecessary and would show up as an alertable event.
<pre>
com.sleepycat.je.rep.UnknownMasterException:
Transaction -XXX cannot execute write operations because this node is no longer a master
</pre>
[#23580]
</li>

<li>
Fixed a bug in the Table API so that enum fields may have names that begin
      with an underscore.
</li>

<li>
In rare cases, when a store has been deployed with Storage Nodes with
capacity > 1 and there are concurrent delete operations, table iteration operations,
and a transfer of mastership roles in a shard, it could be possible
for the iteration operation to incorrectly skip a value that should
have been returned by the iterator. This has been fixed. [#23608]
</li>

<li>
Fixed a GC configuration issue that could cause the CMS phase of the Java GC to
run repeatedly, consuming CPU resources on an otherwise idle RepNode. The fix
changed the default JVM CMSInitiatingOccupancyFraction from 77 to
80. Our testing indicates that this is a better configuration under a broad
range of application access patterns. However, if you need to override this new
configuration in some unusual circumstance, you can use the Admin's
<i>change-policy</i> command and, if it's an existing store, the <i>plan
change-parameter</i> command, as below:
<pre>
change-policy -params "javaMiscParams=-XX:CMSInitiatingOccupancyFraction=77"
plan change-parameters -all-rns -params "javaMiscParams=-XX:CMSInitiatingOccupancyFraction=77"
</pre>
[#23652]
</li>
<li>
Fixed the following bugs which could occur in a store with security
enabled:
<ul>
<li>
The following error could be reported after a deploy-topology command
which deploys a new replication node in a security enabled store:
[#23682]
<pre>
Task 23/DeployNewRN on sn1(slc06tyu:5000) ended in state ERROR
oracle.kv.impl.fault.RNUnavailableException: Security metadata
database is not opened yet.
</pre>
<li>
The following exception could be seen after an elasticity change in a
          security enabled store: [#23703]
<pre>
Insufficient access rights : client host: xx.xxx.xxx.xx:
attempt to call RepNodeAdmin.updateMetadata(MetadataInfo,AuthContext,short)
</pre>
<li>
The following problem might be logged after an elasticity change in a
          security enabled store: [#23704]
<pre>
ProcessMonitor: java.lang.NullPointerException
ProcessMonitor: at oracle.kv.impl.api.rgstate.RepNodeState$ReqHandlerRef.resolve(RepNodeState.java:649)
ProcessMonitor: at oracle.kv.impl.api.rgstate.RepNodeState$ReqHandlerRef.get(RepNodeState.java:709)
</pre>
</ul>
</li>
<li>
Fixed a bug where application requests might unnecessarily time out
for a brief period of time directly after an elasticity change [#23705]
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="Packaging3014">Packaging and Documentation Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
The version of the Oracle Coherence library bundled with Oracle NoSQL
Database has been upgraded to the more recent Coherence 12.1.2. This
requires a change in the way cache configuration parameters are
specified for the NoSQL Database backed cache.
</li>
<li>
New documentation has been added on how to use the Large Object
API. See the index page, and "Oracle NoSQL Database Large Object API".
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.0.9</u></h3>
<h3><a name="NewFeatures309">New Features</a></h3>
<ol>
<li>
Modified the administrative CLI to save its command line history to a
file so that it is available after restart.  If you want to disable this
feature, the following Java property should be set while running
runadmin:
<pre>
java -Doracle.kv.shell.jline.disable=true -jar KVHOME/kvstore.jar runadmin -host &lt;hostname&gt; -port &lt;portname&gt;
</pre>
<p>
The CLI attempts to save the history in a
<code>KVHOME/.jlineoracle.kv.impl.admin.client.CommandShell.history</code>
file, which is created and opened automatically. The default history
saved is 500 lines.  If the history file cannot be opened, it will fail
silently and the CLI will run without saved history.
<p>
The default history file path can be overridden by setting
the <code>oracle.kv.shell.history.file=</code><i>path</i> Java property.
<p>
The default number of lines to save to the file can be modified by
setting the <code>oracle.kv.shell.history.size=</code><i>int_value</i> Java
property. [#22690]
</li>
<li>
Modified the admin CLI <code>aggregate</code> command to provide
subcommands for tables and key/value entries.  The <code>aggregate
table</code> subcommand performs simple data aggregation operations on
numeric fields of a table, while the <code>aggregate kv</code>
subcommand performs aggregation operations on keys. [#23258]
</li>
</ol>
<h3><a name="BugFixes309">Bug and Performance Fixes</a></h3>
<ol>
<li>
Modified the implementation of index iterators to use weak references so
that the garbage collector can remove the resources associated with
unused index iterators. [#23306]
</li>
<li>
Improved the handling of metadata propagation and other
internal operations. [#23355] [#23368] [#23385]
</li>
<li>
Modified the external tables integration to distribute the concurrent
processing load more evenly across processes. [#23363]
</li>
<li>
Fixed a problem where a failure during a partition migration performed
during a topology redistribution for a store that has indexes resulted
in <code>SecondaryIntegrityException</code>s being thrown when the
migration was restarted. [#23392]
</li>
<li>
Removed the <code>FieldRange.setEndDate</code> method, in favor of the
existing <code>setEnd</code> method. [#23399]
</li>
<li>
Modified schema evolution to prevent changes that could resurrect an old
field using a different type. Such a change would cause old data to
become unreadable by the current table. This fix prevents resurrection
of a field name unless it exactly matches the previous
definition. [#23403]
</li>
<li>
Fixed a problem with handling network timeouts that could result
in <code>FaultException</code> being thrown from KVStore operations
instead of <code>RequestTimeout</code> when a timeout occurs.  Here's a
sample stack trace:
<pre>
Caused by: oracle.kv.FaultException: Problem during unmarshalling (12.1.2.1.24)
Fault class name: java.rmi.UnmarshalException
    at oracle.kv.impl.api.RequestDispatcherImpl.faultIfWrite(RequestDispatcherImpl.java:968)
    at oracle.kv.impl.api.RequestDispatcherImpl.handleRemoteException(RequestDispatcherImpl.java:883)
    at oracle.kv.impl.api.RequestDispatcherImpl.handleDispatchException(RequestDispatcherImpl.java:736)
    at oracle.kv.impl.api.RequestDispatcherImpl.execute(RequestDispatcherImpl.java:572)
    at oracle.kv.impl.api.RequestDispatcherImpl.execute(RequestDispatcherImpl.java:1031)
    at oracle.kv.impl.api.KVStoreImpl.executeRequest(KVStoreImpl.java:1251)
    at oracle.kv.impl.api.KVStoreImpl.putIfVersion(KVStoreImpl.java:990)
    at oracle.kv.impl.api.KVStoreImpl.putIfVersion(KVStoreImpl.java:968)
    [...]
    ... 41 more
Caused by: java.rmi.UnmarshalException: Error unmarshaling return header; nested exception is:
    java.net.SocketException: Socket closed
    at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:228)
    at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:161)
    at java.rmi.server.RemoteObjectInvocationHandler.invokeRemoteMethod(RemoteObjectInvocationHandler.java:194)
    at java.rmi.server.RemoteObjectInvocationHandler.invoke(RemoteObjectInvocationHandler.java:148)
    at com.sun.proxy.$Proxy21.execute(Unknown Source)
    at oracle.kv.impl.api.RequestHandlerAPI.execute(RequestHandlerAPI.java:94)
    at oracle.kv.impl.api.RequestDispatcherImpl.execute(RequestDispatcherImpl.java:560)
    ... 46 more
Caused by: java.net.SocketException: Socket closed
    at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:121)
    at java.net.SocketOutputStream.write(SocketOutputStream.java:159)
    at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82)
    at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140)
    at java.io.ObjectOutputStream$BlockDataOutputStream.flush(ObjectOutputStream.java:1822)
    at java.io.ObjectOutputStream.flush(ObjectOutputStream.java:718)
    at sun.rmi.transport.StreamRemoteCall.releaseOutputStream(StreamRemoteCall.java:114)
    at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:212)
    ... 52 more
</pre>
[#23411]
</li>
<li>
Modified table iteration to optimize performance when all matching
entries fall within a single shard. [#23412]
</li>
<li>
Fixed an issue where the index scan iterator would fail to return
records from a shard if there was a record that compared equal to a
record from another shard.  This situation occurred when there was more
than one shard in a store and there were equivalent index entries for a
given index in both shards.  The symptom was index iteration returning
fewer rows than expected. [#23421]
</li>
<li>
Added several interfaces to the table package:
  <ul>
    <li> <code>List&lt;String&gt;IndexKey.getFields()</code> to return the
    fields used to define the index.</li>
    <li> <code>List&lt;String&gt;PrimaryKey.getFields()</code> to return the
    fields used to define the primary key.</li>
    <li> <code>List&lt;String&gt;RecordValue.getFields()</code> to return the
    fields used to define the record, in declaration order.</li>
    <li> <code>Map&lt;String, FieldValue&gt; MapValue.getFields()</code> to
    return an immutable view of the map.</li>
  </ul>
The related javadoc was also updated to indicate that the lists and
maps returned from these, and similar interfaces, are immutable.
[#23433]
</li>
<li>
The data Command Line Interface (CLI) has a method to input table rows
from a file with a JSON representation.  This input method had an
issue where a blank line could cause an infinite loop in the input
path.  This has been fixed in a way that will result in silently
skipping blank lines as well as comment lines (those whose first
non-whitespace character is "#").
[#23449]
</li>
<li>
Fixed handling of null values in indexed fields and in IndexKey.
Previously, a null value in an indexed field could cause a server side
exception.  During a put, null values in indexed fields will result in
no index entries for indexes in which that field participates.  Further,
null values are not allowed in IndexKey instances.
IllegalArgumentException is thrown if an attempt is made to set a null
value in an IndexKey. [#23588]
</li>
<li>
Modified the Admin Service to listen on all interfaces on a host. This
change permits deployment of KVStore in heterogeneous network
environments, where a hostname may be resolved to different IP
addresses to make the best possible use of the available network
hardware.  [#23524]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.0.5</u></h3>
<h3><a name="NewFeatures305">New Features</a></h3>
<ol>
<li>
  A new client interface has been added that includes a set of
  datatypes and a tabular data model using those types. The tabular
  data model is used to provide support for secondary indexes which
  are defined on fields in a  table.  The model is discussed in the
  <a
  href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSTBJ-GUID-2C12DC44-6459-4190-93CB-5DC6C3A7C6DA">
  Getting Started Guide for Tables</a>
  <p>
  Tables and indexes are defined using the administrative CLI and
  accessed via programmatic API.  The data CLI has been enhanced to
  perform operations on tables and indexes as well.  The API is
  documented in the <a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/java-api/index.html">
  Oracle NoSQL Database javadoc</a>, and is primarily in  the
  <i>oracle.kv.table</i> package.
  <p>
  It is possible to define tables that overlay data created with NoSQL
  DB Release 2 if that data was created using a conforming Avro
  schema.  This overlay is required in order to create secondary
  indexes on conforming Release 2 data.
  <p>
  The existing key/value interface remains available.
</li>
<li>
It is now possible to define secondary indexes for records.  See the previous
changelog entry about tables.  Index entries for a given record have
transactional consistency with their corresponding primary records.
Index iteration operations are part of the new table API.  Index scan
operations allow applications to iterate over raw indexes in 3
ways -- forward order, reverse order, and unordered.  It is possible
to define exact match and range scans in indexes.  Indexes can be on
single fields or defined as composite indexes on multiple fields in a
table.
</li>
<li>
Support for username/password authentication and secure network communications
has been added.  Existing applications that do not require this feature are not
impacted except for a change to makebootconfig, which adds a new required
argument (<code>-store-security</code>). Users that wish to use the new
capabilities should be aware of the following areas of change:
<ul>
<li>
The makebootconfig utility has a new required
<code>-store-security</code> command-line argument, which is used to
enable security for a new KVStore deployment. The -store-security flag
is also used to enable a non-secure deployment, and is actually
required in that case (-store-security none).
</li>
<li>
A new securityconfig tool has been added, which provides the ability to:
<ul>
<li>Create security configurations</li>
<li>Create/modified password stores</li>
<li>Enable security on a pre-existing, non-secure KVStore</li>
<li>Perform security maintenance tasks</li>
</ul>
</li>
<li>
Additional methods on the KVStoreConfig class:
<ul>
<li><code>setSecurityProperties()</code></li>
<li><code>getSecurityProperties()</code></li>
</ul>
</li>
<li>
An additional method on the KVStoreFactory class supporting authentication:
<ul>
<li><code>KVStoreFactory.getStore(KVStoreConfig, LoginCredentials, ReauthenticateHandler)</code></li>
</ul>
<p>
This new method utilizes the new interfaces
<ul>
<li><code>LoginCredentials</code></li>
<li><code>ReauthenticateHandler</code></li>
</ul>
<p>
As well as the new class <code>PasswordCredentials</code>.
</li>
<li>
Additional methods on the KVStore interface:
<ul>
<li><code>login()</code></li>
<li><code>logout()</code></li>
</ul>
</li>
<li>
New exception classes:
<ul>
<li><code>UnauthorizedException</code></li>
<li><code>AuthenticationFailureException</code></li>
<li><code>AuthenticationRequiredException</code></li>
</ul>
</li>
</ul>
<p>
Users should also familiarize themselves with security property files, which
are required when using a KVStore command-line utility program against a secure
store, and which may also be useful when running an application against a secure
store.
<p>
This feature is described in much greater depth in the Oracle NoSQL Database Security Guide, as well as in the Administrators Guide and product Javadoc.
</li>
<li>
The administrative CLI has been modified to use new terminology to refer
to data centers.  Data centers are now called <i>zones</i>.  The new
terminology is meant to clarify that these node groupings may not always
coincide with physical data centers.  A zone is a collection of nodes
that have good network connectivity with each other and have some level
of physical separation from nodes in other zones.  That physical
separation may mean that different zones are located in different
physical data center buildings, but could also represent different
floors, rooms, pods, or racks, depending on the particular deployment.
<p>
Commands that contained the word "datacenter" have been deprecated, and
are replaced with commands using the word "zone". The previous commands
will continue to work in this release. New commands are:
<ul>
<li><code>plan deploy-zone</code>
<li><code>plan remove-zone</code>
<li><code>show zones</code>
</ul>
<p>
Command flags that specify a zone have been changed to <code>-zn</code>,
for a zone ID, and <code>-znname</code>, for a zone name. The
earlier <code>-dc</code> and <code>-dcname</code> flags have been
deprecated but will continue to work in this release.  In addition, zone
IDs can now be specified using the "zn" prefix, with the earlier "dc"
prefix still currently supported.
<p>
The administrative GUI has also been modified to use the new Zone
terminology. [#22878]
</li>
<li>
There are now two types of zones.  <i>Primary</i> zones contain
electable nodes, which can serve as masters or replicas, and vote in
master elections.  All zones (or data centers) created in earlier
releases are primary zones, and new zones are created as primary zones
by default.  <i>Secondary</i> zones contain nodes of the
new <i>secondary node</i> type, which can only serve as replicas and do
not vote in master elections.  Secondary zones can be used to make a
copy of the data available at a distant location, or to maintain an
extra copy of the data to increase redundancy or read capacity. [#22483]
</li>
<li>
The <code>show plan</code> command now provides an estimated migration completion time. For example:
<pre>
Plan Deploy Topo (12)
State:                 RUNNING
Attempt number:        1
Started:               2014-01-14 17:35:09 UTC
Ended:                 2014-01-14 17:35:27 UTC
Total tasks:           27
 Successful:           12
 Incomplete:           15
Incomplete tasks
   3 partition migrations queued
   1 partition migrations running
   11 partition migrations succeeded, avg migration time = 550164 ms.
<b>Estimated completion:  2014-01-14 19:57:37 UTC</b>
</pre>
[#22183]
</li>
<li>
A new read consistency option has been added for this release.
<code>oracle.kv.Consistency.NONE_REQUIRED_NO_MASTER</code> can now be
used to specify that the desired read operations must always be serviced
by a replica, never the master. For read-heavy applications (ex. analytics),
it may be desirable to isolate read requests so that they are performed
only on replicas, never a master; reducing the load on the master. The
preferred mechanism for achieving this sort of read isolation is the new
secondary zone feature; which users are encouraged to employ for this
purpose. But for cases where the use of secondary zones is not desired
or impractical, <code>oracle.kv.Consistency.NONE_REQUIRED_NO_MASTER</code>
can be used to achieve a similar effect, without the additional resources
that secondary zones may require. [#22338]
</li>
<li>
The following methods have been added:
<ul>
<li><code>KVStoreConfig.setReadZones()</code></li>
<li><code>KVStoreConfig.getReadZones()</code></li>
</ul>
<p>
These methods make it possible to require that read operations only be
performed on nodes located in the specified zones.
</li>
<li>
The <i>show plans</i> command has been changed so that a range of plan
history can be specified.  With no arguments, <i>show plans</i> now
displays only the ten most recently created plans, but new arguments
can be used to select ranges by creation time and by plan id.  Issue
the command "show plans -help" to see the complete set of options.
</li>
<li>
The makebootconfig utility has a new optional <code>-runadmin</code>
command-line argument, which allows the SNA to force the start of a bootstrap
admin even if the value of <code>-admin</code> is set to 0.
<p>
The option <code>-port</code> of <i>plan deploy-admin</i> within the admin CLI
has been changed to be able to control the start of the admin web service. No
web service of the admin will be started if the <code>-port</code> is set to
0 in deploying.
<p>
Users can also change the http port of an admin after deployment via
<i>plan change-param</i> command of admin CLI to change the setting for whether
an admin runs a web server. [#22344]
</li>
<li>
The <i>plan change-param</i> command has been changed to allow changing the
parameters for a single admin service. [#22244]
</li>
<li>
NoSQL topology information is stored both in the Admin services and on
Storage Nodes, and can become inconsistent if topology changing plans
such as deploy-topology and migrate-sn are canceled before
completion. Inconsistencies can be repaired by redeploying the target
topology. In this release, a "plan repair-topology" command is also provided
as an additional way of repairing topology inconsistencies. The verify
configuration command now generates recommendations for when it may be
beneficial to use repair-topology. [#22753]
</li>
</ol>
<h3><a name="BugFixes305">Bug and Performance Fixes</a></h3>
<ol>
<li>
The makebootconfig command now prints a message when it declines to
overwrite existing configuration files. [#23012]
</li>
<li>
The "plan remove-admin" now permits removal of an Admin that is hosted
by Storage Node that is not running. [#23061]
</li>
<li>
Fixed a bug that sometimes caused a duplication of the admin section
in a Storage Node's config.xml file. As a result, the "plan
change-parameters" command, when applied to an Admin service with this
configuration irregularity, could unexpectedly have no effect.  The
bug could be provoked by attempting to deploy an Admin that is already
deployed; but it could also happen when re-executing a failed
"plan migrate-storagenode" command. [#23152]
</li>
<li>
Fixed a problem that caused the <code>topology redistribute</code>
command to ignore storage directory settings when creating new
replication nodes. [#23161]
</li>
<li>
Previously, when there was no activity during a RepNode's
metrics-gathering period (the <i>statsInterval</i>), the previous
period's metric values would be reported via JMX and SNMP.  This
behavior has changed so that the metrics are updated at every
interval. [#22842][#22537]
</li>
<li>
NoSQL DB automatically adjusts mastership identity so that master
nodes are distributed across a store for optimal performance.
Fixed a problem that prevented Master Balancing from being performed
across multiple zones. [#22857]
</li>
<li>
Modified the LOB implementation to repeat calls to
<code>InputStream.skip</code> as needed to position the input stream to
the start location, so long as the calls return non-zero values.
An <code>IllegalArgumentException</code> will be thrown if the calls do
not advance the stream to the required start location.
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="Utilities305">Utility Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
The administrative and data command line interfaces (CLI) have been
merged into a single program.  The usage of the merged CLI is
compatible with most old usage but has additional options that allow
it to work for administrative operations, data operations, or both.
This change requires the use of kvstore.jar for data operations where
in previous releases, the data CLI only required kvcli.jar, which
depended on kvclient.jar.
</li>
<li>
The CLI has been enhanced with commands necessary to manage tables,
indexes, security information, and zones.
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="Documentation305">Documentation Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
  With the introduction of the tabular data model and secondary
  indexes, a new <a
  href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSTBJ-GUID-2C12DC44-6459-4190-93CB-5DC6C3A7C6DA">
  Getting Started with the Table API</a> guide has been added.
</li>
<li>
  With the introduction of the new security features, a new <a
  href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSSEC-GUID-6C5875FE-9765-45E6-9EC7-0D6EAEE3F95D">
  Security Guide</a> has been added.
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="Packaging305">Packaging Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
  The versions of the Avro and Jackson libraries bundled with Oracle
  NoSQL database have been upgraded to the more recent Avro 1.7.6 and
  Jackson 1.9.3.  These versions are compatible with the previous API
  versions.
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.57</u></h3>
<h3><a name="NewFeatures2157">New Features</a></h3>
<ol>
<li>
The new method <code>KVStore.appendLOB()</code> now permits appending to an
existing LOB (Large Object). As part of this change, the
method <code>PartialLOBException.isPartiallyDeleted()</code> has been deprecated
in favor of the new
method: <code>PartialLOBException.getPartialState()</code>. Please consult the
javadoc associated with these new methods, as well as the updated doc for the
interface <code>KVLargeObject</code>, for a detailed description of this new
functionality.
<p>
This release is backwards compatible with LOBs created in previous releases,
with one exception: Only LOBs created in this, or a later, release support the
append operation. Attempts to use the append operation on LOBs created in
previous releases will result in the method throwing an
UnsupportedOperationException.
<p>
LOBs created in this release cannot be read or deleted by clients using earlier
releases. Such operations will typically fail with a ConcurrentModificationException.
Please ensure that all clients are updated to this release before creating new
LOBs.
[#22876]
</li>
<li>
GC log files for the Admin and RepNode services are now generated by default and
placed in the <code>KVROOT/&lt;storename&gt;/log</code> directory (the standard
location for all NoSQL related logging information). This default behavior only
applies when using JDK release 1.7 or a later release, since gc log rotation is
only supported in the more recent JDKs. The logging has minimal resource
overheads. Having these log files readily available, conforms to deployment best
practices for production java applications making it simpler to diagnose GC
issues should the need arise. [#22858]
</li>
</ol>
<h3><a name="BugFixes2157">Bug and Performance Fixes</a></h3>
<ol>
<li>
The heap requirement of the Admin service, when operating on a store that has
undergone numerous changes, has been reduced. [#21143]
</li>
<li>
Fixed a bug in the Admin CLI "show plan -id &lt;id&gt;" command, which
resulted in the omission of information about partition migration
tasks from the plan history report. The command now correctly includes
information about partition migrations. [#22611]
</li>
<li>
Reduce internal timeout values, associated with the network connection
between a master and a replica, to permit faster master failover upon
encountering a network hardware failure. [#22861]
</li>
<li>
An attempt to resume a failed put operation on a LOB larger than 3968K bytes
could result in an incorrect ConcurrentModificationException in some
circumstances. The bug has been fixed in this release. [#22876]
</li>
<li>
Changed the way plans are represented in the Admin's memory.
Previously, there was no limit on the potential size of the in-memory
representation of currently active and historical plans.  With this
fix, only active plans are kept in memory. [#22963]
</li>
<li>
Eliminated deadlocks in plan management in the Admin. [#22992]
</li>
<li>
A bug in the argument checking for the
<code>StoreIteratorConfig</code> setter methods has been
fixed. [#23010]
</li>
<li>
The makebootconfig command now prints a message when it declines to
overwrite existing configuration files. [#23012]
</li>
<li>
The Replication Node configuration has been tuned to reduce CPU
utilization when the Replication Node's cache is smaller than
required, and cache eviction is taking place.  [#23026]
</li>
<li>
The remove-admin command now permits removal of an Admin that is
hosted by Storage Node that is not running. [#23061]
</li>
<li>
The show plans command could sometimes cause a crash in the Admin CLI
because it would consume too much memory. This has been fixed. [#23105].
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.54</u></h3>
<h3><a name="NewFeatures2154">New Features</a></h3>
<ol>
<li>
Oracle NoSQL Database now offers a client only package. Oracle NoSQL
Database Client Software Library is licensed pursuant to the Apache
2.0 License (Apache 2.0).  The Apache License and third party notices
for the NoSQL DB Client Software Library may be viewed at this
<a href="http://www.oracle.com/technetwork/products/nosqldb/documentation/nosql-db-agpl-license-1432845.txt"> location </a>
or in the downloaded software.
</li>
<li>
A new overloading of the <code>KVStore.storeIterator()</code>
and <code>KVStore.storeKeysIterator()</code> implements <i>Parallel
Scans</i>. The other <code>storeIterator()</code> methods scan all
shards and Replication Nodes in serial order. The new Parallel
Scan methods allow the programmer to specify a number of client-side
threads that are used to scan Replication Nodes in parallel. [#22146]
</li>
</ol>
<h3><a name="BugFixes2154">Bug and Performance Fixes</a></h3>
<ol>
<li>
Improved error messages in the Data Command Line Interface
(kvshell). For example, a put command with invalid inputs might have
returned this error message in the past:
<pre>
kvshell-> put -key /test -value ./emp.insert -file -json Employee
  Could not create JSON from input:
  Unable to serialize JsonNode
</pre>
but will now produce this more useful response:
<pre>
kvshell-> put -key /test -value ./emp.insert -file -json Employee
Exception handling command put -key /test -value ./emp.insert -file -json Employee:
  Could not create JSON from input:
  Expected Avro type STRING but got JSON value: null in field Address of Employee
</pre>
[#22791]
</li>
<li>
Fixed a bug when using the plan deploy-admin command. In some cases,
if an Admin service encountered an error at start up, the process would
become unresponsive. The correct behavior is for the process to shut
down and be restarted by its owning Storage Node. [#22908]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.25</u></h3>

<h3><a name="BugFixes2125">Bug Fixes</a></h3>
<ol>
<li>
If a Storage Node Agent process received a <i>master balancing</i> related
remote request while shutting down, it could in rare instances throw an
exception that would disable the master balancing function in the Storage Node
Agent that initiated the request. This problem can be identified via the
following (or similar) output in the log of the Storage Node Agent that
initiated the request:

<pre>

2014-03-28 12:13:34.544 UTC SEVERE [sn2] MasterRebalanceThread thread exiting due to exception.
null (12.1.2.1.24) java.lang.NullPointerException
    at oracle.kv.impl.sna.StorageNodeAgentImpl$27.execute(StorageNodeAgentImpl.java:838)
    at oracle.kv.impl.sna.StorageNodeAgentImpl$27.execute(StorageNodeAgentImpl.java:831)
    at oracle.kv.impl.fault.ProcessFaultHandler.execute(ProcessFaultHandler.java:119)
    at oracle.kv.impl.sna.StorageNodeAgentImpl.getMDInfo(StorageNodeAgentImpl.java:829)
    at sun.reflect.GeneratedMethodAccessor12.invoke(Unknown Source)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:606)
    ...
    at com.sun.proxy.$Proxy1.getMDInfo(Unknown Source)
    at oracle.kv.impl.sna.StorageNodeAgentAPI.getMDInfo(StorageNodeAgentAPI.java:492)
    at oracle.kv.impl.sna.masterBalance.RebalanceThread.orderMSCNs(RebalanceThread.java:580)
    at oracle.kv.impl.sna.masterBalance.RebalanceThread.candidateTransfers(RebalanceThread.java:485)
    at oracle.kv.impl.sna.masterBalance.RebalanceThread.run(RebalanceThread.java:301)
2014-03-28 12:13:34.546 UTC INFO [sn2] Master balance manager shutdown
2014-03-28 12:13:34.546 UTC INFO [sn2] MasterRebalanceThread thread exited.

</pre>
[#23419]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.24</u></h3>

<h3><a name="BugFixes2124">Bug and Performance Fixes</a></h3>
<ol>
<li>
Under certain circumstances, a replication node which was on the verge
of shutting down or in the midst of transitioning from master to
replica state could experience this failure while cleaning up
outstanding requests. Since the node would automatically restart,
and the operation would be retried, the failure was transparent to the
application, but could cause an unnecessary node failover. This has
been fixed.
<pre>
java.lang.IllegalStateException: Transaction 30 detected open cursors while aborting
    at com.sleepycat.je.txn.Txn.abortInternal(Txn.java:1190)
    at com.sleepycat.je.txn.Txn.abort(Txn.java:1100)
    at com.sleepycat.je.txn.Txn.abort(Txn.java:1073)
    at com.sleepycat.je.Transaction.abort(Transaction.java:207)
    at oracle.kv.impl.util.TxnUtil.abort(TxnUtil.java:80)
    at oracle.kv.impl.api.RequestHandlerImpl.executeInternal(RequestHandlerImpl.java:469)
    at oracle.kv.impl.api.RequestHandlerImpl.access$300(RequestHandlerImpl.java:122)
    at oracle.kv.impl.api.RequestHandlerImpl$2.execute(RequestHandlerImpl.java:301)
    at oracle.kv.impl.api.RequestHandlerImpl$2.execute(RequestHandlerImpl.java:290)
    at
oracle.kv.impl.fault.ProcessFaultHandler.execute(ProcessFaultHandler.java:135>
</pre>
[#22152]
</li>
<li>
In past releases of NoSQL DB, a replication node which transitioned
from master to replica state would have to close and reopen its
database environment as part of the change in status. This transition
has now been streamlined so that in the majority of cases, the
database environment is not perturbed, the transition requires fewer
resources, and the node is more available.
[#22627]
</li>
<li>
The <code>plan deploy-topology</code> command has additional
safeguards to increase the reliability of the topology rebalance and
redistribute plans. When moving a replication node from one Storage
Node to another, the command will now check that the Storage Nodes
involved in the operation are up and running before any action is
taken. [#22850]
</li>
<li>
Under certain circumstances it was possible for a replication node to
use out of date master identity information when joining a
shard. This could cause a delay if the targeted node was
unavailable. This has been fixed. [#22851]
</li>
<li>
Under certain circumstances operations would end prematurely
with oracle.kv.impl.fault.TTLFaultException. This exception is now
handled internally by the server and client library and the operation
is retried. If the fault condition continues the operation will
eventually fail with a oracle.kv.RequestTimeoutException. [#22860]
</li>
<li>
Previously, there were cases where a replication node would require
the transfer of a copy of the shard data in order to come up and join
the shard, even though it was unnecessary. This has been
fixed. [#22782]
</li>
<li>
When new storage nodes are added to an Oracle NoSQL DB deployment and
a new topology is deployed, the store takes that opportunity to
redistribute master roles for optimal performance. In some cases, the
store might not notice the new storage nodes until other events, such
as failovers or mastership changes had occurred, which caused a delay
in master balancing. This has been fixed. [#22888]
</li>
<li>
The setting of the JE configuration parameter:
je.evictor.criticalPercentage used by the store has been corrected. It
used to be set to 105 and has been changed to 20. This new setting
will provide better cache management behavior in cases where the data
set size exceeds the optimal memory settings. [#22899]
</li>
</ol>
<h3><a name="UtilityAndDocChanges2124">Utility and Documentation Changes</a></h3>
<ol>
<li>
A timestamp has been added to the output of the CLI "ping" command. [#22859]
</li>
</ol>

<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.19</u></h3>

<h3><a name="documentation2119">Documentation Changes</a></h3>
<ol>
<li>
This release includes a new document, Oracle NoSQL Database
Availability and Failover. It explains the general concepts and
issues surrounding data availability when using Oracle NoSQL Database.
The intended audiences for this document are system architects and
developers. The new information can be found under the "For the
Developer" section in the documentation index page.
</li>
<li>
Clarify the instructions for adding .avsc files to the classpath for
the example on Avro bindings in &lt;KVHOME&gt;/examples/avro.
Improve the error message when the .avsc files are not properly available.
</li>
</ol>

<h3><a name="BugFixes2119">Bug and Performance Fixes</a></h3>
<ol>
<li>
Increased an internal parameter for lock timeouts from 500ms to 10
seconds. Since NoSQL DB ensures that data access is deadlock free, the
small timeout values were unnecessary and could cause spurious errors
in the face of transient network failures. [#22583]
</li>
<li>
Changing the store topology through the <code>plan
deploy-topology</code> command could result in the following
error if there was a transient network failure, or if the movement of
the replication node took longer than a few seconds. Although the store
state was still consistent, and the command could be manually retried,
the command should be more resilient to communication glitches.
<pre>
... [admin1] Task 2/RelocateRN ended in state ERROR with
java.lang.RuntimeException: Time out while waiting for rg4-rn1 to come
up on sn1 and become consistent with the master of the shard before
deleting the RepNode from its old home on sn4 2/RelocateRN failed.

java.lang.RuntimeException: Time out while waiting for rg4-rn1 to come
up on sn1 and become consistent with the master of the shard before
deleting the RepNode from its old home
</pre>
<p>
The command will now adjust waiting times and retry appropriately to
ascertain whether the movement of a
replication node has finished.[#22596]
</li>
<li>
Fixed a bug where a replication node would not restart automatically if
the directory containing its data files was removed, or its data files
were corrupted, but were later repaired. [#22626]
</li>
<li>
Added additional testing to reinforce the existing, correct behavior
that a client directs write requests to the authoritative master in a
segmented network split brain scenario. [#22636]
</li>
<li>
In some cases, the <code>java -jar kvstore.jar ping</code> command
could generate spurious messages about components that are no longer
legitimately within the store.
<pre>
Failed to connect to service commandService

Connection refused to host: 10.32.17.12; nested exception is:
  java.net.ConnectException: Connection refused
        SNA at hostname:localhost registry port: 6000 has no available
        Admins or RNs registered.
</pre>
In particular, these messages could happen for bootstrap Admins on
Storage Nodes that do not host deployed Admin Services. While the
store was consistent, the error messages were confusing and have been
removed. [#22639]
</li>

<li>
Fixed a small timing window in Replication Node master transfer that
could incorrectly cause the transfer transaction catch up point to
regress, when a master transfer is occurring under heavy application
load. The result is that shard mastership can take too long a time or
too short a time to transfer. If the transfer time is too short, the
target master may not be optimally caught up, and a third member of
the shard may detect this and throw an exception.
[#22658]
</li>
<li>
Preemptively shut down and restart the replication node when a node
transitions from master to replica, to reduce GC cost from refreshing
the database environment.
[#22658]
</li>
<li>
Made changes to the NoSQL client library to adapt to replication node
failures more rapidly, by retrying or forwarding data requests when it
detects that its original target is unavailable sooner.
[#22661]
</li>
<li>
A NoSQL deployment could see this transient error when
undergoing topology changes. Although the store remained consistent, the
error messages were confusing and could incorrectly cause a <code>plan
deploy-topology</code> command to fail. This has been corrected.
<pre>
 ... INFO [rg1-rn1] Failed pushing entire topology push to rg1-rn3
updating from topo seq#: 0 to 1001 Problem:Update to topology seq#
1001 failed ... oracle.kv.impl.fault.OperationFaultException:
  Update to topology seq# 1001 failed
    at oracle.kv.impl.rep.admin.RepNodeAdminImpl$6.execute(RepNodeAdminImpl.java:261)
    at oracle.kv.impl.fault.ProcessFaultHandler.execute(ProcessFaultHandler.java:169)
    at oracle.kv.impl.rep.admin.RepNodeAdminFaultHandler.execute(RepNodeAdminFaultHandler.java:117)

 ...INFO [rg1-rn3] Topology update skipped. Current seq #: 1001 Update seq #: 1001
</pre>
[#22678]
</li>
<li>
Fixed a bug where a replication node which experiences an out of
memory error did not restart automatically.
[#22679]
</li>
<li>
Corrected the default calculation of available Storage Node memory when
the Storage Node has been configured without a value for the bootstrap
memory_mb parameter. In the past, the calculation was done using units
of decimal megabytes, rather than MB, resulting in an overestimation
of the appropriate replication node heap size. This default
calculation is only used if the store has been configured without any
bootstrap value for the memory_mb property, and the memory_mb storage node
parameter has never been set.
[#22687]
</li>
<li>
Update the Storage Node more quickly about the replica/master status
of the replication nodes it hosts. The fix applies when executing the
<code>plan deploy-topology</code> command on a store that contains Storage Nodes
that have capacity values greater than 1, and can host multiple
Replication Nodes. A delay in notifying the Storage Node of its
replication nodes status can make the distribution of mastership
responsibilities less optimal.
[#22689]
</li>
<li>
Fixed a bug where the Admin service became unresponsive when executing
a <code>plan deploy-topology</code> command. During this time, the
admin service process appeared idle, only burning a second or two of
CPU time once in a while and would not respond to new attempts to
connect with the Admin CLI. The problem would likely only occur in
large clusters with hundreds of components.  [#22694]
</li>
<li>
Topology changes invoked by the <code>plan deploy-topology</code>
which result in the movement of a replication node from one storage
node to another are now more resilient to transient network failures.
There are now more advance checks to ensure that the shard and storage
nodes involved in the movement are available and ready to accept the
change. In the advent of a network failure mid-move, the command is
better at handling retries issued by the system administrator.
[#22722]
</li>
<li>
Fixed a bug where application requests failed to be processed while the
store is executing topology changes that require partition migration
under heavy load.
[#22778]
</li>
<li>
Adjust the default replication node garbage collection parameters to
be more optimal, reducing CPU utilization in some cases.
[#22779]
</li>
<li>
Reduce the time taken for a replica Replication Node to become up to
date and available to handle application requests when it has fallen
significantly behind due to downtime or to network communication
failures. Previously, it exited and restarted the process before
starting the catch up stage, but will now skip the restart.
[#22783]
</li>
<li>
Fixed a bug where an internal queue in the Storage Node could fill up
if its Replication Node repeatedly and unsuccessfully attempts to
restart, as might happen when a resource is unavailable. In that case,
the Storage Node was no longer able to automatically restart
the replication node, and would have to be rebooted.
[#22786]
</li>
<li>
Fixed a bug where a Replication Node that has been stopped due to
repeated errors, perhaps due to a lack of resource, and then
re-enabled with the "plan start-service" command, still did not
restart. [#22828]
</li>
<li>
Fixed a bug where the following null pointer exception could happen
for a restarting Replication Node. The problem was transient.
<pre>
   INFO [sn1] rg2-rn2: ProcessMonitor: startProcess
   INFO [sn1] rg2-rn2: ProcessMonitor: stopProcess
   SEVERE [sn1] rg2-rn2: ProcessMonitor: Unexpected exception in
MonitorThread:
        java.lang.NullPointerExceptionjava.lang.NullPointerException
        at oracle.kv.impl.sna.ProcessMonitor$MonitorThread.run(ProcessMonitor.java:404)
</pre>
[#22830]
</li>
<li>
Improve the client library's interpretation of UnknownHostException
and ConnectIOException so that it more rapidly detects a network
problem and updates its set of unavailable replication nodes.
[#22841]
</li>

<!--
Fixed a bug in the unadvertised command "topology move-repnode". In
the past, the move-repnode command did not use available storage
directories on the target SN. This has been fixed, so a RN that is
moved will use any available storage dirs on the target SN. The fix
is not documented because this in an undocumented command. [#22648]
-->
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.8</u></h3>
<h3><a name="Features218">New Features</a></h3>
<ol>
<li>
This release includes support for upgrading the NoSQL DB software (client or
server) without taking the store offline or without significant impact to
ongoing operations. In addition, upgrades can be made incrementally, that is,
it should not be necessary to update the software on every component at the
same time. This support includes client and server code changes and new
command line interface (CLI) commands. [#22421]
<p>
The new CLI commands provide the
administrator tools to help with the upgrade process. Using these commands, the
general upgrade procedure is:
<ol>
    <li>Install the new software on a Storage Node running an admin
        service<sup>1</sup>.
    <li>Install the new client and connect to the store.
    <li>Use the <code>verify prerequisite</code> command to verify that the
        entire store is at the proper software version to be upgraded (All
        2.0 versions of NoSQL DB will qualify as prerequisites).
    <li>Use <code>show upgrade-order</code> to get an ordered list of nodes to
        upgrade.
    <li>Install the new software on the Storage Nodes (individually or in groups
        based on the ordered list).
    <li>Use the <code>verify upgrade</code> to monitor progress and verify that
        the upgrade was successful.
</ol><br>
<sup>1</sup> In future releases this step will not be necessary
<p>
If the upgrade procedure is interrupted steps 4-6 can be repeated as necessary
to complete the upgrade.
</li>
</ol>

<h3><a name="BugFixes218">Bug and Performance Fixes:</a></h3>
<ol>
<li>
Unless configured specifically by the application, NoSQL DB specifies the
-XX:ParallelGCThread jvm flag for each Replication Node process to
indicate the number of garbage collector threads that the process
should use. In the past, the algorithm in use generated a minimum
value of 1 thread. After more testing, the minimum value has been
raised to the min(4, &lt;the number of cores on the node&gt;). [#22475]
</li>
</ol>

<h3><a name="APIChanges218">API Changes</a></h3>
<ol>
<li>

The admin command line interface (CLI) provides the following new
commands [#22422]:
<p>
<code>verify prerequisite [-silent] [-sn snX]*</code>
<p>
This command will verify that a set of storage nodes in the store meets the
required prerequisites for upgrading to the current version and display the
components which do not meet prerequisites or cannot be contacted. It will also
check and report an illegal downgrade situation where the installed software is
of a newer minor release than the current version. In this command the current
version is the version of the software running the command line interface. If no
storage nodes are specified, all of the nodes in the store will be checked.
<p>
<code>verify upgrade [-silent] [-sn snX]*</code>
<p>
This command will verify that a set of storage nodes in the store has been
successfully upgraded to the current version and display the components which
have not yet been upgraded or cannot be contacted. In this command the current
version is the version of the software running the command line interface. If no
storage nodes are specified, all of the nodes in the store will be checked.
<p>
<code>show upgrade-order</code>
<p>
This command will display the list of storage nodes in the order that they
should be upgraded to maintain the store's availability. This command will
display one or more storage nodes on a line. Multiple storage nodes on a line
are separated by a space. If multiple storage nodes appear on a single line,
then those nodes can be safely upgraded at the same time. When multiple nodes
are upgraded at the same time, the upgrade must be completed on all nodes
before the nodes next on the list can be upgraded.
<p>
The <code>verify [-silent]</code> command has been deprecated and is replaced by
<code>verify configuration [-silent]</code>. The <code>verify [-silent]</code>
command will continue to work in this release.
</li>
</ol>

<h3><a name="UtilityAndDocChanges218">Utility and Documentation Changes</a></h3>
<ol>
<li>In this release, the sample code provided by the utility
  class <code>WriteOperations</code>
  (located in the <code>examples</code> directory) now includes methods that
  perform write operations for <em>large objects</em> (or <em>LOB</em>,
  see <a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/java-api/oracle/kv/lob/KVLargeObject.html"> <code>KVLargeObject</code></a>). The
  new utility methods added in this release will properly retry the associated
  LOB operation when
  a  <a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/java-api/oracle/kv/FaultException.html"> <code>FaultException</code></a>
  is encountered. Prior to this release,
  the <code>WriteOperations</code>
  utility only provided retry methods for objects that are not large
  objects. [#21966]
</li>
<li>
The number of JE lock tables used by Replication Nodes (controlled via
the <i>je.lock.nLockTables</i> JE configuration parameter) has been increased from
1 to 97. This change helps improve performance of applications characterized by
very high levels of concurrent updates, by reducing lock contention. [#22373]
</li>
<li>
The Administration CLI now permits the creation of multiple Datacenters.
By choosing Datacenter replication factors so that each Datacenter holds
less than a quorum of replicas, this change makes it possible to create
store layouts where the failure of a single Datacenter does not result
in the loss of write availability for any shards in the store.  In the
current release, nodes in any Datacenter can participate in master
elections and contribute to durability acknowledgments.  As a
consequence, master failover and durability acknowledgments will take
longer if they involve datacenters that are separated by large
distances.  Future releases will provide greater flexibility in this
area.  [#20905]
</li>
</ol>

<!-- ========================================================= -->
<hr>
<h3 align="center"><u>Changes in 11gR2.2.0.39</u></h3>
<h3><a name="Features2039">New Features</a></h3>
<ol>
<li>
An integration with Oracle Coherence has been provided that allows
Oracle NoSQL Database to be used as a cache for Oracle Coherence
applications, also allowing applications to directly access cached
data from Oracle NoSQL Database.  This integration is a feature of the
Enterprise Edition of the product and implemented as a new, independent jar
file.  It requires installation of the Oracle Coherence product as
well.  The feature is described in the
<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSCON-GUID-FAB8E233-E99A-48DA-BE44-C1728D2FC601">Coherence Integration</a> as well as the <a
href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/java-api/oracle/kv/coherence/package-summary.html">javadoc</a>. [#22291].
</li>
<li>
The Enterprise Edition now has support for semantic technologies.
Specifically, the Resource Description Framework (RDF), SPARQL query
language, and a subset of the Web Ontology Language (OWL) are now
supported.  These capabilities are referred to as the RDF Graph
feature of Oracle NoSQL Database.  The RDF Graph feature provides a
Java-based interface to store and query semantic data in Oracle NoSQL
Database Enterprise Edition. The feature is described in the
<a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/RDFGraph/index.html">RDF Graph</a> manual.
</li>
</ol>
<h3><a name="BugsPatch2039">Bug Fixes</a></h3>
<ol>
<li>
The preferred approach for setting NoSQL DB memory resources is to
specify the memory_mb parameter for each SN when running the
makebootconfig utility, and to let the system calculate the ideal
Replication Node heap and cache sizes. However, it is possible to override the
standard memory configurations by explicitly setting heap and cache
sizes using the Replication Node javaMiscParams and cacheSize
parameters. In past releases, setting the explicit values worked
correctly when using the plan change-parameters command, but did not
work correctly when using the change-policy command. This has been
fixed, so that if desired, one can use the change-policy command for
the javaMiscParams and cacheSize parameters to override the default
memory allocation heuristics. [#22097]
</li>
<li>
A NoSQL DB deployment that executes on a node with no network
available, as might happen when running a NoSQL DB demo or tutorial,
would fail with this error:
<pre>
java.net.InetAddress.getLocalHost() returned loopback address:&lt;hostname&gt; and
  no suitable address associated with network interfaces.
</pre>
This has been fixed. [#22252]
</li>
</ol>
<h3><a name="APIPatch2039">API Changes</a></h3>
<ol>
<li>
Prior to this release, if a write operation encountered an exception from the
underlying persistent store indicating that the write completed on the shard's
master but not necessarily on the desired combination of replicas within the
specified time interval, then that exception would be swallowed and thus never
propagated to the client. Originally, this behavior was considered desirable
because not only is that exception rare (because of various preceding checks
performed by the implementation), but swallowing the exception would keep the
API simple by avoiding the introduction of an additional exception and/or
additional communication at the API level. After further thought and
discussion, the team concluded that clients should know when a write operation
fails to complete because of such an exception. As a result, when such a
condition occurs during a write operation, a <a
href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/java-api/oracle/kv/RequestTimeoutException.html">
<code>RequestTimeoutException</code></a> will now be propagated to the client;
wrapping the original exception from the underlying persistent store as the
cause. For additional information, including strategies one might employ when
this exception is encountered, refer to the <a
href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/java-api/oracle/kv/RequestTimeoutException.html">
<code>RequestTimeoutException</code> <em>javadoc</em></a>.
<p>
This has been fixed. [#21210]
</li>
<li>
A new parameter has been added which controls the display of records
in exception and error messages. When <code>hideUserData</code> is set
to true, as it is by default, error messages which are printed to the
server side logs or are displayed via the show CLI commands replace
any key/values with the string "[hidden]". To see the actual record content
in errors, set the parameter to false. [#22376]
</li>
</ol>
<h3><a name="UtilityPatch2039">Utility and Documentation Changes</a></h3>
<ol>
<li>
In previous releases, information about errors that occurred during
NoSQL DB component start up as a result of a <code>plan
deploy-topology</code> command would often be visible only within
the NoSQL DB logs, which made
installation troubleshooting difficult. In this
release, such start up errors can now be seen via the Admin CLI
<code>show plan -id &lt;id&gt;</code> command. [#22101]
</li>
<li>
The Storage Node Agent exposes MBeans on a non-default MBeanServer
instance.  In this release, the non-default MBeanServer now exposes
the standard JVM platform MBeans as well as those relating only to
Oracle NoSQL Database.
</li>
<li>
In both SNMP and JMX interfaces, the new totalRequests metric is now available.  This metric counts the number of multi-operation sequences that occurred during the sampling period.
</li>
<li>
Prior to this release, the product was compiled and built against the 1.x version of Hadoop (CDH3). Thus, when employing a previous release, if one were to run the <code>examples.hadoop.CountMinorKeys</code> example against a cluster based on the 2.x version of Hadoop (CDH4), the MapReduce job initiated by that example would fail as a result of an <code>IncompatibleClassChangeError</code>; which is caused by an incompatibility introduced in <code>org.apache.hadoop.mapreduce.JobContext</code> between Hadoop 1.x and Hadoop 2.x. This failure occurs whether the example is compiled and built against Hadoop 1.x or Hadoop 2.x. Because the product's customer base almost exclusively uses Hadoop 2.x, this release will provide support for Hadoop 2.x instead of 1.x. Future releases may revisit support for both Hadoop version paths, but doing so will involve refactoring the codebase and its associated release artifacts, as well as substantial changes to the product's current build process.
<p>
Support of Hadoop 2.x (CDH4) has been provided. [#22157]
</li>
<li>
The java -jar kvstore.jar makebootconfig -mount flag has been changed
to -storagedir. The "plan change-mountpoints -path &lt;storage
directory&gt;" command is deprecated in favor of "plan
change-storagedir -storagedir &lt;storage directory&gt;". [#21880]
</li>
<li>
The concept of Storage Node capacity is better explained in the
Administrator's Guide.
</li>
<li>
The Administrator's Guide has a revamped section on how to calculate the
resources needed for operating a NoSQL DB deployment.
</li>
</ol>
<!-- ========================================================= -->
<hr>
<h3 align="center"><u>Changes in 11gR2.2.0.26</u></h3>
<h3><a name="Features2026">New Features:</a></h3>
<ol>

<li>
This release adds the capability to remove an Admin service replica.
If you have deployed more than one Admin, you can remove one of them
using the following command:
<blockquote>
<pre>
plan remove-admin -admin &lt;adminId&gt;
</pre>
</blockquote>
<p>
You cannot remove the sole Admin if only one Admin instance is
configured.
</p><p>
For availability and durability reasons, it is highly recommended that
you maintain at least three Admin instances at all times.  For that
reason, if you try to remove an Admin when the removal would result in
there being fewer than three, the command will fail unless you give
the <i>-force</i> flag.
</p><p>
If you try to remove the Admin that is currently the master,
mastership will transfer to another Admin.  The plan will be
interrupted, and subsequently can be re-executed on the new master
Admin.  To re-execute the interrupted plan, you would use this command:
</p>
<blockquote>
<pre>
plan execute -id &lt;planId&gt;
</pre>
</blockquote>
</li>

<li>
The Admin CLI verify has an added check to verify that the Replication
Nodes hosted on a single Storage Node have memory settings that fit
within the Storage Node's memory budget. This guards against mistakes
that may occur if the system administrator overrides defaults and
manually sets Replication Node heap sizes.[#21727]
</li>

<li>
The Admin CLI verify command now labels any verification issues as
violations or notes. Violations are of greater importance, and the
system administrator should determine how to adjust the system to
address the problem. Notes are warnings, and are of lesser
importance. [#21950]
</li>

</ol>

<h3><a name="BugFixes2026">Bug fixes:</a></h3>
<!-- ========================================================= -->
<ol>

<li>
Several corrections were made to latency statistics. These corrections apply
to the service-side statistics in the Admin console, CLI <code>show perf</code>
command, .perf files and .csv files, as well as the client-side statistics
returned by KVStore.getStats. However, corrections to the 95% and 99% values do
not apply to the client-side statistics, since these values do not appear in
the client-side API.
  <ul>
      <li>The definition of latency has been corrected for the "multi"
      operation requests (multiGet, multiDelete, execute, etc).  These are
      labeled "multi" in the <code>Op Type</code> column where latency
      information is displayed.  The previous definition was "latency in
      milliseconds per <em>operation</em>" while the new definition is "latency
      in milliseconds per <em>request</em>".  In other words, for a "multi"
      operation request, latency now applies to the entire request rather than
      to each operation.  For "single" operation requests, the definition of
      latency has not changed.
      </li>
      <li>To go along with the change above, a new column containing the number
      of requests in the sample has been added to all latency information
      displays: <code>TotalReq</code>.  This is also available for client-side
      statistics using the new <code>OperationMetrics.getTotalRequests</code>
      method.  For "multi" operation requests, the total number of requests is
      normally smaller than the total number of operations (the
      <code>TotalOps</code> column).  For "single" operation requests, the
      total number of requests and operations are equal.
      </li>
      <li>Improved the consistency of the values reported in each sample so
      that, for example, the minimum latency is always less than the maximum
      latency.  However, note that statistics are collected without
      synchronization to avoid impacting performance, and for small sample
      sizes the values in a sample are not always accurate or self-consistent.
      </li>
      <li>Fixed a bug that caused the 95% and 99% values to show the maximum
      latency recorded (within 1000 ms), rather than the lowest 95% or 99% as
      intended.  This bug only applied to the "multi" operation requests.
      </li>
      <li>Fixed a bug that caused the 95% and 99% values to sometimes
      mistakenly appear as -1.  These values should only appear as -1 when
      there were no operations in the sample with a latency below 1000 ms.
      </li>
  </ul>
[#21763]
</li>

<li>
Modified the Administration Process to allocate ports from within a port range
if one is specified by the <i>-servicerange</i> argument to
the <i>makebootconfig</i> utility. If the argument is not specified the
Administration Process will use any available port. Please see
the <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSADM-GUID-4E2F4C8C-6B74-4C05-9CBC-41FEAC4BA4D6">
Admin Guide</a>
for details regarding the configuration of ports used by Oracle NoSQL
Database.  [#21962]
</li>

<li>
Modified the replication node to handle the unlikely case that the locally
stored topology is missing. A missing topology results in a
java.lang.NullPointerException being thrown in the TopologyManager and will
prevent the replication node from starting. [#22015]
</li>

<li>
Replication Node memory calculations are more robust for Storage Nodes
that host multiple Replication Nodes. In previous releases, using the
plan change-params command to reduce the capacity parameter for a
Storage Node which hosts multiple Replication Nodes could result in an
over aggressive increase in RN heap, which would make the Replication
Nodes fail at start up. The problem would be fixed when a topology was
rebalanced, but until that time, the Replication Nodes were
unavailable. The default memory sizing calculation now factors in the
number of RNs resident on a Storage Node, and adjusts RN heap sizes as
Replication Nodes are relocated by the deploy-topology
command. [#21942]
</li>

<li>
Fixed a bug that could cause a NullPointerException, such as the one below,
during RN start-up.  The exception would appear in the RN log and the RN would
fail to start.  The conditions under which this problem occurred include
partition migration between shards along with multiple abnormal RN shutdowns.
If this bug is encountered, it can be corrected by upgrading to the current
release, and no data loss will occur.
<pre>
Exception in thread "main" com.sleepycat.je.EnvironmentFailureException: (JE
5.0.XX) ...  last LSN=.../... LOG_INTEGRITY: Log information is incorrect,
problem is likely persistent. Environment is invalid and must be closed.
    at com.sleepycat.je.recovery.RecoveryManager.traceAndThrowException(RecoveryManager.java:2793)
    at com.sleepycat.je.recovery.RecoveryManager.undoLNs(RecoveryManager.java:1097)
    at com.sleepycat.je.recovery.RecoveryManager.buildTree(RecoveryManager.java:587)
    at com.sleepycat.je.recovery.RecoveryManager.recover(RecoveryManager.java:198)
    at com.sleepycat.je.dbi.EnvironmentImpl.finishInit(EnvironmentImpl.java:610)
    at com.sleepycat.je.dbi.DbEnvPool.getEnvironment(DbEnvPool.java:208)
    at com.sleepycat.je.Environment.makeEnvironmentImpl(Environment.java:246)
    at com.sleepycat.je.Environment.&lt;init&gt;(Environment.java:227)
    at com.sleepycat.je.Environment.&lt;init&gt;(Environment.java:170)
    ...
Caused by: java.lang.NullPointerException
    at com.sleepycat.je.log.entry.LNLogEntry.postFetchInit(LNLogEntry.java:406)
    at com.sleepycat.je.txn.TxnChain.&lt;init&gt;(TxnChain.java:133)
    at com.sleepycat.je.txn.TxnChain.&lt;init&gt;(TxnChain.java:84)
    at com.sleepycat.je.recovery.RollbackTracker$RollbackPeriod.getChain(RollbackTracker.java:1004)
    at com.sleepycat.je.recovery.RollbackTracker$Scanner.rollback(RollbackTracker.java:477)
    at com.sleepycat.je.recovery.RecoveryManager.undoLNs(RecoveryManager.java:1026)
    ... 10 more
</pre>
[#22052]
</li>

<li>
Fixed a bug that causes excess memory to be used in the storage engine cache on
an RN, which could result in poor performance as a result of cache eviction and
additional I/O.  The problem occurred only when the
<code>KVStore.storeIterator</code> or <code>KVStore.storeKeysIterator</code>
method was used.  [#21973]
</li>

</ol>

<!-- ========================================================= -->
<h3><a name="General2026">Performance and other General Changes:</a></h3>
<!-- ========================================================= -->
<ol>

<li>
The replicas in a shard now dynamically configure the JE property
<i>RepParams.REPLAY_MAX_OPEN_DB_HANDLES</i> which controls the size of the cache
used to hold database handles during replication. The cache size is determined
dynamically based upon the number of partitions currently hosted by the
shard. This improved cache sizing can result in better write performance for
shards hosting large numbers of partitions. [#21967]
</li>

<li>
The names of the client and server JAR files no longer include release
version numbers.  The files are now called:
<blockquote>
<pre>
lib/kvstore.jar
lib/kvclient.jar
</pre>
</blockquote>
<p>
This change should reduce the amount of work needed to switch to a new
release because the names of JAR files will no longer change between
releases.  Note that the name of the installation directory continues to
include the release version number. [#22034]
</li>

<li>
A SEVERE level message is now logged and an admin alert is fired when the
storage engine's average log cleaner (disk reclamation) backlog increases over
time.  An example of the message text is below.
<pre>
121215 13:48:57:480 SEVERE [...] Average cleaner backlog has grown from 0.0 to
6.4. If the cleaner continues to be unable to make progress, the JE cache size
and/or number of cleaner threads are probably too small. If this is not
corrected, eventually all available disk space will be used.
</pre>
For more information on setting the cache size appropriately to avoid such
problems, see "Determining the Per-Node Cache Size" in the Administrator's
Guide.
[#21111]
</li>

<li>
The storage engine's log cleaner will now delete files in the latter portion of
the log, even when the application is not performing any write operations.
Previously, files were prohibited from being deleted in the portion of the log
after the last application write.  When a log cleaner backlog was present (for
example, when the cache had been configured too small, relative to the data set
size and write rate), this could cause the cleaner to operate continuously
without being able to delete files or make forward progress.  [#21069]
</li>

<li>
NoSQL DB 2.0.23 introduced a performance regression over R1.2.23. The
kvstore client library and Replication Node consumed a greater
percentage of system CPU time. This regression has been fixed. [#22096]
</li>
</ol>

<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 11gR2.2.0.23</u></h3>

<!-- ========================================================= -->
<h3><a name="Features2023">New Features:</a></h3>
<ol>
<li>
This release provides the ability to add storage nodes to the system
after it has been deployed. The system will rebalance and redistribute
the data onto the new nodes without stopping operations. See Chapter
6, of the Admin
Guide, <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSADM-GUID-6AEF70CE-DAF3-40F2-A8CD-463B6ACB43E1">
Determining Your Store's Configuration</a>, for more details.
<li>
A new <code>oracle.kv.lob</code> package provides operations that can
be used to read and write Large Objects (LOBs) such as audio and video
files. As a general rule, any object larger than 1 MB is a good
candidate for representation as a LOB. The LOB API permits access to
large values without having to materialize the value in its entirety
by providing streaming APIs for reading and writing these objects.
<li>
A C API has been added. The implementation uses Java JNI and requires
a Java virtual machine to run on the client. It is available as a
separate download.
<li>
Added a new remove-storagenode plan. This command will
remove a storage node which is not hosting any NoSQL Database components
from the system's topology. Two examples of when this might be useful
are:
<blockquote>
A storage node was incorrectly configured, and cannot be deployed.<br>
A storage node was once part of a NoSQL Database, but all components have
been migrated from it using the migrate-storagenode command, and the
storage node should be decommissioned.
</blockquote>
[#20530]
</li>
<li>
Added the ability to specify additional physical configuration
information about storage nodes including:
<ul>
  <li>Capacity - the number of RepNodes the SN may host</li>
  <li>Number of CPUs</li>
  <li>Amount of memory to use</li>
  <li>Specific directory paths (mount points) to use for RepNodes</li>
</ul>
This information is used by the system to make more intelligent
choices about resource allocation and consumption.  The administration
documentation discusses how these parameters are set and used.
[#20951]
</li>
<li>Added Avro support.  The value of a kv pair can now be stored in Avro
binary format.  An Avro schema is defined for each type of data stored.  The
Avro schema is used to efficiently and compactly serialize the data, to
guarantee that the data conforms to the schema, and to perform automatic
evolution of the data as the schema changes over time.  Bindings are supplied
that allow representing Avro data as a POJO (Plain Old Java Object), a JSON
object, or a generic Map-like data structure. For more information, see
<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSKVJ-GUID-5453684B-4BBD-49C2-B5A1-328FE0E7A669">
Avro Schemas</a> and
<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSKVJ-GUID-FE6EAD0D-3C4A-4B79-BA30-A2B4F202E24F">
Avro Bindings</a>
in the <i>Getting Started Guide</i>. The <code>oracle.kv.avro</code> package is
described in the Javadoc.  The use of the Avro format is strongly
recommended.  NoSQL DB will leverage Avro in the future to provide additional
features and capabilities.  [#21213]
</li>
<li>Added Avro support for the Hadoop <code>KVInputFormat</code> classes.
A new <code>oracle.kv.hadoop.KVAvroInputFormat</code> class returns Avro
<code>IndexedRecord</code>s to the caller. When this class is  used in
conjunction with Oracle Loader for Hadoop, it is possible to read data
directly from NoSQL Database using OLH without using an interim Map-Reduce
job to store data in HDFS. [#21157]
</li>
<li>Added a feature which allows Oracle Database External Tables to be
used to access Oracle NoSQL Database records. There is more
information in javadoc for the
<a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/java-api/index.html?oracle/kv/exttab/package-summary.html">
<code>oracle.kv.exttab</code></a> package and an "cookbook" example in the
<a href="https://docs.oracle.com/en/database/other-databases/nosql-database/18.1/examples/index.html?externaltables/package-summary.html">
<code>examples/externaltables</code></a> directory. [#20981]
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="General2023">Performance and other General Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
The following new methods:
<ul>
<li><code>KVStoreConfig.setOpenTimeout()</code></li>
<li><code>KVStoreConfig.getOpenTimeout()</code></li>
<li><code>KVStoreConfig.setReadTimeout()</code></li>
<li><code>KVStoreConfig.getReadTimeout()</code></li>
</ul>
have been added to allow clients to configure the socket timeouts used to make
client requests. Please review the javadoc for details.
<p>
R1 installations must ensure that the software on the storage nodes has
been upgraded as described in the upgrade documentation
accompanying this release before using the above APIs on the client.
[#20997]
</li>

<li>
New service parameters have been added to control the backlog
associated with sockets created by NoSQL Database. These are
controllable for the Rep Node and Storage Nodes' Monitor, Admin, and
Registry Handler interfaces. The parameters
are <code>rnRHSOBacklog</code> (default
1024), <code>rnMonitorSOBacklog</code> (default 0), rnAdminSOBacklog
(default 0), <code>rnAdminSOBacklog</code> (default 0),
<code>snAdminSOBacklog</code> (default
0), <code>snMonitorSOBacklog</code> (default 0), and
<code>snRegistrySOBacklog</code> (default 1024).
[#21322]
</li>

<li>
  Previously, calling <code>Key.isPrefix</code> with an argument containing
  a smaller major or minor path than the target Key object caused an
  IndexOutOfBoundsException in certain cases.  This has been fixed.
</li>
<li>
The <code>KeyRange()</code> constructor now checks that the start
<code>Key</code> is less than the end <code>Key</code> if both are specified,
otherwise an <code>IllegalArgumentException</code> is thrown.
<code>KeyRange</code> also has <code>toString()</code> and
<code>fromString()</code> methods for encoding and decoding
<code>KeyRange</code> instances, similar to the same methods in
<code>Key</code>. [#21470]
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="Utilities2023">Utility Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
Many new commands have been added to the CLI. See
<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/18.1&id=NSADM-GUID-59A3CE95-270A-434F-BBF7-331C28938E34">
Command Line Interface (CLI) Command Reference</a> of the <i>Administrator's
Guide</i> for details.
<li>
The Admin Console is now for monitoring only.
<li>
Administration CLI commands have been changed so that component ids
match the ids used in the topology display. Previously Datacenters,
Storage Nodes, Admin instances and Replication Nodes were identified
only by number. For example, the syntax to add Storage Node 17 to a
Storage Node pool, or to show the parameters for a given Replication Node was:
<blockquote>
<pre>
joinPool myStorageNodePool 17
show repnode-params 5,3
</pre>
</blockquote>
Datacenters can now be expressed as # or dc#<br>
Admin instances can now be expressed as # or admin#<br>
Storage Nodes can now be expressed as # or sn#<br>
Replication Nodes can now be expressed as groupNum,nodeNum, or rgX-rnY<br>
<p>
The commands shown above are still valid, but can also be expressed as:
<blockquote>
<pre>
joinPool myStorageNodePool sn17
show repnode-params rg5-rn3
</pre>
</blockquote>
[#21099]
</li>
</ol>

<!-- ========================================================= -->
<h3><a name="IandI2023">Documentation, Installation and
    Integration:</a></h3>
<!-- ========================================================= -->

<ol>
<li>
 The javadoc for the <code>Key.createKey</code> methods has been improved to
 warn that List instances passed as parameters are owned by the Key object
 after calling the method.  To avoid unpredictable results, they must not be
 modified.  [#20530]
</li>
</ol>

<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 11gR2.1.2.123</u></h3>

<!-- ========================================================= -->
<h3><a name="BugFixes12">Bug fixes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
  Previously, executing a change-repnode-params plan in order to
  change Replication Node parameters for a node other than the one
  running the Admin service would fail. This operation will now
  succeed. [#20901]
</li>
<li>
  A deploy-storage-node plan which ran into problems when attempting
  to deploy a new storage node would leave the problematic SN in the
  store. This would require that the user either take manual action to
  remove the bad SN, or fix the problem and retry the plan. For
  convenience, the deploy-storage-node plan will now clean up if it
  runs into errors, and will not leave the failed SN behind. [#20530]
</li>
</ol>

<!-- ========================================================= -->
<h3><a name="General12">Performance and other General Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
  The command line interface's <code>snapshot create</code> command
  has been made significantly faster. Previously, it could take
  minutes if executed on a store with a large amount of data.  This
  should be reduced to seconds. [#20772]
</li>

</ol>

<!-- ========================================================= -->
<h3><a name="Utilities12">Utility Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
The two scripts for starting kvlite and executing control commands,
<code>bin/run-kvlite.sh</code> and <code>bin/kvctl</code>, have been replaced
by a <code>java -jar lib/kvstore-M.N.P.jar</code> command.  This provides portability
to all Java platforms, including Windows.  The two scripts are deprecated, but
will be supported for at least one release cycle.
<p>
The translation from the old script commands to the new -jar commands is as
follows:</p>
<table border="1" summary="Compare script and jar commands">
    <tr><th>Old script command</th><th>New -jar command</th></tr>
    <tr>
        <td><code>bin/run-kvlite.sh args...</code></td>
        <td><code>java -jar lib/kvstore-M.N.P.jar kvlite args...</code></td>
    </tr>
    <tr>
        <td><code>bin/kvctl command args...</code></td>
        <td><code>java -jar lib/kvstore-M.N.P.jar command args...</code></td>
    </tr>
</table>
<p>
There are a few differences to be aware of between the old and new commands.
<ul>
    <li><p><code>nohup</code>, if desired, must be explicitly specified.  In
    the <code>bin/kvctl</code> script, nohup was added automatically for the
    <code>start</code> and <code>restart</code> commands.  To specify the
    equivalent command, use:</p>
    <p><code>nohup java -jar lib/kvstore-M.N.P.jar start args... &gt; /dev/null &lt;
    /dev/null 2&lt;&amp;1 &amp;</code></p>
    </li>
    <li><p>The logging configuration file for kvlite is now specified using
    standard Java syntax.  Previously, the
    <code>examples/logging.properties</code> configuration file was added
    automatically when passing <code>-logging</code> to the
    <code>run-kvlite.sh</code> script.  The new equivalent is:</p>
    <p><code>java -Djava.util.logging.config.file=examples/logging.properties
    -jar lib/kvstore-M.N.P.jar kvlite args...</code></p>
    </li>
    <li><p>Previously, the <code>-host</code> argument defaulted to
    the local machine name (via the <code>`hostname`</code> command) when
    running the <code>kvctl</code> script.  Now, for all control commands, no
    default hostname is used and the <code>-host</code> argument must be
    specified explicitly.  This change was made for two reasons: 1)
    consistency, since the port and other arguments have no default value for
    control commands, and 2) safety, since specifying an explicit hostname
    guards against accidental errors.</p>
    </li>
    <li><p>Previously, the <code>-host</code> argument defaulted to
    <code>localhost</code> when running the <code>run-kvlite.sh</code> script.
    Now, the default is the local machine name rather than (literally)
    <code>localhost</code>.  Note that the kvlite command, unlike the control
    commands, has default values for all arguments.  This is because the kvlite
    command is designed for ease-of-use during development on a single machine.
    kvlite should not be used in production or for performance testing.</p>
    </li>
    <li><p>Previously, running <code>java -jar lib/kvstore-M.N.P.jar</code>, with or
    without arguments, printed the product version.  Now, if no arguments are
    specified, a usage message is printed.  To print the version, use the
    version command:</p>
    <p><code>java -jar lib/kvstore-M.N.P.jar version</code></p>
    </li>
</ul>
</li>
</ol>

</body>
</html>
